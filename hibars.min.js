function hibars(a){function P(a){return Math.abs(a)<1e3?d3.format(" ")(a):Math.abs(a)>=1e3&&Math.abs(a)<1e6?a/1e3+"k":Math.abs(a)>=1e6&&Math.abs(a)<1e9?d3.format(" ")(a/1e6)+"M":Math.abs(a)>=1e9&&Math.abs(a)<1e12?d3.format(" ")(a/1e9)+"B":Math.abs(a)>=1e12&&Math.abs(a)<1e15?d3.format(" ")(a/1e12)+"T":Math.abs(a)>=1e15&&Math.abs(a)<1e18?d3.format(" ")(a/1e15)+"P":Math.abs(a)>=1e18&&Math.abs(a)<1e21?d3.format(" ")(a/1e18)+"E":Math.abs(a)>=1e21&&Math.abs(a)<1e24?d3.format(" ")(a/1e21)+"Z":d3.format(" ")(a/1e24)+"Y"}function fa(a,b,c,d,e){var f=[];if(R.selectAll(a).style("font-size","1px").each(function(){var a=this.getBBox();null==a.width&&(a.width=10),null==a.height&&(a.height=1),f.push(b/a.width),c&&f.push(c/a.height)}),d&&f.push(d),e)var g=Math.max(d3.min(f),e);else var g=d3.min(f);return R.selectAll(a).style("font-size",g+"px"),g}var b="#"+a.location,c=a.datafile,d=a.dependent,e=a.factor1,f=a.factor2,g=2;if(a.factor3){var h=a.factor3;g=3}if(a.factor4){var m=a.factor4;g=4}var n=a.chartwidth||800,o=a.chartheight||500,p=a.colorscheme||colorpalettes.defaultcolors,q=a.auto_size||"no",r=a.controls||"yes",s=a.y_reference||0,t=a.show_errors||"yes";if("yes"==t)var u=a.errors||"stderror";if(a.errorLO&&a.errorHI)var v=a.errorLO,w=a.errorHI;var x={top:.04*o,right:.025*n,bottom:.12*o,left:.09375*n,legend:.15*n},y=n-x.left-x.right-x.legend,A=(n-x.left-x.right,o-x.top-x.bottom),B=.1,C=.1,D=.1;4==g&&(B=.05);var E,F=d3.scaleBand().rangeRound([0,y]).padding(B),G=d3.scaleBand(),H=d3.scaleBand(),I=d3.scaleBand(),J=d3.scaleLinear().range([A,0]),L=Math.min(.0025*n,.004*o),M=d3.axisBottom().scale(F).tickSize(0).tickPadding(2*x.bottom/3),N=d3.axisBottom().tickSize(0).tickPadding(1*x.bottom/5);if(4==g){var O=d3.axisBottom().tickSizeInner(0).tickSizeOuter(0).tickPadding(1*x.bottom/8);M.tickPadding(3*x.bottom/5),N.tickPadding(1*x.bottom/3)}var Q=d3.axisLeft().scale(J).tickFormat(function(a){return P(a)}).tickSizeInner(-y).tickSizeOuter(0).tickPadding(.0125*n);if("no"==q)var R=d3.select(b).style("text-align","center").append("svg").attr("width",y+x.left+x.right+x.legend).attr("height",A+x.top+x.bottom).append("g").attr("transform","translate("+x.left+","+x.top+")");else if("yes"==q)var S=d3.select(b).style("text-align","center").append("div").style("display","inline-block").style("position","relative").style("width","100%").style("padding-bottom","calc(100% * "+o/n+")").style("vertical-align","top").style("overflow","hidden"),R=S.append("svg").attr("viewBox","0 0 "+n+" "+o).attr("preserveAspectRatio","xMinYMin meet").style("display","inline-block").style("position","absolute").style("top","0px").style("left","0px").append("g").attr("transform","translate("+x.left+","+x.top+")");var $,_,aa,T=0,U=0,V=0,W=0,X=0,Y=1,Z=1,ca=.95*x.legend,da=.05*A,ea=.9*Math.min(ca,da,.5*x.legend);d3.csv(c,function(a,c){function Ba(){var a=d3.event.target.value,b=a.split(",");0==X&&(X=1,T=0,U=0,V=0,W=0,Ca(b[0],b[1],b[2],b[3]))}function Ca(a,b,e,f){if(2==g){for(q=d3.nest().key(function(b){return b[a]}).key(function(a){return a[b]}).entries(c),i=0;i<q.length;i++)for(j=0;j<q[i].values.length;j++)v&&w&&u?(q[i].values[j].values[0].errorHI=+q[i].values[j].values[0][w],q[i].values[j].values[0].errorLO=+q[i].values[j].values[0][v]):u&&(q[i].values[j].values[0].errorHI=+q[i].values[j].values[0][d]+ +q[i].values[j].values[0][u],q[i].values[j].values[0].errorLO=+q[i].values[j].values[0][d]-+q[i].values[j].values[0][u]),q[i].values[j].values[0][d]=+q[i].values[j].values[0][d];F.domain(q.map(function(a){return a.key})).rangeRound([0,y]).padding(B),G.domain(q[0].values.map(function(a){return a.key})).rangeRound([0,F.bandwidth()]),ma=q[0]}else if(3==g){for(q=d3.nest().key(function(b){return b[a]}).key(function(a){return a[b]}).key(function(a){return a[e]}).entries(c),i=0;i<q.length;i++)for(j=0;j<q[i].values.length;j++)for(k=0;k<q[i].values[j].values.length;k++)v&&w&&u?(q[i].values[j].values[k].values[0].errorHI=+q[i].values[j].values[k].values[0][w],q[i].values[j].values[k].values[0].errorLO=+q[i].values[j].values[k].values[0][v]):u&&(q[i].values[j].values[k].values[0].errorHI=+q[i].values[j].values[k].values[0][d]+ +q[i].values[j].values[k].values[0][u],q[i].values[j].values[k].values[0].errorLO=+q[i].values[j].values[k].values[0][d]-+q[i].values[j].values[k].values[0][u]),q[i].values[j].values[k].values[0][d]=+q[i].values[j].values[k].values[0][d];F.domain(q.map(function(a){return a.key})).rangeRound([0,y]).padding(B),G.domain(q[0].values.map(function(a){return a.key})).rangeRound([0,F.bandwidth()]).padding(C),H.domain(q[0].values[0].values.map(function(a){return a.key})).rangeRound([0,G.bandwidth()]),ma=q[0].values[0]}else if(4==g){for(q=d3.nest().key(function(b){return b[a]}).key(function(a){return a[b]}).key(function(a){return a[e]}).key(function(a){return a[f]}).entries(c),i=0;i<q.length;i++)for(j=0;j<q[i].values.length;j++)for(k=0;k<q[i].values[j].values.length;k++)for(l=0;l<q[i].values[j].values[k].values.length;l++)v&&w&&u?(q[i].values[j].values[k].values[l].values[0].errorHI=+q[i].values[j].values[k].values[l].values[0][w],q[i].values[j].values[k].values[l].values[0].errorLO=+q[i].values[j].values[k].values[l].values[0][v]):u&&(q[i].values[j].values[k].values[l].values[0].errorHI=+q[i].values[j].values[k].values[l].values[0][d]+ +q[i].values[j].values[k].values[l].values[0][u],q[i].values[j].values[k].values[l].values[0].errorLO=+q[i].values[j].values[k].values[l].values[0][d]-+q[i].values[j].values[k].values[l].values[0][u]),q[i].values[j].values[k].values[l].values[0][d]=+q[i].values[j].values[k].values[l].values[0][d];F.domain(q.map(function(a){return a.key})).rangeRound([0,y]).padding(B),G.domain(q[0].values.map(function(a){return a.key})).rangeRound([0,F.bandwidth()]).padding(C),H.domain(q[0].values[0].values.map(function(a){return a.key})).rangeRound([0,G.bandwidth()]).padding(D),I.domain(q[0].values[0].values[0].values.map(function(a){return a.key})).rangeRound([0,H.bandwidth()]),ma=q[0].values[0].values[0]}E=ma.values.length,t.domain(ma.values.map(function(a){return a.key})),t.range(function(){return p[E]||colorpalettes.defaultcolors[E]}()),R.selectAll(".databar").transition().duration(500).attr("y",2*A).transition().remove(),R.selectAll(".errorline").transition().duration(500).attr("y1",2*A).attr("y2",2*A).transition().remove(),setTimeout(function(){M.scale(F),g>2&&N.scale(G),g>3&&O.scale(H),R.select(".x.axis").call(M),z=z.data([]).exit().remove(),K=K.data([]).exit().remove(),z=R.selectAll(".factor1group").data(q).enter().append("g").attr("class","factor1group").attr("transform",function(a){return"translate("+F(a.key)+",0)"}),g>2&&z.append("g").attr("class","x1 axis").attr("transform","translate(0,"+A+")").call(N).style("font-size","12px"),K=R.selectAll(".axisticks1").data(q).enter().append("g").attr("class","axisticks1").attr("transform",function(a){return"translate("+F(a.key)+",0)"}),K.filter(function(a,b){return b<q.length-1}).append("line").attr("class","group1tick").attr("x1",F.bandwidth()/2+F.bandwidth()/(2-2*B)).attr("y1",A).attr("x2",F.bandwidth()/2+F.bandwidth()/(2-2*B)).attr("y2",A+x.bottom).attr("stroke","black").attr("stroke-width",.002*o),g>2&&(S=z.selectAll(".factor2group").data(function(a){return a.values}).enter().append("g").attr("class","factor2group").attr("transform",function(a){return"translate("+G(a.key)+",0)"}),ba=K.selectAll(".axisticks2").data(function(a){return a.values}).enter().append("g").attr("class","axisticks2").attr("transform",function(a){return"translate("+G(a.key)+",0)"}),ba.filter(function(a,b){return b<q[0].values.length-1}).append("line").attr("class","group2tick").attr("x1",G.bandwidth()/2+G.bandwidth()/(2-2*C)).attr("y1",A).attr("x2",G.bandwidth()/2+G.bandwidth()/(2-2*C)).attr("y2",A+x.bottom/3).attr("stroke","black").attr("stroke-width",.002*o)),g>3&&(ga=S.selectAll(".factor3group").data(function(a){return a.values}).enter().append("g").attr("class","factor3group").attr("transform",function(a){return"translate("+H(a.key)+",0)"}),ha=ba.selectAll(".axisticks3").data(function(a){return a.values}).enter().append("g").attr("class","axisticks3").attr("transform",function(a){return"translate("+H(a.key)+",0)"}),ha.filter(function(a,b){return b<q[0].values[0].values.length-1}).append("line").attr("class","group3tick").attr("x1",H.bandwidth()/2+H.bandwidth()/(2-2*D)).attr("y1",A).attr("x2",H.bandwidth()/2+H.bandwidth()/(2-2*D)).attr("y2",A+x.bottom/5).attr("stroke","black").attr("stroke-width",.002*o)),fa(".x0.axis text",.95*F.bandwidth(),.3*x.bottom,Math.min(.0225*n,.036*o)),g>2&&fa(".x1.axis text",.95*G.bandwidth(),.25*x.bottom,Math.min(.0175*n,.028*o)),g>3&&fa(".x2.axis text",.95*H.bandwidth(),.2*x.bottom,Math.min(.0125*n,.02*o)),R.select("g.x.x0.axis").call(M),g>2&&z.call(N),g>3&&(S.append("g").attr("class","x2 axis").attr("transform","translate(0,"+A+")").call(O).style("font-size","10px").selectAll("text").style("text-anchor","middle"),fa(".x2.axis text",.95*H.bandwidth(),.2*x.bottom,Math.min(.0125*n,.02*o)),S.call(O)),R.selectAll(".axis path").attr("stroke-width",.002*o),R.selectAll("g.x1, g.x2").selectAll("path").attr("display","none"),2==g?(ja=G,ka=F,la=z,ma=q[0],na=b):3==g?(ja=H,ka=G,la=S,ma=q[0].values[0],na=e):4==g&&(ja=I,ka=H,la=ga,ma=q[0].values[0].values[0],na=f),ia.indexOf(s)==-1&&(d3.select("text.y.axis.reftext").remove(),R.append("text").attr("class","y axis reftext").attr("x",0).attr("y",J(s)).attr("dy",-.004*o).text(P(s)).attr("text-anchor","start").attr("font-weight","bold").attr("font-style","italic").attr("fill","black").style("pointer-events","none").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif"),R.selectAll(".y.axis").style("font-size",function(){return Math.min(.032*o,.032*n,.15*x.left)+"px"})),pa=la.selectAll("rect").data(function(a){return a.values}).enter().append("rect").attr("class","databar").attr("width",ja.bandwidth()).attr("height",function(a){return Math.abs(J(a.values[0][d])-J(s))}).style("fill",function(a){return t(a.key)}).attr("x",function(a){return ja(a.key)}).attr("y",A).transition().duration(500).attr("y",function(a){return a.values[0][d]>=s?(a.values[0].adj=Math.min(50/o,.5),J(a.values[0][d])+a.values[0].adj):a.values[0][d]<s?(a.values[0].adj=1-Math.min(50/o,.5),J(s)+a.values[0].adj):void 0}),la.selectAll("rect").on("mouseover",function(a){var b=d3.select(this.parentNode).attr("transform"),c=b.substring(b.indexOf("(")+1,b.indexOf(")")).split(","),e=Number(c[0]),f=0;if(g>2){var h=d3.select(this.parentNode.parentNode).attr("transform"),i=h.substring(h.indexOf("(")+1,h.indexOf(")")).split(",");f=Number(i[0])}var j=0;if(g>3){var k=d3.select(this.parentNode.parentNode.parentNode).attr("transform"),l=k.substring(k.indexOf("(")+1,k.indexOf(")")).split(",");j=Number(l[0])}var m=parseFloat(d3.select(this).attr("x"))+e+f+j+ja.bandwidth()/2;if(a.values[0][d]>=s)var p=parseFloat(d3.select(this).attr("y"))+1*parseFloat(d3.select(this).attr("height"))/4;else if(a.values[0][d]<s)var p=J(s)+3*parseFloat(d3.select(this).attr("height"))/4;var q=Math.max(ja.bandwidth()/2.5,.02*n,.02*o);R.append("circle").attr("class","tooltip").attr("r",q).attr("cx",m).attr("cy",p).style("fill","aliceblue").style("pointer-events","none").style("stroke","black").style("stroke-width",.002*o+"px").style("stroke-opacity",.8).attr("fill-opacity",.8),R.append("text").attr("class","tooltip").attr("x",m).attr("y",p).attr("dy",.35*q+"px").attr("text-anchor","middle").attr("fill","black").style("pointer-events","none").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").text(a.values[0][d]);var r=fa("text.tooltip",3*q/2,q);d3.selectAll("text.tooltip").attr("dy",r/2.5+"px")}).on("mouseout",function(){d3.selectAll(".tooltip").transition().duration(100).attr("fill-opacity",0).style("stroke-opacity",0).remove()}),u&&(qa=la.selectAll(".errorbars").data(function(a){return a.values}).enter().append("g").attr("class","errorbars").style("pointer-events","none").attr("transform",function(a){var b=ja(a.key)+ja.bandwidth()/2;return"translate("+b+", 0 )"}),qa.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",L).attr("x1",0).attr("y1",A).attr("x2",0).attr("y2",A).transition().duration(500).attr("x1",0).attr("y1",function(a){var b=a.values[0].errorHI;return J(b)+a.values[0].adj}).attr("x2",0).attr("y2",function(a){var b=a.values[0].errorLO;return J(b)+a.values[0].adj}),qa.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",L).attr("x1",-ja.bandwidth()/4).attr("y1",A).attr("x2",ja.bandwidth()/4).attr("y2",A).transition().duration(500).attr("x1",-ja.bandwidth()/4).attr("y1",function(a){var b=a.values[0].errorHI;return J(b)+a.values[0].adj}).attr("x2",ja.bandwidth()/4).attr("y2",function(a){var b=a.values[0].errorHI;return J(b)+a.values[0].adj}).attr("stroke","black").attr("stroke-width",L),qa.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",L).attr("x1",-ja.bandwidth()/4).attr("y1",A).attr("x2",ja.bandwidth()/4).attr("y2",A).transition().duration(500).attr("x1",-ja.bandwidth()/4).attr("y1",function(a){var b=a.values[0].errorLO;return J(b)+a.values[0].adj}).attr("x2",ja.bandwidth()/4).attr("y2",function(a){var b=a.values[0].errorLO;return J(b)+a.values[0].adj}).attr("stroke","black").attr("stroke-width",L)),ra.data([]).exit().remove(),ra=R.selectAll(".legend").data(ma.values).enter().append("g").attr("class","legend").attr("transform",function(a,b){var c=b*ea*1.1+ea;return"translate(0,"+c+")"}),ra.append("rect").attr("x",n-x.left-ea).attr("width",ea).attr("height",ea).style("fill",function(a){return t(a.key)}),ra.append("text").attr("x",.991489*(n-x.left-ea)).attr("y",ea/2).attr("dy",ea/3.2).style("text-anchor","end").text(function(a){return a.key}).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").classed("legendtext",!0).style("font-size","1px"),sa.text(na).attr("class","legendtitle").style("font-weight","normal"),fa("text.legendtext",x.legend-ea,.8*ea,Math.min(.0225*n,.036*o)),fa("text.legendtitle",.8*x.legend,ea,Math.min(.0225*n,.036*o)),d3.selectAll("text.legendtitle").style("font-weight","bold"),ta.transition().attr("transform",function(){var a=n-x.left,b=ma.values.length*ea*1.1+3*ea;return"translate("+a+","+b+")"}),ua.transition().attr("transform",function(){var a=n-x.left,b=ma.values.length*ea*1.1+3*ea+2*da;return"translate("+a+","+b+")"}),xa.transition().attr("transform",function(a,b){var c=n-x.left-ca,d=ma.values.length*ea*1.1+b*(1.1*da)+3*ea+2.5*da;return"translate("+c+","+d+")"}),g<4&&(ya.transition().attr("transform",function(){var a=n-x.left,b=ma.values.length*ea*1.1+3*ea+va.length*(1.1*da)+4*da;return"translate("+a+","+b+")"}),za.transition().attr("transform",function(a,b){var c=n-x.left-ca,d=ma.values.length*ea*1.1+3*ea+va.length*(1.1*da)+b*(1.1*da)+4.5*da;return"translate("+c+","+d+")"})),2==g?(xa.filter(function(a,b){return"morphbutton0"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+b),xa.filter(function(a,b){return"morphbutton1"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+a)):3==g?(xa.filter(function(a,b){return"morphbutton0"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+e),xa.filter(function(a,b){return"morphbutton1"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+b),xa.filter(function(a,b){return"morphbutton2"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+a)):4==g&&(xa.filter(function(a,b){return"morphbutton0"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+f),xa.filter(function(a,b){return"morphbutton1"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+e),xa.filter(function(a,b){return"morphbutton2"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+b),xa.filter(function(a,b){return"morphbutton3"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+a)),X=0},500)}if(a)throw a;if(2==g){var q=d3.nest().key(function(a){return a[e]}).key(function(a){return a[f]}).entries(c);for(i=0;i<q.length;i++)for(j=0;j<q[i].values.length;j++)v&&w&&u?(q[i].values[j].values[0].errorHI=+q[i].values[j].values[0][w],q[i].values[j].values[0].errorLO=+q[i].values[j].values[0][v]):u&&(q[i].values[j].values[0].errorHI=+q[i].values[j].values[0][d]+ +q[i].values[j].values[0][u],q[i].values[j].values[0].errorLO=+q[i].values[j].values[0][d]-+q[i].values[j].values[0][u]),q[i].values[j].values[0][d]=+q[i].values[j].values[0][d];F.domain(q.map(function(a){return a.key})),G.domain(q[0].values.map(function(a){return a.key})).rangeRound([0,F.bandwidth()]),E=q[0].values.length,u?J.domain([Math.min(s,d3.min(q,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return a.errorLO})})})),Math.max(s,d3.max(q,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return a.errorHI})})}))]).nice():J.domain([Math.min(s,d3.min(q,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return a[d]})})})),Math.max(s,d3.max(q,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return a[d]})})}))]).nice()}else if(3==g){var q=d3.nest().key(function(a){return a[e]}).key(function(a){return a[f]}).key(function(a){return a[h]}).entries(c);for(i=0;i<q.length;i++)for(j=0;j<q[i].values.length;j++)for(k=0;k<q[i].values[j].values.length;k++)v&&w&&u?(q[i].values[j].values[k].values[0].errorHI=+q[i].values[j].values[k].values[0][w],q[i].values[j].values[k].values[0].errorLO=+q[i].values[j].values[k].values[0][v]):u&&(q[i].values[j].values[k].values[0].errorHI=+q[i].values[j].values[k].values[0][d]+ +q[i].values[j].values[k].values[0][u],q[i].values[j].values[k].values[0].errorLO=+q[i].values[j].values[k].values[0][d]-+q[i].values[j].values[k].values[0][u]),q[i].values[j].values[k].values[0][d]=+q[i].values[j].values[k].values[0][d];F.domain(q.map(function(a){return a.key})),G.domain(q[0].values.map(function(a){return a.key})).rangeRound([0,F.bandwidth()]).padding(C),H.domain(q[0].values[0].values.map(function(a){return a.key})).rangeRound([0,G.bandwidth()]),N.scale(G),E=q[0].values[0].values.length,u?J.domain([Math.min(s,d3.min(q,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return a.errorLO})})})})),Math.max(s,d3.max(q,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return a.errorHI})})})}))]).nice():J.domain([Math.min(s,d3.min(q,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return a[d]})})})})),Math.max(s,d3.max(q,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return a[d]})})})}))]).nice(),da=Math.min(.05*A,(A-q[0].values[0].values[0].values.length*ea*1.1)/16,(A-q[0].values[0].values.length*ea*1.1)/16,(A-q[0].values.length*ea*1.1)/16,ea)}else if(4==g){var q=d3.nest().key(function(a){return a[e]}).key(function(a){return a[f]}).key(function(a){return a[h]}).key(function(a){return a[m]}).entries(c);for(i=0;i<q.length;i++)for(j=0;j<q[i].values.length;j++)for(k=0;k<q[i].values[j].values.length;k++)for(l=0;l<q[i].values[j].values[k].values.length;l++)v&&w&&u?(q[i].values[j].values[k].values[l].values[0].errorHI=+q[i].values[j].values[k].values[l].values[0][w],q[i].values[j].values[k].values[l].values[0].errorLO=+q[i].values[j].values[k].values[l].values[0][v]):u&&(q[i].values[j].values[k].values[l].values[0].errorHI=+q[i].values[j].values[k].values[l].values[0][d]+ +q[i].values[j].values[k].values[l].values[0][u],q[i].values[j].values[k].values[l].values[0].errorLO=+q[i].values[j].values[k].values[l].values[0][d]-+q[i].values[j].values[k].values[l].values[0][u]),q[i].values[j].values[k].values[l].values[0][d]=+q[i].values[j].values[k].values[l].values[0][d];F.domain(q.map(function(a){return a.key})),G.domain(q[0].values.map(function(a){return a.key})).rangeRound([0,F.bandwidth()]).padding(C),H.domain(q[0].values[0].values.map(function(a){return a.key})).rangeRound([0,G.bandwidth()]).padding(D),I.domain(q[0].values[0].values[0].values.map(function(a){return a.key})).rangeRound([0,H.bandwidth()]),N.scale(G),O.scale(H),E=q[0].values[0].values[0].values.length,u?J.domain([Math.min(s,d3.min(q,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return a.errorLO})})})})})),Math.max(s,d3.max(q,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return a.errorHI})})})})}))]).nice():J.domain([Math.min(s,d3.min(q,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return a[d]})})})})})),Math.max(s,d3.max(q,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return a[d]})})})})}))]).nice()}var t=d3.scaleOrdinal().range(function(){return p[E]||colorpalettes.defaultcolors[E]}());R.append("g").attr("class","x x0 axis").attr("transform","translate(0,"+A+")").call(M),R.append("g").attr("class","y axis").call(Q),R.append("text").attr("transform","rotate(-90)").attr("x",-A/2).attr("y",function(a){var b=this.getBBox(),e=(b.width,b.height,-x.left+Math.min(y/(1.1*b.height),.03*n));return e}).style("text-anchor","middle").text(d).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").style("font-size","1px").style("font-size",function(a){var b=this.getBBox(),e=(b.width,b.height,Math.min(A/(1.1*b.width),.35*x.left/(1.1*b.height),.0225*n,.036*o));return e+"px"});var z=R.selectAll(".factor1group").data(q).enter().append("g").attr("class","factor1group").attr("transform",function(a){return"translate("+F(a.key)+",0)"});g>2&&z.append("g").attr("class","x1 axis").attr("transform","translate(0,"+A+")").call(N).style("font-size","12px");var K=R.selectAll(".axisticks1").data(q).enter().append("g").attr("class","axisticks1").attr("transform",function(a){return"translate("+F(a.key)+",0)"});if(K.filter(function(a,b){return b<q.length-1}).append("line").attr("class","group1tick").attr("x1",F.bandwidth()/2+F.bandwidth()/(2-2*B)).attr("y1",A).attr("x2",F.bandwidth()/2+F.bandwidth()/(2-2*B)).attr("y2",A+x.bottom).attr("stroke","black").attr("stroke-width",.002*o),g>2){var S=z.selectAll(".factor2group").data(function(a){return a.values}).enter().append("g").attr("class","factor2group").attr("transform",function(a){return"translate("+G(a.key)+",0)"}),ba=K.selectAll(".axisticks2").data(function(a){return a.values}).enter().append("g").attr("class","axisticks2").attr("transform",function(a){return"translate("+G(a.key)+",0)"});ba.filter(function(a,b){return b<q[0].values.length-1}).append("line").attr("class","group2tick").attr("x1",G.bandwidth()/2+G.bandwidth()/(2-2*C)).attr("y1",A).attr("x2",G.bandwidth()/2+G.bandwidth()/(2-2*C)).attr("y2",A+x.bottom/3).attr("stroke","black").attr("stroke-width",.002*o)}if(g>3){var ga=S.selectAll(".factor3group").data(function(a){return a.values}).enter().append("g").attr("class","factor3group").attr("transform",function(a){return"translate("+H(a.key)+",0)"}),ha=ba.selectAll(".axisticks3").data(function(a){return a.values}).enter().append("g").attr("class","axisticks3").attr("transform",function(a){return"translate("+H(a.key)+",0)"});ha.filter(function(a,b){return b<q[0].values[0].values.length-1}).append("line").attr("class","group3tick").attr("x1",H.bandwidth()/2+H.bandwidth()/(2-2*D)).attr("y1",A).attr("x2",H.bandwidth()/2+H.bandwidth()/(2-2*D)).attr("y2",A+x.bottom/5).attr("stroke","black").attr("stroke-width",.002*o)}fa(".x0.axis text",.95*F.bandwidth(),.3*x.bottom,Math.min(.0225*n,.036*o)),g>2&&fa(".x1.axis text",.95*G.bandwidth(),.25*x.bottom,Math.min(.0175*n,.028*o)),R.select("g.x.x0.axis").call(M),g>2&&z.call(N),g>3&&(S.append("g").attr("class","x2 axis").attr("transform","translate(0,"+A+")").call(O).style("font-size","10px").selectAll("text").style("text-anchor","middle"),fa(".x2.axis text",.95*H.bandwidth(),.2*x.bottom,Math.min(.0125*n,.02*o)),S.call(O));var ia=[];if(R.selectAll("g.tick").each(function(a){!isNaN(parseFloat(a))&&isFinite(a)&&ia.push(a)}),R.selectAll("g.tick").filter(function(a){return a!=s}).select("line").style("opacity","0.2"),ia.indexOf(s)==-1&&(R.selectAll("g.y.axis").append("g").attr("class","tick refline").append("line").attr("x1",0).attr("y1",J(s)).attr("x2",y).attr("y2",J(s)).style("stroke","black").style("stroke-width",.002*o),R.append("text").attr("class","y axis reftext").attr("x",0).attr("y",J(s)).attr("dy",-.004*o).text(P(s)).attr("text-anchor","start").attr("font-weight","bold").attr("font-style","italic").attr("fill","black").style("pointer-events","none").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif")),R.selectAll("g.tick").select("line").attr("stroke-width",.002*o),R.selectAll(".axis path").attr("stroke-width",.002*o),R.selectAll("g.x1, g.x2").selectAll("path").attr("display","none"),R.selectAll(".y.axis").style("font-size",function(){return Math.min(.032*o,.032*n,.15*x.left)+"px"}),2==g)var ja=G,ka=F,la=z,ma=q[0],na=f;else if(3==g)var ja=H,ka=G,la=S,ma=q[0].values[0],na=h;else if(4==g)var ja=I,ka=H,la=ga,ma=q[0].values[0].values[0],na=m;var pa=la.selectAll("rect").data(function(a){return a.values}).enter().append("rect").attr("class","databar").attr("width",ja.bandwidth()).attr("height",function(a){return Math.abs(J(a.values[0][d])-J(s))}).style("fill",function(a){return t(a.key)}).attr("x",function(a){return ja(a.key)}).attr("y",A).transition().duration(500).attr("y",function(a){return a.values[0][d]>=s?(a.values[0].adj=Math.min(50/o,.5),J(a.values[0][d])+a.values[0].adj):a.values[0][d]<s?(a.values[0].adj=1-Math.min(50/o,.5),J(s)+a.values[0].adj):void 0});if(la.selectAll("rect").on("mouseover",function(a){var b=d3.select(this.parentNode).attr("transform"),c=b.substring(b.indexOf("(")+1,b.indexOf(")")).split(","),e=Number(c[0]),f=0;if(g>2){var h=d3.select(this.parentNode.parentNode).attr("transform"),i=h.substring(h.indexOf("(")+1,h.indexOf(")")).split(",");f=Number(i[0])}var j=0;if(g>3){var k=d3.select(this.parentNode.parentNode.parentNode).attr("transform"),l=k.substring(k.indexOf("(")+1,k.indexOf(")")).split(",");j=Number(l[0])}var m=parseFloat(d3.select(this).attr("x"))+e+f+j+ja.bandwidth()/2;if(a.values[0][d]>=s)var p=parseFloat(d3.select(this).attr("y"))+1*parseFloat(d3.select(this).attr("height"))/4;else if(a.values[0][d]<s)var p=J(s)+3*parseFloat(d3.select(this).attr("height"))/4;var q=Math.max(ja.bandwidth()/2.5,.02*n,.02*o);R.append("circle").attr("class","tooltip").attr("r",q).attr("cx",m).attr("cy",p).style("fill","aliceblue").style("pointer-events","none").style("stroke","black").style("stroke-width",.002*o+"px").style("stroke-opacity",.8).attr("fill-opacity",.8),R.append("text").attr("class","tooltip").attr("x",m).attr("y",p).attr("dy",.35*q+"px").attr("text-anchor","middle").attr("fill","black").style("pointer-events","none").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").text(a.values[0][d]);var r=fa("text.tooltip",3*q/2,q);d3.selectAll("text.tooltip").attr("dy",r/2.5+"px")}).on("mouseout",function(){d3.selectAll(".tooltip").transition().duration(100).attr("fill-opacity",0).style("stroke-opacity",0).remove()}),u){var qa=la.selectAll(".errorbars").data(function(a){return a.values}).enter().append("g").attr("class","errorbars").style("pointer-events","none").attr("transform",function(a){var b=ja(a.key)+ja.bandwidth()/2;return"translate("+b+", 0 )"});qa.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",L).attr("x1",0).attr("y1",A).attr("x2",0).attr("y2",A).transition().duration(500).attr("x1",0).attr("y1",function(a){var b=a.values[0].errorHI;return J(b)+a.values[0].adj}).attr("x2",0).attr("y2",function(a){var b=a.values[0].errorLO;return J(b)+a.values[0].adj}),qa.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",L).attr("x1",-ja.bandwidth()/4).attr("y1",A).attr("x2",ja.bandwidth()/4).attr("y2",A).transition().duration(500).attr("x1",-ja.bandwidth()/4).attr("y1",function(a){var b=a.values[0].errorHI;return J(b)+a.values[0].adj}).attr("x2",ja.bandwidth()/4).attr("y2",function(a){var b=a.values[0].errorHI;return J(b)+a.values[0].adj}).attr("stroke","black").attr("stroke-width",L),qa.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",L).attr("x1",-ja.bandwidth()/4).attr("y1",A).attr("x2",ja.bandwidth()/4).attr("y2",A).transition().duration(500).attr("x1",-ja.bandwidth()/4).attr("y1",function(a){var b=a.values[0].errorLO;return J(b)+a.values[0].adj}).attr("x2",ja.bandwidth()/4).attr("y2",function(a){var b=a.values[0].errorLO;return J(b)+a.values[0].adj}).attr("stroke","black").attr("stroke-width",L)}var ra=R.selectAll(".legend").data(ma.values).enter().append("g").attr("class","legend").attr("transform",function(a,b){var c=b*ea*1.1+ea;return"translate(0,"+c+")"});ra.append("rect").attr("x",n-x.left-ea).attr("width",ea).attr("height",ea).style("fill",function(a){return t(a.key)}),ra.append("text").attr("x",.991489*(n-x.left-ea)).attr("y",ea/2).attr("dy",ea/3.2).style("text-anchor","end").text(function(a){return a.key}).classed("legendtext",!0).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif");var sa=R.append("g").attr("transform",function(){var a=n-x.left;return"translate("+a+","+ea/2+")"}).append("text").text(na).attr("class","legendtitle").attr("x",0).attr("y",0).style("text-anchor","end").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif");if(fa("text.legendtext",x.legend-ea,.8*ea,Math.min(.0225*n,.036*o)),fa("text.legendtitle",.8*x.legend,ea,Math.min(.0225*n,.036*o)),d3.selectAll("text.legendtitle").style("font-weight","bold"),"yes"==r){var ta=R.append("g").attr("class","axiscontrolstitle").attr("transform",function(){var a=n-x.left,b=ma.values.length*ea*1.1+3*ea;return"translate("+a+","+b+")"});ta.append("text").text("X axis controls").attr("class","morphtext3").attr("x",-ca/2).attr("y",0).style("fill","steelblue").style("text-anchor","middle").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif");var ua=R.append("g").attr("class","fliptitle").attr("transform",function(){var a=n-x.left,b=ma.values.length*ea*1.1+3*ea+2*da;return"translate("+a+","+b+")"});if(ua.append("text").text("Flips").attr("class","morphtext3").attr("x",-ca/2).attr("y",0).style("text-anchor","middle").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif"),2==g)var va=["Flip "+f,"Flip "+e],wa=[e,f];else if(3==g)var va=["Flip "+h,"Flip "+f,"Flip "+e],wa=[e+","+f,e+","+h,f+","+e,h+","+e,f+","+h,h+","+f];else if(4==g)var va=["Flip "+m,"Flip "+h,"Flip "+f,"Flip "+e],wa=[e+","+f+","+h+","+m,e+","+f+","+m+","+h,e+","+h+","+f+","+m,e+","+h+","+m+","+f,e+","+m+","+f+","+h,e+","+m+","+h+","+f,f+","+e+","+h+","+m,f+","+e+","+m+","+h,f+","+h+","+e+","+m,f+","+h+","+m+","+e,f+","+m+","+e+","+h,f+","+m+","+h+","+e,h+","+e+","+f+","+m,h+","+e+","+m+","+f,h+","+f+","+e+","+m,h+","+f+","+m+","+e,h+","+m+","+e+","+f,h+","+m+","+f+","+e,m+","+e+","+f+","+h,m+","+e+","+h+","+f,m+","+f+","+e+","+h,m+","+f+","+h+","+e,m+","+h+","+e+","+f,m+","+h+","+f+","+e];var xa=R.selectAll(".morphbutton").data(va).enter().append("g").attr("class",function(a,b){return"morphbutton"+b}).attr("transform",function(a,b){var c=n-x.left-ca,d=ma.values.length*ea*1.1+3*ea+2.5*da+b*(1.1*da);return"translate("+c+","+d+")"});if(xa.append("rect").attr("width",ca).attr("height",da).attr("rx",.00625*n).attr("ry",.01*o).style("fill","#C0C0C0").on("mousedown",function(){d3.select(this).style("fill","darkgrey")}).on("mouseout",function(){d3.select(this).style("fill","#C0C0C0")}).on("mouseup",function(){d3.select(this).style("fill","#C0C0C0")}),xa.append("text").text(function(a){return a}).classed("morphtext",!0).attr("x",ca/2).attr("y",3*da/4).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").style("text-anchor","middle").style("fill","white").style("pointer-events","none"),
g<4){var ya=R.append("g").attr("class","redrawtitle").attr("transform",function(){var a=n-x.left,b=ma.values.length*ea*1.1+3*ea+va.length*(1.1*da)+4*da;return"translate("+a+","+b+")"});ya.append("text").text("X axis structure").attr("class","morphtext3").attr("x",-ca/2).attr("y",0).style("text-anchor","middle").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif");var za=R.selectAll(".morphbutton_2_").data(wa).enter().append("g").attr("class",function(a,b){return"morphbutton_2_"+b}).attr("transform",function(a,b){var c=n-x.left-ca,d=ma.values.length*ea*1.1+3*ea+va.length*(1.1*da)+b*(1.1*da)+4.5*da;return"translate("+c+","+d+")"});za.append("rect").attr("width",ca).attr("height",da).attr("rx",.00625*n).attr("ry",.01*o).style("fill","#C0C0C0").on("mousedown",function(){d3.select(this).style("fill","darkgrey")}).on("mouseout",function(){d3.select(this).style("fill","#C0C0C0")}).on("mouseup",function(){d3.select(this).style("fill","#C0C0C0")}),za.append("text").text(function(a){return a}).classed("morphtext2",!0).attr("x",ca/2).attr("y",3*da/4).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").style("text-anchor","middle").style("fill","white").style("pointer-events","none")}else if(g>=4){var ya=d3.select(b).append("div").text("Factor Hierarchy (last is legend)").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").style("font-style","italic").style("color","steelblue"),za=d3.select(b).append("select").attr("class","select").attr("name","redrawlist").attr("transform",function(){var a=n-x.left-ca,b=ma.values.length*ea+va.length*(1.1*da)+7*da;return"translate("+a+","+b+")"}),Aa=za.selectAll("option").data(wa).enter().append("option");Aa.text(function(a){return a}).attr("value",function(a){return a}).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").style("font-size","12px")}fa("text.morphtext",.9*ca,.95*da,Math.min(.0175*n,.028*o)),fa("text.morphtext2",.9*ca,.95*da,Math.min(.0175*n,.028*o)),fa("text.morphtext3",.9*ca,.95*da,Math.min(.0175*n,.028*o)),d3.selectAll(".axiscontrolstitle text").style("font-weight","bold"),d3.selectAll(".fliptitle text").style("font-style","italic"),d3.selectAll(".redrawtitle text").style("font-style","italic"),xa.filter(function(a,b){return"morphbutton0"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==X&&(X=1,0==T?(ja.rangeRound([ka.bandwidth(),0]),T=1):1==T&&(ja.rangeRound([0,ka.bandwidth()]),T=0),la.selectAll("rect").data(function(a){return a.values}).transition().attr("width",ja.bandwidth()).attr("x",function(a){return ja(a.key)}).attr("y",function(a){return J(Math.max(s,a.values[0][d]))+a.values[0].adj}).attr("height",function(a){return Math.abs(J(a.values[0][d])-J(s))}).style("fill",function(a){return t(a.key)}).call(function(){X=0}),u&&la.selectAll(".errorbars").data(function(a){return a.values}).transition().attr("transform",function(a){var b=ja(a.key)+ja.bandwidth()/2;return"translate("+b+", 0 )"}))}),xa.filter(function(a,b){return"morphbutton1"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==X&&(X=1,2==g?(0==U?(ka.rangeRound([y,0]).padding(B),U=1):1==U&&(ka.rangeRound([0,y]).padding(B),U=0),R.select("g.x.x0.axis").transition().call(M),R.selectAll("g.factor1group").data(q).transition().attr("transform",function(a){return"translate("+F(a.key)+",0)"})):3==g?(0==U?(ka.rangeRound([F.bandwidth(),0]).padding(C),U=1):1==U&&(ka.rangeRound([0,F.bandwidth()]).padding(C),U=0),z.selectAll(".x1.axis").transition().call(N),z.selectAll("g.factor2group").data(function(a){return a.values}).transition().attr("transform",function(a){return"translate("+G(a.key)+",0)"})):4==g&&(0==U?(ka.rangeRound([G.bandwidth(),0]).padding(D),U=1):1==U&&(ka.rangeRound([0,G.bandwidth()]).padding(D),U=0),S.selectAll(".x2.axis").transition().call(O),S.selectAll("g.factor3group").data(function(a){return a.values}).transition().attr("transform",function(a){return"translate("+H(a.key)+",0)"})),setTimeout(function(){X=0},500))}),3==g&&xa.filter(function(a,b){return"morphbutton2"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==X&&(X=1,0==V?(F.rangeRound([y,0]).padding(B),V=1):1==V&&(F.rangeRound([0,y]).padding(B),V=0),R.select("g.x.x0.axis").transition().call(M),R.selectAll("g.factor1group").data(q).transition().attr("transform",function(a){return"translate("+F(a.key)+",0)"}),setTimeout(function(){X=0},500))}),4==g&&(xa.filter(function(a,b){return"morphbutton2"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==X&&(X=1,0==V?(G.rangeRound([F.bandwidth(),0]).padding(C),V=1):1==V&&(G.rangeRound([0,F.bandwidth()]).padding(C),V=0),z.selectAll(".x1.axis").transition().call(N),z.selectAll("g.factor2group").data(function(a){return a.values}).transition().attr("transform",function(a){return"translate("+G(a.key)+",0)"}),setTimeout(function(){X=0},500))}),xa.filter(function(a,b){return"morphbutton3"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==X&&(X=1,0==W?(F.rangeRound([y,0]).padding(B),W=1):1==W&&(F.rangeRound([0,y]).padding(B),W=0),R.select("g.x.x0.axis").transition().call(M),R.selectAll("g.factor1group").data(q).transition().attr("transform",function(a){return"translate("+F(a.key)+",0)"}),setTimeout(function(){X=0},500))})),g<4?za.on("click",function(){"morphbutton_2_0"==d3.select(this).attr("class")&&2==g&&(Z=1,$=e,_=f),"morphbutton_2_1"==d3.select(this).attr("class")&&2==g&&(Z=2,$=f,_=e),"morphbutton_2_0"==d3.select(this).attr("class")&&g>2&&(Z=1,$=e,_=f,aa=h),"morphbutton_2_1"==d3.select(this).attr("class")&&g>2&&(Z=2,$=e,_=h,aa=f),"morphbutton_2_2"==d3.select(this).attr("class")&&(Z=3,$=f,_=e,aa=h),"morphbutton_2_3"==d3.select(this).attr("class")&&(Z=4,$=h,_=e,aa=f),"morphbutton_2_4"==d3.select(this).attr("class")&&(Z=5,$=f,_=h,aa=e),"morphbutton_2_5"==d3.select(this).attr("class")&&(Z=6,$=h,_=f,aa=e),0==X&&Y!==Z&&(X=1,Y=Z,T=0,U=0,V=0,2==g?Ca($,_):3==g&&Ca($,_,aa))}):g>=4&&za.on("change",Ba)}})}var colorpalettes={defaultcolors:{1:["#5DA5DA"],2:["#5DA5DA","#60BD68"],3:["#5DA5DA","#60BD68","#F15854"],4:["#5DA5DA","#F15854","#60BD68","#845C59"],5:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A"],6:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E"],7:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E","#F17CB0"],8:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E","#F17CB0","#DECF3F"],9:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E","#F17CB0","#DECF3F","#B276B2"],10:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E","#F17CB0","#DECF3F","#B276B2","#C2D580"],11:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E","#F17CB0","#DECF3F","#B276B2","#C2D580","4D4D4D"],12:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E","#F17CB0","#DECF3F","#B276B2","#C2D580","4D4D4D","#673333"]}};