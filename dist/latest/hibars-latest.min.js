function hibars2(a){function K(a,b,c,d){var e=[];z.selectAll(a).style("font-size","1px").style("font-size",function(){var a=this.getBBox(),d=Math.min(b/a.width,c);e.push(d)}).style("font-size",function(){return d?Math.max(d3.min(e),d)+"px":d3.min(e)+"px"})}var r,G,H,b="#"+a.location,c=a.datafile,d=a.dependent,e=a.factor1,f=a.factor2,g=a.chartwidth||800,h=a.chartheight||500,k=a.colorscheme||colorpalettes.defaultcolors,l={top:20,right:20,bottom:60,left:65,legend:.15*g},m=g-l.left-l.right-l.legend,n=g-l.left-l.right,o=h-l.top-l.bottom,p=.1,s=d3.scale.ordinal().rangeRoundBands([0,m],p),t=d3.scale.ordinal(),u=d3.scale.linear().range([o,0]),v=d3.scale.ordinal().range(function(){return k[r]||colorpalettes.defaultcolors[r]}()),w=2,x=d3.svg.axis().scale(s).orient("bottom").tickSize(0).tickPadding(2*l.bottom/3),y=d3.svg.axis().scale(u).orient("left").innerTickSize(-m).outerTickSize(0).tickPadding(10),z=d3.select(b).style("text-align","center").append("svg").attr("width",m+l.left+l.right+l.legend).attr("height",o+l.top+l.bottom).append("g").attr("transform","translate("+l.left+","+l.top+")"),A=0,B=0,D=0,E=1,F=1,I=.15*g,J=20;d3.csv(c,function(a,b){function U(a,e){for(c=d3.nest().key(function(b){return b[a]}).key(function(a){return a[e]}).entries(b),i=0;i<c.length;i++)for(j=0;j<c[i].values.length;j++)c[i].values[j].values[0].stderror=+c[i].values[j].values[0].stderror,c[i].values[j].values[0][d]=+c[i].values[j].values[0][d];s.domain(c.map(function(a){return a.key})).rangeRoundBands([0,m],p),t.domain(c[0].values.map(function(a){return a.key})).rangeRoundBands([0,s.rangeBand()]),r=c[0].values.length,v.domain(c[0].values.map(function(a){return a.key})),v.range(function(){return k[r]||colorpalettes.defaultcolors[r]}()),z.selectAll(".databar").transition().duration(500).attr("y",1e3).transition().remove(),z.selectAll(".errorline").transition().duration(500).attr("y1",1e3).attr("y2",1e3).transition().remove(),setTimeout(function(){x.scale(s),z.select(".x.axis").call(x),g=g.data([]).exit().remove(),h=h.data([]).exit().remove(),g=z.selectAll(".factor1group").data(c).enter().append("g").attr("class","factor1group").attr("transform",function(a){return"translate("+s(a.key)+",0)"}),h=z.selectAll(".axisticks1").data(c).enter().append("g").attr("class","axisticks1").attr("transform",function(a){return"translate("+s(a.key)+",0)"}),h.filter(function(a,b){return b<c.length-1}).append("line").attr("class","group1tick").attr("x1",s.rangeBand()/2+s.rangeBand()/(2-2*p)).attr("y1",o).attr("x2",s.rangeBand()/2+s.rangeBand()/(2-2*p)).attr("y2",o+l.bottom).attr("stroke","black").attr("stroke-width",1),K(".x0.axis text",s.rangeBand(),16),z.select("g.x.x0.axis").call(x),q=g.selectAll("rect").data(function(a){return a.values}).enter().append("rect").attr("class","databar").attr("width",t.rangeBand()).attr("height",function(a){return Math.abs(u(a.values[0][d])-u(0))}).style("fill",function(a){return v(a.key)}).attr("x",function(a){return t(a.key)}).attr("y",o).transition().duration(500).attr("y",function(a){return u(Math.max(0,a.values[0][d]))}),g.selectAll("rect").on("mouseover",function(a){var b=d3.transform(d3.select(this.parentNode).attr("transform")),c=b.translate[0],e=parseFloat(d3.select(this).attr("x"))+c+t.rangeBand()/2;if(a.values[0][d]>=0)var f=parseFloat(d3.select(this).attr("y"))+1*parseFloat(d3.select(this).attr("height"))/4;else if(a.values[0][d]<0)var f=u(0)+3*parseFloat(d3.select(this).attr("height"))/4;z.append("circle").attr("class","tooltip").attr("r",Math.max(t.rangeBand()/3,20)).attr("cx",e).attr("cy",f).style("fill","aliceblue").style("pointer-events","none").style("stroke","black").style("stroke-width","1px").style("stroke-opacity",.8).attr("fill-opacity",.8),z.append("text").attr("class","tooltip").attr("x",e).attr("y",f).attr("dy","5px").attr("text-anchor","middle").attr("font-size","11px").attr("font-weight","bold").attr("fill","black").style("pointer-events","none").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").text(a.values[0][d]),K("text.tooltip",Math.max(.5*t.rangeBand()-1,35),16,12)}).on("mouseout",function(){d3.selectAll(".tooltip").transition().duration(100).attr("fill-opacity",0).style("stroke-opacity",0).remove()}),C=g.selectAll(".errorbars").data(function(a){return a.values}).enter().append("g").attr("class","errorbars").style("pointer-events","none").attr("transform",function(a){var b=t(a.key)+t.rangeBand()/2;return"translate("+b+", 0 )"}),C.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",w).attr("x1",0).attr("y1",o).attr("x2",0).attr("y2",o).transition().duration(500).attr("x1",0).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return u(b)}).attr("x2",0).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return u(b)}),C.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",w).attr("x1",-t.rangeBand()/4).attr("y1",o).attr("x2",t.rangeBand()/4).attr("y2",o).transition().duration(500).attr("x1",-t.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return u(b)}).attr("x2",t.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]+a.values[0].stderror;return u(b)}).attr("stroke","black").attr("stroke-width",w),C.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",w).attr("x1",-t.rangeBand()/4).attr("y1",o).attr("x2",t.rangeBand()/4).attr("y2",o).transition().duration(500).attr("x1",-t.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]-a.values[0].stderror;return u(b)}).attr("x2",t.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return u(b)}).attr("stroke","black").attr("stroke-width",w),L.data([]).exit().remove(),L=z.selectAll(".legend").data(c[0].values).enter().append("g").attr("class","legend").attr("transform",function(a,b){var c=20*b+20;return"translate(0,"+c+")"}),L.append("rect").transition().attr("x",n).attr("width",18).attr("height",18).style("fill",function(a){return v(a.key)}),L.append("text").transition().attr("x",n-6).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){return a.key}),M.text(e),N.transition().attr("transform",function(){var a=n+18,b=20*c[0].values.length+60;return"translate("+a+","+b+")"}),O.transition().attr("transform",function(){var a=n+18,b=20*c[0].values.length+85;return"translate("+a+","+b+")"}),R.transition().attr("transform",function(a,b){var d=n-I+18,e=20*c[0].values.length+21*b+90;return"translate("+d+","+e+")"}),S.transition().attr("transform",function(){var a=n+18,b=20*c[0].values.length+21*P.length+125;return"translate("+a+","+b+")"}),T.transition().attr("transform",function(a,b){var d=n-I+18,e=20*c[0].values.length+21*P.length+21*b+130;return"translate("+d+","+e+")"}),R.filter(function(a,b){return"morphbutton0"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+e),R.filter(function(a,b){return"morphbutton1"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+a),D=0},500)}if(a)throw a;var c=d3.nest().key(function(a){return a[e]}).key(function(a){return a[f]}).entries(b);for(i=0;i<c.length;i++)for(j=0;j<c[i].values.length;j++)c[i].values[j].values[0].stderror=+c[i].values[j].values[0].stderror,c[i].values[j].values[0][d]=+c[i].values[j].values[0][d];s.domain(c.map(function(a){return a.key})),t.domain(c[0].values.map(function(a){return a.key})).rangeRoundBands([0,s.rangeBand()]),r=c[0].values.length,v.range(function(){return k[r]||colorpalettes.defaultcolors[r]}()),u.domain([Math.min(0,d3.min(c,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return a[d]-a.stderror})})})),Math.max(0,d3.max(c,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return a[d]+a.stderror})})}))]).nice(),z.append("g").attr("class","x x0 axis").attr("transform","translate(0,"+o+")").call(x),z.append("g").attr("class","y axis").call(y).append("text").attr("transform","rotate(-90)").attr("x",-o/2).attr("y",-l.left).attr("dy",".71em").style("text-anchor","middle").style("font-size","20px").text(d),u.domain()[0]<0&&u.domain()[1]>0&&z.append("g").attr("class","x axis").append("line").attr("x1",0).attr("y1",u(0)).attr("x2",m).attr("y2",u(0));var g=z.selectAll(".factor1group").data(c).enter().append("g").attr("class","factor1group").attr("transform",function(a){return"translate("+s(a.key)+",0)"}),h=z.selectAll(".axisticks1").data(c).enter().append("g").attr("class","axisticks1").attr("transform",function(a){return"translate("+s(a.key)+",0)"});h.filter(function(a,b){return b<c.length-1}).append("line").attr("class","group1tick").attr("x1",s.rangeBand()/2+s.rangeBand()/(2-2*p)).attr("y1",o).attr("x2",s.rangeBand()/2+s.rangeBand()/(2-2*p)).attr("y2",o+l.bottom).attr("stroke","black").attr("stroke-width",1),K(".x0.axis text",s.rangeBand(),16),z.select("g.x.x0.axis").call(x),z.selectAll(".axis line").style({fill:"none",stroke:"#000","shape-rendering":"crispEdges"}),z.selectAll(".axis path").style({fill:"none",stroke:"#000","shape-rendering":"crispEdges"}),z.selectAll(".tick line").style("opacity","0.2"),z.selectAll(".x.axis path").style("display","inline-block");var q=g.selectAll("rect").data(function(a){return a.values}).enter().append("rect").attr("class","databar").attr("width",t.rangeBand()).attr("height",function(a){return Math.abs(u(a.values[0][d])-u(0))}).style("fill",function(a){return v(a.key)}).attr("x",function(a){return t(a.key)}).attr("y",o).transition().duration(500).attr("y",function(a){return u(Math.max(0,a.values[0][d]))});g.selectAll("rect").on("mouseover",function(a){var b=d3.transform(d3.select(this.parentNode).attr("transform")),c=b.translate[0],e=parseFloat(d3.select(this).attr("x"))+c+t.rangeBand()/2;if(a.values[0][d]>=0)var f=parseFloat(d3.select(this).attr("y"))+1*parseFloat(d3.select(this).attr("height"))/4;else if(a.values[0][d]<0)var f=u(0)+3*parseFloat(d3.select(this).attr("height"))/4;z.append("circle").attr("class","tooltip").attr("r",Math.max(t.rangeBand()/3,20)).attr("cx",e).attr("cy",f).style("fill","aliceblue").style("pointer-events","none").style("stroke","black").style("stroke-width","1px").style("stroke-opacity",.8).attr("fill-opacity",.8),z.append("text").attr("class","tooltip").attr("x",e).attr("y",f).attr("dy","5px").attr("text-anchor","middle").attr("font-weight","bold").attr("fill","black").style("pointer-events","none").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").text(a.values[0][d]),K("text.tooltip",Math.max(.5*t.rangeBand()-1,35),16,12)}).on("mouseout",function(){d3.selectAll(".tooltip").transition().duration(100).attr("fill-opacity",0).style("stroke-opacity",0).remove()});var C=g.selectAll(".errorbars").data(function(a){return a.values}).enter().append("g").attr("class","errorbars").style("pointer-events","none").attr("transform",function(a){var b=t(a.key)+t.rangeBand()/2;return"translate("+b+", 0 )"});C.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",w).attr("x1",0).attr("y1",o).attr("x2",0).attr("y2",o).transition().duration(500).attr("x1",0).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return u(b)}).attr("x2",0).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return u(b)}),C.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",w).attr("x1",-t.rangeBand()/4).attr("y1",o).attr("x2",t.rangeBand()/4).attr("y2",o).transition().duration(500).attr("x1",-t.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return u(b)}).attr("x2",t.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]+a.values[0].stderror;return u(b)}).attr("stroke","black").attr("stroke-width",w),C.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",w).attr("x1",-t.rangeBand()/4).attr("y1",o).attr("x2",t.rangeBand()/4).attr("y2",o).transition().duration(500).attr("x1",-t.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]-a.values[0].stderror;return u(b)}).attr("x2",t.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return u(b)}).attr("stroke","black").attr("stroke-width",w);var L=z.selectAll(".legend").data(c[0].values).enter().append("g").attr("class","legend").attr("transform",function(a,b){var c=20*b+20;return"translate(0,"+c+")"});L.append("rect").attr("x",n).attr("width",18).attr("height",18).style("fill",function(a){return v(a.key)}),L.append("text").attr("x",n-6).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){return a.key});var M=z.append("g").attr("transform",function(){var a=n+18;return"translate("+a+",8)"}).append("text").attr("class","legendtitle").style("font-weight","bold").text(f).attr("x",0).attr("y",0).style("text-anchor","end"),N=z.append("g").attr("class","axiscontrolstitle").attr("transform",function(){var a=n+18,b=20*c[0].values.length+60;return"translate("+a+","+b+")"});N.append("text").text("X axis controls").attr("x",-I/2).attr("y",0).style("fill","steelblue").style("text-anchor","middle").style("font-weight","bold");var O=z.append("g").attr("class","fliptitle").attr("transform",function(){var a=n+18,b=20*c[0].values.length+85;return"translate("+a+","+b+")"});O.append("text").text("Flips").attr("x",-I/2).attr("y",0).style("text-anchor","middle").style("font-style","italic");var P=["Flip "+f,"Flip "+e],Q=[e,f],R=z.selectAll(".morphbutton").data(P).enter().append("g").attr("class",function(a,b){return"morphbutton"+b}).attr("transform",function(a,b){var d=n-I+18,e=20*c[0].values.length+21*b+90;return"translate("+d+","+e+")"});R.append("rect").attr("width",I).attr("height",J).attr("rx","5").attr("ry","5").style("fill","#C0C0C0").on("mousedown",function(){d3.select(this).style("fill","darkgrey")}).on("mouseout",function(){d3.select(this).style("fill","#C0C0C0")}).on("mouseup",function(){d3.select(this).style("fill","#C0C0C0")}),R.append("text").text(function(a){return a}).classed("morphtext",!0).attr("x",I/2).attr("y",15).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").style("text-anchor","middle").style("fill","white").style("pointer-events","none").style("font-size","1px").style("font-size",function(a){var b=this.getBBox(),e=(b.width,b.height,Math.min(I/(b.width+1),J/b.height,16));return e+"px"});var S=z.append("g").attr("class","redrawtitle").attr("transform",function(){var a=n+18,b=20*c[0].values[0].values.length+21*P.length+125;return"translate("+a+","+b+")"});S.append("text").text("X axis factor").attr("x",-I/2).attr("y",0).style("text-anchor","middle").style("font-style","italic");var T=z.selectAll(".morphbutton_2_").data(Q).enter().append("g").attr("class",function(a,b){return"morphbutton_2_"+b}).attr("transform",function(a,b){var d=n-I+18,e=20*c[0].values[0].values.length+21*P.length+21*b+130;return"translate("+d+","+e+")"});T.append("rect").attr("width",I).attr("height",J).attr("rx","5").attr("ry","5").style("fill","#C0C0C0").on("mousedown",function(){d3.select(this).style("fill","darkgrey")}).on("mouseout",function(){d3.select(this).style("fill","#C0C0C0")}).on("mouseup",function(){d3.select(this).style("fill","#C0C0C0")}),T.append("text").text(function(a){return a}).classed("morphtext2",!0).attr("x",I/2).attr("y",15).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").style("text-anchor","middle").style("fill","white").style("pointer-events","none").style("font-size","1px").style("font-size",function(a){var b=this.getBBox(),e=(b.width,b.height,Math.min(I/(b.width+2),J/b.height,16));return e+"px"}),K(".morphtext",I-5,16),K(".morphtext2",I-5,16),R.filter(function(a,b){return"morphbutton0"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==D&&(D=1,0==A?(t.rangeRoundBands([s.rangeBand(),0]),A=1):1==A&&(t.rangeRoundBands([0,s.rangeBand()]),A=0),g.selectAll("rect").data(function(a){return a.values}).transition().attr("width",t.rangeBand()).attr("x",function(a){return t(a.key)}).attr("y",function(a){return u(Math.max(0,a.values[0][d]))}).attr("height",function(a){return Math.abs(u(a.values[0][d])-u(0))}).style("fill",function(a){return v(a.key)}),g.selectAll(".errorbars").data(function(a){return a.values}).transition().attr("transform",function(a){var b=t(a.key)+t.rangeBand()/2;return"translate("+b+", 0 )"}).each("end",function(){D=0}))}),R.filter(function(a,b){return"morphbutton1"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==D&&(D=1,0==B?(s.rangeRoundBands([m,0],p),B=1):1==B&&(s.rangeRoundBands([0,m],p),B=0),z.select("g.x.x0.axis").transition().call(x),z.selectAll("g.factor1group").data(c).transition().attr("transform",function(a){return"translate("+s(a.key)+",0)"}),setTimeout(function(){D=0},500))}),T.on("click",function(){"morphbutton_2_0"==d3.select(this).attr("class")&&(F=1,G=e,H=f),"morphbutton_2_1"==d3.select(this).attr("class")&&(F=2,G=f,H=e),0==D&&E!==F&&(D=1,E=F,A=0,B=0,U(G,H))})})}function hibars3(a){function P(a,b,c,d){var e=[];D.selectAll(a).style("font-size","1px").style("font-size",function(){var a=this.getBBox(),d=Math.min(b/a.width,c);e.push(d)}).style("font-size",function(){return d?Math.max(d3.min(e),d)+"px":d3.min(e)+"px"})}var t,K,L,M,b="#"+a.location,c=a.datafile,d=a.dependent,e=a.factor1,f=a.factor2,g=a.factor3,h=a.chartwidth||800,l=a.chartheight||500,m=a.colorscheme||colorpalettes.defaultcolors,n={top:20,right:20,bottom:60,left:65,legend:.15*h},o=h-n.left-n.right-n.legend,p=h-n.left-n.right,q=l-n.top-n.bottom,r=.1,s=.1,u=d3.scale.ordinal().rangeRoundBands([0,o],r),v=d3.scale.ordinal(),w=d3.scale.ordinal(),x=d3.scale.linear().range([q,0]),y=d3.scale.ordinal().range(function(){return m[t]||colorpalettes.defaultcolors[t]}()),z=2,A=d3.svg.axis().scale(u).orient("bottom").tickSize(0).tickPadding(2*n.bottom/3),B=d3.svg.axis().orient("bottom").tickSize(0).tickPadding(1*n.bottom/5),C=d3.svg.axis().scale(x).orient("left").innerTickSize(-o).outerTickSize(0).tickPadding(10),D=d3.select(b).style("text-align","center").append("svg").attr("width",o+n.left+n.right+n.legend).attr("height",q+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")"),E=0,F=0,G=0,H=0,I=1,J=1,N=.15*h,O=20;d3.csv(c,function(a,b){function ba(a,e,f){for(c=d3.nest().key(function(b){return b[a]}).key(function(a){return a[e]}).key(function(a){return a[f]}).entries(b),i=0;i<c.length;i++)for(j=0;j<c[i].values.length;j++)for(k=0;k<c[i].values[j].values.length;k++)c[i].values[j].values[k].values[0].stderror=+c[i].values[j].values[k].values[0].stderror,c[i].values[j].values[k].values[0][d]=+c[i].values[j].values[k].values[0][d];u.domain(c.map(function(a){return a.key})).rangeRoundBands([0,o],r),v.domain(c[0].values.map(function(a){return a.key})).rangeRoundBands([0,u.rangeBand()],s),w.domain(c[0].values[0].values.map(function(a){return a.key})).rangeRoundBands([0,v.rangeBand()]),t=c[0].values[0].values.length,y.domain(c[0].values[0].values.map(function(a){return a.key})),y.range(function(){return m[t]||colorpalettes.defaultcolors[t]}()),D.selectAll(".databar").transition().duration(500).attr("y",1e3).transition().remove(),D.selectAll(".errorline").transition().duration(500).attr("y1",1e3).attr("y2",1e3).transition().remove(),setTimeout(function(){A.scale(u),B.scale(v),D.select(".x.axis").call(A),h=h.data([]).exit().remove(),l=l.data([]).exit().remove(),h=D.selectAll(".factor1group").data(c).enter().append("g").attr("class","factor1group").attr("transform",function(a){return"translate("+u(a.key)+",0)"}),h.append("g").attr("class","x1 axis").attr("transform","translate(0,"+q+")").call(B).style("font-size","12px"),l=D.selectAll(".axisticks1").data(c).enter().append("g").attr("class","axisticks1").attr("transform",function(a){return"translate("+u(a.key)+",0)"}),l.filter(function(a,b){return b<c.length-1}).append("line").attr("class","group1tick").attr("x1",u.rangeBand()/2+u.rangeBand()/(2-2*r)).attr("y1",q).attr("x2",u.rangeBand()/2+u.rangeBand()/(2-2*r)).attr("y2",q+n.bottom).attr("stroke","black").attr("stroke-width",1),Q=h.selectAll(".factor2group").data(function(a){return a.values}).enter().append("g").attr("class","factor2group").attr("transform",function(a){return"translate("+v(a.key)+",0)"}),R=l.selectAll(".axisticks2").data(function(a){return a.values}).enter().append("g").attr("class","axisticks2").attr("transform",function(a){return"translate("+v(a.key)+",0)"}),R.filter(function(a,b){return b<c[0].values.length-1}).append("line").attr("class","group2tick").attr("x1",v.rangeBand()/2+v.rangeBand()/(2-2*s)).attr("y1",q).attr("x2",v.rangeBand()/2+v.rangeBand()/(2-2*s)).attr("y2",q+n.bottom/3).attr("stroke","black").attr("stroke-width",1),P(".x0.axis text",u.rangeBand(),16),P(".x1.axis text",v.rangeBand(),12),D.select("g.x.x0.axis").call(A),h.call(B),S=Q.selectAll("rect").data(function(a){return a.values}).enter().append("rect").attr("class","databar").attr("width",w.rangeBand()).attr("height",function(a){return Math.abs(x(a.values[0][d])-x(0))}).style("fill",function(a){return y(a.key)}).attr("x",function(a){return w(a.key)}).attr("y",q).transition().duration(500).attr("y",function(a){return x(Math.max(0,a.values[0][d]))}),Q.selectAll("rect").on("mouseover",function(a){var b=d3.transform(d3.select(this.parentNode).attr("transform")),c=b.translate[0],e=d3.transform(d3.select(this.parentNode.parentNode).attr("transform")),f=e.translate[0],g=parseFloat(d3.select(this).attr("x"))+c+f+w.rangeBand()/2;if(a.values[0][d]>=0)var h=parseFloat(d3.select(this).attr("y"))+1*parseFloat(d3.select(this).attr("height"))/4;else if(a.values[0][d]<0)var h=x(0)+3*parseFloat(d3.select(this).attr("height"))/4;D.append("circle").attr("class","tooltip").attr("r",Math.max(w.rangeBand()/3,20)).attr("cx",g).attr("cy",h).style("fill","aliceblue").style("pointer-events","none").style("stroke","black").style("stroke-width","1px").style("stroke-opacity",.8).attr("fill-opacity",.8),D.append("text").attr("class","tooltip").attr("x",g).attr("y",h).attr("dy","5px").attr("text-anchor","middle").attr("font-size","11px").attr("font-weight","bold").attr("fill","black").style("pointer-events","none").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").text(a.values[0][d]),P("text.tooltip",Math.max(.5*w.rangeBand()-1,35),16,12)}).on("mouseout",function(){d3.selectAll(".tooltip").transition().duration(100).attr("fill-opacity",0).style("stroke-opacity",0).remove()}),T=Q.selectAll(".errorbars").data(function(a){return a.values}).enter().append("g").attr("class","errorbars").style("pointer-events","none").attr("transform",function(a){var b=w(a.key)+w.rangeBand()/2;return"translate("+b+", 0 )"}),T.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",z).attr("x1",0).attr("y1",q).attr("x2",0).attr("y2",q).transition().duration(500).attr("x1",0).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return x(b)}).attr("x2",0).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return x(b)}),T.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",z).attr("x1",-w.rangeBand()/4).attr("y1",q).attr("x2",w.rangeBand()/4).attr("y2",q).transition().duration(500).attr("x1",-w.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return x(b)}).attr("x2",w.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]+a.values[0].stderror;return x(b)}).attr("stroke","black").attr("stroke-width",z),T.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",z).attr("x1",-w.rangeBand()/4).attr("y1",q).attr("x2",w.rangeBand()/4).attr("y2",q).transition().duration(500).attr("x1",-w.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]-a.values[0].stderror;return x(b)}).attr("x2",w.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return x(b)}).attr("stroke","black").attr("stroke-width",z),U.data([]).exit().remove(),U=D.selectAll(".legend").data(c[0].values[0].values).enter().append("g").attr("class","legend").attr("transform",function(a,b){var c=20*b+20;return"translate(0,"+c+")"}),U.append("rect").transition().attr("x",p).attr("width",18).attr("height",18).style("fill",function(a){return y(a.key)}),U.append("text").transition().attr("x",p-6).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){return a.key}),V.text(f),W.transition().attr("transform",function(){var a=p+18,b=20*c[0].values[0].values.length+60;return"translate("+a+","+b+")"}),X.transition().attr("transform",function(){var a=p+18,b=20*c[0].values[0].values.length+85;return"translate("+a+","+b+")"}),$.transition().attr("transform",function(a,b){var d=p-N+18,e=20*c[0].values[0].values.length+21*b+90;return"translate("+d+","+e+")"}),_.transition().attr("transform",function(){var a=p+18,b=20*c[0].values[0].values.length+21*Y.length+125;return"translate("+a+","+b+")"}),aa.transition().attr("transform",function(a,b){var d=p-N+18,e=20*c[0].values[0].values.length+21*Y.length+21*b+130;return"translate("+d+","+e+")"}),$.filter(function(a,b){return"morphbutton0"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+f),$.filter(function(a,b){return"morphbutton1"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+e),$.filter(function(a,b){return"morphbutton2"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+a),H=0},500)}if(a)throw a;var c=d3.nest().key(function(a){return a[e]}).key(function(a){return a[f]}).key(function(a){return a[g]}).entries(b);for(i=0;i<c.length;i++)for(j=0;j<c[i].values.length;j++)for(k=0;k<c[i].values[j].values.length;k++)c[i].values[j].values[k].values[0].stderror=+c[i].values[j].values[k].values[0].stderror,c[i].values[j].values[k].values[0][d]=+c[i].values[j].values[k].values[0][d];u.domain(c.map(function(a){return a.key})),v.domain(c[0].values.map(function(a){return a.key})).rangeRoundBands([0,u.rangeBand()],s),w.domain(c[0].values[0].values.map(function(a){return a.key})).rangeRoundBands([0,v.rangeBand()]),B.scale(v),t=c[0].values[0].values.length,y.range(function(){return m[t]||colorpalettes.defaultcolors[t]}()),x.domain([Math.min(0,d3.min(c,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return a[d]-a.stderror})})})})),Math.max(0,d3.max(c,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return a[d]+a.stderror})})})}))]).nice(),D.append("g").attr("class","x x0 axis").attr("transform","translate(0,"+q+")").call(A),D.append("g").attr("class","y axis").call(C).append("text").attr("transform","rotate(-90)").attr("x",-q/2).attr("y",-n.left).attr("dy",".71em").style("text-anchor","middle").style("font-size","20px").text(d),x.domain()[0]<0&&x.domain()[1]>0&&D.append("g").attr("class","x axis").append("line").attr("x1",0).attr("y1",x(0)).attr("x2",o).attr("y2",x(0));var h=D.selectAll(".factor1group").data(c).enter().append("g").attr("class","factor1group").attr("transform",function(a){return"translate("+u(a.key)+",0)"});h.append("g").attr("class","x1 axis").attr("transform","translate(0,"+q+")").call(B).style("font-size","12px");var l=D.selectAll(".axisticks1").data(c).enter().append("g").attr("class","axisticks1").attr("transform",function(a){return"translate("+u(a.key)+",0)"});l.filter(function(a,b){return b<c.length-1}).append("line").attr("class","group1tick").attr("x1",u.rangeBand()/2+u.rangeBand()/(2-2*r)).attr("y1",q).attr("x2",u.rangeBand()/2+u.rangeBand()/(2-2*r)).attr("y2",q+n.bottom).attr("stroke","black").attr("stroke-width",1);var Q=h.selectAll(".factor2group").data(function(a){return a.values}).enter().append("g").attr("class","factor2group").attr("transform",function(a){return"translate("+v(a.key)+",0)"}),R=l.selectAll(".axisticks2").data(function(a){return a.values}).enter().append("g").attr("class","axisticks2").attr("transform",function(a){return"translate("+v(a.key)+",0)"});R.filter(function(a,b){return b<c[0].values.length-1}).append("line").attr("class","group2tick").attr("x1",v.rangeBand()/2+v.rangeBand()/(2-2*s)).attr("y1",q).attr("x2",v.rangeBand()/2+v.rangeBand()/(2-2*s)).attr("y2",q+n.bottom/3).attr("stroke","black").attr("stroke-width",1),P(".x0.axis text",u.rangeBand(),16),P(".x1.axis text",v.rangeBand(),12),D.select("g.x.x0.axis").call(A),h.call(B),D.selectAll(".axis line").style({fill:"none",stroke:"#000","shape-rendering":"crispEdges"}),D.selectAll(".axis path").style({fill:"none",stroke:"#000","shape-rendering":"crispEdges"}),D.selectAll(".tick line").style("opacity","0.2"),D.selectAll(".x.axis path").style("display","inline-block");var S=Q.selectAll("rect").data(function(a){return a.values}).enter().append("rect").attr("class","databar").attr("width",w.rangeBand()).attr("height",function(a){return Math.abs(x(a.values[0][d])-x(0))}).style("fill",function(a){return y(a.key)}).attr("x",function(a){return w(a.key)}).attr("y",q).transition().duration(500).attr("y",function(a){return x(Math.max(0,a.values[0][d]))});Q.selectAll("rect").on("mouseover",function(a){var b=d3.transform(d3.select(this.parentNode).attr("transform")),c=b.translate[0],e=d3.transform(d3.select(this.parentNode.parentNode).attr("transform")),f=e.translate[0],g=parseFloat(d3.select(this).attr("x"))+c+f+w.rangeBand()/2;if(a.values[0][d]>=0)var h=parseFloat(d3.select(this).attr("y"))+1*parseFloat(d3.select(this).attr("height"))/4;else if(a.values[0][d]<0)var h=x(0)+3*parseFloat(d3.select(this).attr("height"))/4;D.append("circle").attr("class","tooltip").attr("r",Math.max(w.rangeBand()/3,20)).attr("cx",g).attr("cy",h).style("fill","aliceblue").style("pointer-events","none").style("stroke","black").style("stroke-width","1px").style("stroke-opacity",.8).attr("fill-opacity",.8),D.append("text").attr("class","tooltip").attr("x",g).attr("y",h).attr("dy","5px").attr("text-anchor","middle").attr("font-weight","bold").attr("fill","black").style("pointer-events","none").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").text(a.values[0][d]),P("text.tooltip",Math.max(.5*w.rangeBand()-1,35),16,12)}).on("mouseout",function(){d3.selectAll(".tooltip").transition().duration(100).attr("fill-opacity",0).style("stroke-opacity",0).remove()});var T=Q.selectAll(".errorbars").data(function(a){return a.values}).enter().append("g").attr("class","errorbars").style("pointer-events","none").attr("transform",function(a){var b=w(a.key)+w.rangeBand()/2;return"translate("+b+", 0 )"});T.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",z).attr("x1",0).attr("y1",q).attr("x2",0).attr("y2",q).transition().duration(500).attr("x1",0).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return x(b)}).attr("x2",0).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return x(b)}),T.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",z).attr("x1",-w.rangeBand()/4).attr("y1",q).attr("x2",w.rangeBand()/4).attr("y2",q).transition().duration(500).attr("x1",-w.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return x(b)}).attr("x2",w.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]+a.values[0].stderror;return x(b)}).attr("stroke","black").attr("stroke-width",z),T.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",z).attr("x1",-w.rangeBand()/4).attr("y1",q).attr("x2",w.rangeBand()/4).attr("y2",q).transition().duration(500).attr("x1",-w.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]-a.values[0].stderror;return x(b)}).attr("x2",w.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return x(b)}).attr("stroke","black").attr("stroke-width",z);var U=D.selectAll(".legend").data(c[0].values[0].values).enter().append("g").attr("class","legend").attr("transform",function(a,b){var c=20*b+20;return"translate(0,"+c+")"});U.append("rect").attr("x",p).attr("width",18).attr("height",18).style("fill",function(a){return y(a.key)}),U.append("text").attr("x",p-6).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){
return a.key});var V=D.append("g").attr("transform",function(){var a=p+18;return"translate("+a+",8)"}).append("text").attr("class","legendtitle").style("font-weight","bold").text(g).attr("x",0).attr("y",0).style("text-anchor","end"),W=D.append("g").attr("class","axiscontrolstitle").attr("transform",function(){var a=p+18,b=20*c[0].values[0].values.length+60;return"translate("+a+","+b+")"});W.append("text").text("X axis controls").attr("x",-N/2).attr("y",0).style("fill","steelblue").style("text-anchor","middle").style("font-weight","bold");var X=D.append("g").attr("class","fliptitle").attr("transform",function(){var a=p+18,b=20*c[0].values[0].values.length+85;return"translate("+a+","+b+")"});X.append("text").text("Flips").attr("x",-N/2).attr("y",0).style("text-anchor","middle").style("font-style","italic");var Y=["Flip "+g,"Flip "+f,"Flip "+e],Z=[e+","+f,e+","+g,f+","+e,g+","+e,f+","+g,g+","+f],$=D.selectAll(".morphbutton").data(Y).enter().append("g").attr("class",function(a,b){return"morphbutton"+b}).attr("transform",function(a,b){var d=p-N+18,e=20*c[0].values[0].values.length+21*b+90;return"translate("+d+","+e+")"});$.append("rect").attr("width",N).attr("height",O).attr("rx","5").attr("ry","5").style("fill","#C0C0C0").on("mousedown",function(){d3.select(this).style("fill","darkgrey")}).on("mouseout",function(){d3.select(this).style("fill","#C0C0C0")}).on("mouseup",function(){d3.select(this).style("fill","#C0C0C0")}),$.append("text").text(function(a){return a}).classed("morphtext",!0).attr("x",N/2).attr("y",15).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").style("text-anchor","middle").style("fill","white").style("pointer-events","none").style("font-size","1px").style("font-size",function(a){var b=this.getBBox(),e=(b.width,b.height,Math.min(N/(b.width+1),O/b.height,16));return e+"px"});var _=D.append("g").attr("class","redrawtitle").attr("transform",function(){var a=p+18,b=20*c[0].values[0].values.length+21*Y.length+125;return"translate("+a+","+b+")"});_.append("text").text("X axis factors").attr("x",-N/2).attr("y",0).style("text-anchor","middle").style("font-style","italic");var aa=D.selectAll(".morphbutton_2_").data(Z).enter().append("g").attr("class",function(a,b){return"morphbutton_2_"+b}).attr("transform",function(a,b){var d=p-N+18,e=20*c[0].values[0].values.length+21*Y.length+21*b+130;return"translate("+d+","+e+")"});aa.append("rect").attr("width",N).attr("height",O).attr("rx","5").attr("ry","5").style("fill","#C0C0C0").on("mousedown",function(){d3.select(this).style("fill","darkgrey")}).on("mouseout",function(){d3.select(this).style("fill","#C0C0C0")}).on("mouseup",function(){d3.select(this).style("fill","#C0C0C0")}),aa.append("text").text(function(a){return a}).classed("morphtext2",!0).attr("x",N/2).attr("y",15).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").style("text-anchor","middle").style("fill","white").style("pointer-events","none").style("font-size","1px").style("font-size",function(a){var b=this.getBBox(),e=(b.width,b.height,Math.min(N/(b.width+2),O/b.height,16));return e+"px"}),P(".morphtext",N-5,16),P(".morphtext2",N-5,16),$.filter(function(a,b){return"morphbutton0"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==H&&(H=1,0==E?(w.rangeRoundBands([v.rangeBand(),0]),E=1):1==E&&(w.rangeRoundBands([0,v.rangeBand()]),E=0),Q.selectAll("rect").data(function(a){return a.values}).transition().attr("width",w.rangeBand()).attr("x",function(a){return w(a.key)}).attr("y",function(a){return x(Math.max(0,a.values[0][d]))}).attr("height",function(a){return Math.abs(x(a.values[0][d])-x(0))}).style("fill",function(a){return y(a.key)}),Q.selectAll(".errorbars").data(function(a){return a.values}).transition().attr("transform",function(a){var b=w(a.key)+w.rangeBand()/2;return"translate("+b+", 0 )"}).each("end",function(){H=0}))}),$.filter(function(a,b){return"morphbutton1"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==H&&(H=1,0==F?(v.rangeRoundBands([u.rangeBand(),0],s),F=1):1==F&&(v.rangeRoundBands([0,u.rangeBand()],s),F=0),h.selectAll(".x1.axis").transition().call(B),h.selectAll("g.factor2group").data(function(a){return a.values}).transition().attr("transform",function(a){return"translate("+v(a.key)+",0)"}),setTimeout(function(){H=0},500))}),$.filter(function(a,b){return"morphbutton2"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==H&&(H=1,0==G?(u.rangeRoundBands([o,0],r),G=1):1==G&&(u.rangeRoundBands([0,o],r),G=0),D.select("g.x.x0.axis").transition().call(A),D.selectAll("g.factor1group").data(c).transition().attr("transform",function(a){return"translate("+u(a.key)+",0)"}),setTimeout(function(){H=0},500))}),aa.on("click",function(){"morphbutton_2_0"==d3.select(this).attr("class")&&(J=1,K=e,L=f,M=g),"morphbutton_2_1"==d3.select(this).attr("class")&&(J=2,K=e,L=g,M=f),"morphbutton_2_2"==d3.select(this).attr("class")&&(J=3,K=f,L=e,M=g),"morphbutton_2_3"==d3.select(this).attr("class")&&(J=4,K=g,L=e,M=f),"morphbutton_2_4"==d3.select(this).attr("class")&&(J=5,K=f,L=g,M=e),"morphbutton_2_5"==d3.select(this).attr("class")&&(J=6,K=g,L=f,M=e),0==H&&I!==J&&(H=1,I=J,E=0,F=0,G=0,ba(K,L,M))})})}function hibars4(a){function W(a,b,c,d){var e=[];I.selectAll(a).style("font-size","1px").style("font-size",function(){var a=this.getBBox(),d=Math.min(b/a.width,c);e.push(d)}).style("font-size",function(){return d?Math.max(d3.min(e),d)+"px":d3.min(e)+"px"})}var w,b="#"+a.location,c=a.datafile,d=a.dependent,e=a.factor1,f=a.factor2,g=a.factor3,h=a.factor4,m=a.chartwidth||800,n=a.chartheight||500,o=a.colorscheme||colorpalettes.defaultcolors,p={top:20,right:20,bottom:60,left:65,legend:.15*m},q=m-p.left-p.right-p.legend,r=m-p.left-p.right,s=n-p.top-p.bottom,t=.05,u=.1,v=.1,x=d3.scale.ordinal().rangeRoundBands([0,q],t),y=d3.scale.ordinal(),z=d3.scale.ordinal(),A=d3.scale.ordinal(),B=d3.scale.linear().range([s,0]),C=d3.scale.ordinal().range(function(){return o[w]||colorpalettes.defaultcolors[w]}()),D=2,E=d3.svg.axis().scale(x).orient("bottom").tickSize(0).tickPadding(3*p.bottom/5),F=d3.svg.axis().orient("bottom").tickSize(0).tickPadding(1*p.bottom/3),G=d3.svg.axis().orient("bottom").tickSize(0).tickPadding(1*p.bottom/8),H=d3.svg.axis().scale(B).orient("left").innerTickSize(-q).outerTickSize(0).tickPadding(10),I=d3.select(b).style("text-align","center").append("svg").attr("width",q+p.left+p.right+p.legend).attr("height",s+p.top+p.bottom).append("g").attr("transform","translate("+p.left+","+p.top+")"),J=0,K=0,L=0,M=0,N=0,U=.15*m,V=20;d3.csv(c,function(a,c){function fa(){var a=d3.event.target.value,b=a.split(",");0==N&&(N=1,J=0,K=0,L=0,M=0,ga(b[0],b[1],b[2],b[3]))}function ga(a,b,e,f){for(m=d3.nest().key(function(b){return b[a]}).key(function(a){return a[b]}).key(function(a){return a[e]}).key(function(a){return a[f]}).entries(c),i=0;i<m.length;i++)for(j=0;j<m[i].values.length;j++)for(k=0;k<m[i].values[j].values.length;k++)for(l=0;l<m[i].values[j].values[k].values.length;l++)m[i].values[j].values[k].values[l].values[0].stderror=+m[i].values[j].values[k].values[l].values[0].stderror,m[i].values[j].values[k].values[l].values[0][d]=+m[i].values[j].values[k].values[l].values[0][d];x.domain(m.map(function(a){return a.key})).rangeRoundBands([0,q],t),y.domain(m[0].values.map(function(a){return a.key})).rangeRoundBands([0,x.rangeBand()],u),z.domain(m[0].values[0].values.map(function(a){return a.key})).rangeRoundBands([0,y.rangeBand()],v),A.domain(m[0].values[0].values[0].values.map(function(a){return a.key})).rangeRoundBands([0,z.rangeBand()]),w=m[0].values[0].values[0].values.length,C.range(function(){return o[w]||colorpalettes.defaultcolors[w]}()),C.domain(m[0].values[0].values[0].values.map(function(a){return a.key})),I.selectAll(".databar").transition().duration(500).attr("y",1e3).transition().remove(),I.selectAll(".errorline").transition().duration(500).attr("y1",1e3).attr("y2",1e3).transition().remove(),setTimeout(function(){E.scale(x),F.scale(y),G.scale(z),I.select(".x.axis").call(E),n=n.data([]).exit().remove(),O=O.data([]).exit().remove(),n=I.selectAll(".factor1group").data(m).enter().append("g").attr("class","factor1group").attr("transform",function(a){return"translate("+x(a.key)+",0)"}),n.append("g").attr("class","x1 axis").attr("transform","translate(0,"+s+")").call(F).style("font-size","12px"),O=I.selectAll(".axisticks1").data(m).enter().append("g").attr("class","axisticks1").attr("transform",function(a){return"translate("+x(a.key)+",0)"}),O.filter(function(a,b){return b<m.length-1}).append("line").attr("class","group1tick").attr("x1",x.rangeBand()/2+x.rangeBand()/(2-2*t)).attr("y1",s).attr("x2",x.rangeBand()/2+x.rangeBand()/(2-2*t)).attr("y2",s+p.bottom).attr("stroke","black").attr("stroke-width",1),P=n.selectAll(".factor2group").data(function(a){return a.values}).enter().append("g").attr("class","factor2group").attr("transform",function(a){return"translate("+y(a.key)+",0)"}),Q=O.selectAll(".axisticks2").data(function(a){return a.values}).enter().append("g").attr("class","axisticks2").attr("transform",function(a){return"translate("+y(a.key)+",0)"}),Q.filter(function(a,b){return b<m[0].values.length-1}).append("line").attr("class","group2tick").attr("x1",y.rangeBand()/2+y.rangeBand()/(2-2*u)).attr("y1",s).attr("x2",y.rangeBand()/2+y.rangeBand()/(2-2*u)).attr("y2",s+p.bottom/3).attr("stroke","black").attr("stroke-width",1),R=P.selectAll(".factor3group").data(function(a){return a.values}).enter().append("g").attr("class","factor3group").attr("transform",function(a){return"translate("+z(a.key)+",0)"}),S=Q.selectAll(".axisticks3").data(function(a){return a.values}).enter().append("g").attr("class","axisticks3").attr("transform",function(a){return"translate("+z(a.key)+",0)"}),S.filter(function(a,b){return b<m[0].values[0].values.length-1}).append("line").attr("class","group3tick").attr("x1",z.rangeBand()/2+z.rangeBand()/(2-2*v)).attr("y1",s).attr("x2",z.rangeBand()/2+z.rangeBand()/(2-2*v)).attr("y2",s+p.bottom/5).attr("stroke","black").attr("stroke-width",1),W(".x0.axis text",x.rangeBand(),16),W(".x1.axis text",y.rangeBand(),12),W(".x2.axis text",z.rangeBand(),10),I.select("g.x.x0.axis").call(E),n.call(F),P.append("g").attr("class","x2 axis").attr("transform","translate(0,"+s+")").call(G).style("font-size","10px").selectAll("text").style("text-anchor","middle"),W(".x2.axis text",z.rangeBand(),10),P.call(G),T=R.selectAll("rect").data(function(a){return a.values}).enter().append("rect").attr("class","databar").attr("width",A.rangeBand()).attr("height",function(a){return Math.abs(B(a.values[0][d])-B(0))}).style("fill",function(a){return C(a.key)}).attr("x",function(a){return A(a.key)}).attr("y",s).transition().duration(500).attr("y",function(a){return B(Math.max(0,a.values[0][d]))}),R.selectAll("rect").on("mouseover",function(a){var b=d3.transform(d3.select(this.parentNode).attr("transform")),c=b.translate[0],e=d3.transform(d3.select(this.parentNode.parentNode).attr("transform")),f=e.translate[0],g=d3.transform(d3.select(this.parentNode.parentNode.parentNode).attr("transform")),h=g.translate[0],i=parseFloat(d3.select(this).attr("x"))+c+f+h+A.rangeBand()/2;if(a.values[0][d]>=0)var j=parseFloat(d3.select(this).attr("y"))+1*parseFloat(d3.select(this).attr("height"))/4;else if(a.values[0][d]<0)var j=B(0)+3*parseFloat(d3.select(this).attr("height"))/4;I.append("circle").attr("class","tooltip").attr("r",Math.max(A.rangeBand()/3,20)).attr("cx",i).attr("cy",j).style("fill","aliceblue").style("pointer-events","none").style("stroke","black").style("stroke-width","1px").style("stroke-opacity",.8).attr("fill-opacity",.8),I.append("text").attr("class","tooltip").attr("x",i).attr("y",j).attr("dy","5px").attr("text-anchor","middle").attr("font-size","11px").attr("font-weight","bold").attr("fill","black").style("pointer-events","none").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").text(a.values[0][d]),W("text.tooltip",Math.max(.5*A.rangeBand()-1,35),16,12)}).on("mouseout",function(){d3.selectAll(".tooltip").transition().duration(100).attr("fill-opacity",0).style("stroke-opacity",0).remove()}),X=R.selectAll(".errorbars").data(function(a){return a.values}).enter().append("g").attr("class","errorbars").style("pointer-events","none").attr("transform",function(a){var b=A(a.key)+A.rangeBand()/2;return"translate("+b+", 0 )"}),X.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",D).attr("x1",0).attr("y1",s).attr("x2",0).attr("y2",s).transition().duration(500).attr("x1",0).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return B(b)}).attr("x2",0).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return B(b)}),X.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",D).attr("x1",-A.rangeBand()/4).attr("y1",s).attr("x2",A.rangeBand()/4).attr("y2",s).transition().duration(500).attr("x1",-A.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return B(b)}).attr("x2",A.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]+a.values[0].stderror;return B(b)}).attr("stroke","black").attr("stroke-width",D),X.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",D).attr("x1",-A.rangeBand()/4).attr("y1",s).attr("x2",A.rangeBand()/4).attr("y2",s).transition().duration(500).attr("x1",-A.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]-a.values[0].stderror;return B(b)}).attr("x2",A.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return B(b)}).attr("stroke","black").attr("stroke-width",D),Y.data([]).exit().remove(),Y=I.selectAll(".legend").data(m[0].values[0].values[0].values).enter().append("g").attr("class","legend").attr("transform",function(a,b){var c=20*b+20;return"translate(0,"+c+")"}),Y.append("rect").transition().attr("x",r).attr("width",18).attr("height",18).style("fill",function(a){return C(a.key)}),Y.append("text").transition().attr("x",r-6).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){return a.key}),Z.text(f),$.transition().attr("transform",function(){var a=r+18,b=20*m[0].values[0].values[0].values.length+60;return"translate("+a+","+b+")"}),ba.transition().attr("transform",function(a,b){var c=r-U+18,d=20*m[0].values[0].values[0].values.length+21*b+90;return"translate("+c+","+d+")"}),ca.transition().attr("transform",function(){var a=r+18,b=20*m[0].values[0].values[0].values.length+21*_.length+125;return"translate("+a+","+b+")"}),da.transition().attr("transform",function(){var a=r-U+18,b=20*m[0].values[0].values[0].values.length+21*_.length+130;return"translate("+a+","+b+")"}),ba.filter(function(a,b){return"morphbutton0"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+f),ba.filter(function(a,b){return"morphbutton1"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+e),ba.filter(function(a,b){return"morphbutton2"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+b),ba.filter(function(a,b){return"morphbutton3"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+a),N=0},500)}if(a)throw a;var m=d3.nest().key(function(a){return a[e]}).key(function(a){return a[f]}).key(function(a){return a[g]}).key(function(a){return a[h]}).entries(c);for(i=0;i<m.length;i++)for(j=0;j<m[i].values.length;j++)for(k=0;k<m[i].values[j].values.length;k++)for(l=0;l<m[i].values[j].values[k].values.length;l++)m[i].values[j].values[k].values[l].values[0].stderror=+m[i].values[j].values[k].values[l].values[0].stderror,m[i].values[j].values[k].values[l].values[0][d]=+m[i].values[j].values[k].values[l].values[0][d];x.domain(m.map(function(a){return a.key})),y.domain(m[0].values.map(function(a){return a.key})).rangeRoundBands([0,x.rangeBand()],u),z.domain(m[0].values[0].values.map(function(a){return a.key})).rangeRoundBands([0,y.rangeBand()],v),A.domain(m[0].values[0].values[0].values.map(function(a){return a.key})).rangeRoundBands([0,z.rangeBand()]),F.scale(y),G.scale(z),w=m[0].values[0].values[0].values.length,C.range(function(){return o[w]||colorpalettes.defaultcolors[w]}()),B.domain([Math.min(0,d3.min(m,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return a[d]-a.stderror})})})})})),Math.max(0,d3.max(m,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return a[d]+a.stderror})})})})}))]).nice(),I.append("g").attr("class","x x0 axis").attr("transform","translate(0,"+s+")").call(E),I.append("g").attr("class","y axis").call(H).append("text").attr("transform","rotate(-90)").attr("x",-s/2).attr("y",-p.left).attr("dy",".71em").style("text-anchor","middle").style("font-size","20px").text(d),B.domain()[0]<0&&B.domain()[1]>0&&I.append("g").attr("class","x axis").append("line").attr("x1",0).attr("y1",B(0)).attr("x2",q).attr("y2",B(0));var n=I.selectAll(".factor1group").data(m).enter().append("g").attr("class","factor1group").attr("transform",function(a){return"translate("+x(a.key)+",0)"});n.append("g").attr("class","x1 axis").attr("transform","translate(0,"+s+")").call(F).style("font-size","12px");var O=I.selectAll(".axisticks1").data(m).enter().append("g").attr("class","axisticks1").attr("transform",function(a){return"translate("+x(a.key)+",0)"});O.filter(function(a,b){return b<m.length-1}).append("line").attr("class","group1tick").attr("x1",x.rangeBand()/2+x.rangeBand()/(2-2*t)).attr("y1",s).attr("x2",x.rangeBand()/2+x.rangeBand()/(2-2*t)).attr("y2",s+p.bottom).attr("stroke","black").attr("stroke-width",1);var P=n.selectAll(".factor2group").data(function(a){return a.values}).enter().append("g").attr("class","factor2group").attr("transform",function(a){return"translate("+y(a.key)+",0)"}),Q=O.selectAll(".axisticks2").data(function(a){return a.values}).enter().append("g").attr("class","axisticks2").attr("transform",function(a){return"translate("+y(a.key)+",0)"});Q.filter(function(a,b){return b<m[0].values.length-1}).append("line").attr("class","group2tick").attr("x1",y.rangeBand()/2+y.rangeBand()/(2-2*u)).attr("y1",s).attr("x2",y.rangeBand()/2+y.rangeBand()/(2-2*u)).attr("y2",s+p.bottom/3).attr("stroke","black").attr("stroke-width",1);var R=P.selectAll(".factor3group").data(function(a){return a.values}).enter().append("g").attr("class","factor3group").attr("transform",function(a){return"translate("+z(a.key)+",0)"}),S=Q.selectAll(".axisticks3").data(function(a){return a.values}).enter().append("g").attr("class","axisticks3").attr("transform",function(a){return"translate("+z(a.key)+",0)"});S.filter(function(a,b){return b<m[0].values[0].values.length-1}).append("line").attr("class","group3tick").attr("x1",z.rangeBand()/2+z.rangeBand()/(2-2*v)).attr("y1",s).attr("x2",z.rangeBand()/2+z.rangeBand()/(2-2*v)).attr("y2",s+p.bottom/5).attr("stroke","black").attr("stroke-width",1),W(".x0.axis text",x.rangeBand(),16),W(".x1.axis text",y.rangeBand(),12),I.select("g.x.x0.axis").call(E),n.call(F),P.append("g").attr("class","x2 axis").attr("transform","translate(0,"+s+")").call(G).style("font-size","10px").selectAll("text").style("text-anchor","middle"),W(".x2.axis text",z.rangeBand(),10),P.call(G),I.selectAll(".axis line").style({fill:"none",stroke:"#000","shape-rendering":"crispEdges"}),I.selectAll(".axis path").style({fill:"none",stroke:"#000","shape-rendering":"crispEdges"}),I.selectAll(".tick line").style("opacity","0.2"),I.selectAll(".x.axis path").style("display","inline-block");var T=R.selectAll("rect").data(function(a){return a.values}).enter().append("rect").attr("class","databar").attr("width",A.rangeBand()).attr("height",function(a){return Math.abs(B(a.values[0][d])-B(0))}).style("fill",function(a){return C(a.key)}).attr("x",function(a){return A(a.key)}).attr("y",s).transition().duration(500).attr("y",function(a){return B(Math.max(0,a.values[0][d]))});R.selectAll("rect").on("mouseover",function(a){var b=d3.transform(d3.select(this.parentNode).attr("transform")),c=b.translate[0],e=d3.transform(d3.select(this.parentNode.parentNode).attr("transform")),f=e.translate[0],g=d3.transform(d3.select(this.parentNode.parentNode.parentNode).attr("transform")),h=g.translate[0],i=parseFloat(d3.select(this).attr("x"))+c+f+h+A.rangeBand()/2;if(a.values[0][d]>=0)var j=parseFloat(d3.select(this).attr("y"))+1*parseFloat(d3.select(this).attr("height"))/4;else if(a.values[0][d]<0)var j=B(0)+3*parseFloat(d3.select(this).attr("height"))/4;I.append("circle").attr("class","tooltip").attr("r",Math.max(A.rangeBand()/3,20)).attr("cx",i).attr("cy",j).style("fill","aliceblue").style("pointer-events","none").style("stroke","black").style("stroke-width","1px").style("stroke-opacity",.8).attr("fill-opacity",.8),I.append("text").attr("class","tooltip").attr("x",i).attr("y",j).attr("dy","5px").attr("text-anchor","middle").attr("font-size","11px").attr("font-weight","bold").attr("fill","black").style("pointer-events","none").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").text(a.values[0][d]),W("text.tooltip",Math.max(.5*A.rangeBand()-1,35),16,12)}).on("mouseout",function(){d3.selectAll(".tooltip").transition().duration(100).attr("fill-opacity",0).style("stroke-opacity",0).remove()});var X=R.selectAll(".errorbars").data(function(a){return a.values}).enter().append("g").attr("class","errorbars").style("pointer-events","none").attr("transform",function(a){var b=A(a.key)+A.rangeBand()/2;return"translate("+b+", 0 )"});X.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",D).attr("x1",0).attr("y1",s).attr("x2",0).attr("y2",s).transition().duration(500).attr("x1",0).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return B(b)}).attr("x2",0).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return B(b)}),X.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",D).attr("x1",-A.rangeBand()/4).attr("y1",s).attr("x2",A.rangeBand()/4).attr("y2",s).transition().duration(500).attr("x1",-A.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return B(b)}).attr("x2",A.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]+a.values[0].stderror;return B(b)}).attr("stroke","black").attr("stroke-width",D),X.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",D).attr("x1",-A.rangeBand()/4).attr("y1",s).attr("x2",A.rangeBand()/4).attr("y2",s).transition().duration(500).attr("x1",-A.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]-a.values[0].stderror;return B(b)}).attr("x2",A.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return B(b)}).attr("stroke","black").attr("stroke-width",D);var Y=I.selectAll(".legend").data(m[0].values[0].values[0].values).enter().append("g").attr("class","legend").attr("transform",function(a,b){var c=20*b+20;return"translate(0,"+c+")"});Y.append("rect").attr("x",r).attr("width",18).attr("height",18).style("fill",function(a){return C(a.key)}),Y.append("text").attr("x",r-6).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){return a.key});var Z=I.append("g").attr("transform",function(){var a=r+18;return"translate("+a+",8)"}).append("text").attr("class","legendtitle").style("font-weight","bold").text(h).attr("x",0).attr("y",0).style("text-anchor","end"),$=I.append("g").attr("class","axiscontrolstitle").attr("transform",function(){var a=r+18,b=20*m[0].values[0].values[0].values.length+60;return"translate("+a+","+b+")"});$.append("text").text("X axis Flips").attr("x",-U/2).attr("y",0).style("fill","steelblue").style("text-anchor","middle").style("font-weight","bold");var _=["Flip "+h,"Flip "+g,"Flip "+f,"Flip "+e],aa=[e+","+f+","+g+","+h,e+","+f+","+h+","+g,e+","+g+","+f+","+h,e+","+g+","+h+","+f,e+","+h+","+f+","+g,e+","+h+","+g+","+f,f+","+e+","+g+","+h,f+","+e+","+h+","+g,f+","+g+","+e+","+h,f+","+g+","+h+","+e,f+","+h+","+e+","+g,f+","+h+","+g+","+e,g+","+e+","+f+","+h,g+","+e+","+h+","+f,g+","+f+","+e+","+h,g+","+f+","+h+","+e,g+","+h+","+e+","+f,g+","+h+","+f+","+e,h+","+e+","+f+","+g,h+","+e+","+g+","+f,h+","+f+","+e+","+g,h+","+f+","+g+","+e,h+","+g+","+e+","+f,h+","+g+","+f+","+e],ba=I.selectAll(".morphbutton").data(_).enter().append("g").attr("class",function(a,b){return"morphbutton"+b}).attr("transform",function(a,b){var c=r-U+18,d=20*m[0].values[0].values[0].values.length+21*b+90;return"translate("+c+","+d+")"});ba.append("rect").attr("width",U).attr("height",V).attr("rx","5").attr("ry","5").style("fill","#C0C0C0").on("mousedown",function(){d3.select(this).style("fill","darkgrey")}).on("mouseout",function(){d3.select(this).style("fill","#C0C0C0")}).on("mouseup",function(){d3.select(this).style("fill","#C0C0C0")}),ba.append("text").text(function(a){return a}).classed("morphtext",!0).attr("x",U/2).attr("y",15).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").style("text-anchor","middle").style("fill","white").style("pointer-events","none").style("font-size","1px").style("font-size",function(a){var b=this.getBBox(),e=(b.width,b.height,Math.min(U/(b.width+1),V/b.height,16));return e+"px"});var ca=d3.select(b).append("div").text("Factor Hierarchy (last is legend)").style("font-style","italic").style("color","steelblue"),da=d3.select(b).append("select").attr("class","select").attr("name","redrawlist").attr("transform",function(){var a=r-U+18,b=20*m[0].values[0].values[0].values.length+21*_.length+130;return"translate("+a+","+b+")"}),ea=da.selectAll("option").data(aa).enter().append("option");ea.text(function(a){return a}).attr("value",function(a){return a}).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").style("font-size","12px"),W(".morphtext",U-5,16),ba.filter(function(a,b){return"morphbutton0"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==N&&(N=1,0==J?(A.rangeRoundBands([z.rangeBand(),0]),J=1):1==J&&(A.rangeRoundBands([0,z.rangeBand()]),J=0),R.selectAll("rect").data(function(a){return a.values}).transition().attr("width",A.rangeBand()).attr("x",function(a){return A(a.key)}).attr("y",function(a){return B(Math.max(0,a.values[0][d]))}).attr("height",function(a){return Math.abs(B(a.values[0][d])-B(0))}).style("fill",function(a){return C(a.key)}),R.selectAll(".errorbars").data(function(a){return a.values}).transition().attr("transform",function(a){var b=A(a.key)+A.rangeBand()/2;return"translate("+b+", 0 )"}).each("end",function(){N=0}))}),ba.filter(function(a,b){return"morphbutton1"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==N&&(N=1,0==K?(z.rangeRoundBands([y.rangeBand(),0],v),K=1):1==K&&(z.rangeRoundBands([0,y.rangeBand()],v),K=0),P.selectAll(".x2.axis").transition().call(G),P.selectAll("g.factor3group").data(function(a){return a.values}).transition().attr("transform",function(a){return"translate("+z(a.key)+",0)"}),setTimeout(function(){N=0},500))}),ba.filter(function(a,b){return"morphbutton2"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==N&&(N=1,0==L?(y.rangeRoundBands([x.rangeBand(),0],u),L=1):1==L&&(y.rangeRoundBands([0,x.rangeBand()],u),L=0),n.selectAll(".x1.axis").transition().call(F),n.selectAll("g.factor2group").data(function(a){return a.values}).transition().attr("transform",function(a){return"translate("+y(a.key)+",0)"}),setTimeout(function(){N=0},500))}),ba.filter(function(a,b){return"morphbutton3"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==N&&(N=1,0==M?(x.rangeRoundBands([q,0],t),M=1):1==M&&(x.rangeRoundBands([0,q],t),M=0),I.select("g.x.x0.axis").transition().call(E),I.selectAll("g.factor1group").data(m).transition().attr("transform",function(a){return"translate("+x(a.key)+",0)"}),setTimeout(function(){N=0},500))}),da.on("change",fa)})}var colorpalettes={defaultcolors:{1:["#5DA5DA"],2:["#5DA5DA","#60BD68"],3:["#5DA5DA","#60BD68","#F15854"],4:["#5DA5DA","#F15854","#60BD68","#845C59"],5:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A"],6:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E"],7:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E","#F17CB0"],8:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E","#F17CB0","#DECF3F"],9:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E","#F17CB0","#DECF3F","#B276B2"],10:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E","#F17CB0","#DECF3F","#B276B2","#C2D580"]}};