function hibars2(a){function J(a,b,c,d){var e=[];y.selectAll(a).style("font-size","1px").style("font-size",function(){var a=this.getBBox(),d=Math.min(b/a.width,c);e.push(d)}).style("font-size",function(){return d?Math.max(d3.min(e),d)+"px":d3.min(e)+"px"})}var q,F,G,b="#"+a.location,c=a.datafile,d=a.dependent,e=a.factor1,f=a.factor2,g=a.chartwidth||800,h=a.chartheight||500,k={top:20,right:20,bottom:60,left:65,legend:.15*g},l=g-k.left-k.right-k.legend,m=g-k.left-k.right,n=h-k.top-k.bottom,o=.1,r=d3.scale.ordinal().rangeRoundBands([0,l],o),s=d3.scale.ordinal(),t=d3.scale.linear().range([n,0]),u=d3.scale.ordinal().range(function(){return q<2?["#599ad3","#abdda4"]:colorpalettes.defaultcolors[q]}()),v=2,w=d3.svg.axis().scale(r).orient("bottom").tickSize(0).tickPadding(2*k.bottom/3),x=d3.svg.axis().scale(t).orient("left").innerTickSize(-l).outerTickSize(0).tickPadding(10),y=d3.select(b).append("svg").attr("width",l+k.left+k.right+k.legend).attr("height",n+k.top+k.bottom).append("g").attr("transform","translate("+k.left+","+k.top+")"),z=0,A=0,C=0,D=1,E=1,H=.15*g,I=20;d3.csv(c,function(a,b){function T(a,e){for(c=d3.nest().key(function(b){return b[a]}).key(function(a){return a[e]}).entries(b),i=0;i<c.length;i++)for(j=0;j<c[i].values.length;j++)c[i].values[j].values[0].stderror=+c[i].values[j].values[0].stderror,c[i].values[j].values[0][d]=+c[i].values[j].values[0][d];r.domain(c.map(function(a){return a.key})).rangeRoundBands([0,l],o),s.domain(c[0].values.map(function(a){return a.key})).rangeRoundBands([0,r.rangeBand()]),q=c[0].values.length,u.domain(c[0].values.map(function(a){return a.key})),u.range(function(){return q<2?["#599ad3","#abdda4"]:colorpalettes.defaultcolors[q]}()),y.selectAll(".databar").transition().duration(500).attr("y",1e3).transition().remove(),y.selectAll(".errorline").transition().duration(500).attr("y1",1e3).attr("y2",1e3).transition().remove(),setTimeout(function(){w.scale(r),y.select(".x.axis").call(w),g=g.data([]).exit().remove(),h=h.data([]).exit().remove(),g=y.selectAll(".factor1group").data(c).enter().append("g").attr("class","factor1group").attr("transform",function(a){return"translate("+r(a.key)+",0)"}),h=y.selectAll(".axisticks1").data(c).enter().append("g").attr("class","axisticks1").attr("transform",function(a){return"translate("+r(a.key)+",0)"}),h.filter(function(a,b){return b<c.length-1}).append("line").attr("class","group1tick").attr("x1",r.rangeBand()/2+r.rangeBand()/(2-2*o)).attr("y1",n).attr("x2",r.rangeBand()/2+r.rangeBand()/(2-2*o)).attr("y2",n+k.bottom).attr("stroke","black").attr("stroke-width",1),J(".x0.axis text",r.rangeBand(),16),y.select("g.x.x0.axis").call(w),p=g.selectAll("rect").data(function(a){return a.values}).enter().append("rect").attr("class","databar").attr("width",s.rangeBand()).attr("height",function(a){return Math.abs(t(a.values[0][d])-t(0))}).style("fill",function(a){return u(a.key)}).attr("x",function(a){return s(a.key)}).attr("y",n).transition().duration(500).attr("y",function(a){return t(Math.max(0,a.values[0][d]))}),g.selectAll("rect").on("mouseover",function(a){var b=d3.transform(d3.select(this.parentNode).attr("transform")),c=b.translate[0],e=parseFloat(d3.select(this).attr("x"))+c+s.rangeBand()/2;if(a.values[0][d]>=0)var f=parseFloat(d3.select(this).attr("y"))+1*parseFloat(d3.select(this).attr("height"))/4;else if(a.values[0][d]<0)var f=t(0)+3*parseFloat(d3.select(this).attr("height"))/4;y.append("circle").attr("class","tooltip").attr("r",Math.max(s.rangeBand()/3,20)).attr("cx",e).attr("cy",f).style("fill","aliceblue").style("pointer-events","none").style("stroke","black").style("stroke-width","1px").style("stroke-opacity",.8).attr("fill-opacity",.8),y.append("text").attr("class","tooltip").attr("x",e).attr("y",f).attr("dy","5px").attr("text-anchor","middle").attr("font-size","11px").attr("font-weight","bold").attr("fill","black").style("pointer-events","none").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").text(a.values[0][d]),J("text.tooltip",Math.max(.5*s.rangeBand()-1,35),16,12)}).on("mouseout",function(){d3.selectAll(".tooltip").transition().duration(100).attr("fill-opacity",0).style("stroke-opacity",0).remove()}),B=g.selectAll(".errorbars").data(function(a){return a.values}).enter().append("g").attr("class","errorbars").style("pointer-events","none").attr("transform",function(a){var b=s(a.key)+s.rangeBand()/2;return"translate("+b+", 0 )"}),B.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",v).attr("x1",0).attr("y1",n).attr("x2",0).attr("y2",n).transition().duration(500).attr("x1",0).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return t(b)}).attr("x2",0).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return t(b)}),B.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",v).attr("x1",-s.rangeBand()/4).attr("y1",n).attr("x2",s.rangeBand()/4).attr("y2",n).transition().duration(500).attr("x1",-s.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return t(b)}).attr("x2",s.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]+a.values[0].stderror;return t(b)}).attr("stroke","black").attr("stroke-width",v),B.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",v).attr("x1",-s.rangeBand()/4).attr("y1",n).attr("x2",s.rangeBand()/4).attr("y2",n).transition().duration(500).attr("x1",-s.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]-a.values[0].stderror;return t(b)}).attr("x2",s.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return t(b)}).attr("stroke","black").attr("stroke-width",v),K.data([]).exit().remove(),K=y.selectAll(".legend").data(c[0].values).enter().append("g").attr("class","legend").attr("transform",function(a,b){var c=20*b+20;return"translate(0,"+c+")"}),K.append("rect").transition().attr("x",m).attr("width",18).attr("height",18).style("fill",function(a){return u(a.key)}),K.append("text").transition().attr("x",m-6).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){return a.key}),L.text(e),M.transition().attr("transform",function(){var a=m+18,b=20*c[0].values.length+60;return"translate("+a+","+b+")"}),N.transition().attr("transform",function(){var a=m+18,b=20*c[0].values.length+85;return"translate("+a+","+b+")"}),Q.transition().attr("transform",function(a,b){var d=m-H+18,e=20*c[0].values.length+21*b+90;return"translate("+d+","+e+")"}),R.transition().attr("transform",function(){var a=m+18,b=20*c[0].values.length+21*O.length+125;return"translate("+a+","+b+")"}),S.transition().attr("transform",function(a,b){var d=m-H+18,e=20*c[0].values.length+21*O.length+21*b+130;return"translate("+d+","+e+")"}),Q.filter(function(a,b){return"morphbutton0"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+e),Q.filter(function(a,b){return"morphbutton1"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+a),C=0},500)}if(a)throw a;var c=d3.nest().key(function(a){return a[e]}).key(function(a){return a[f]}).entries(b);for(i=0;i<c.length;i++)for(j=0;j<c[i].values.length;j++)c[i].values[j].values[0].stderror=+c[i].values[j].values[0].stderror,c[i].values[j].values[0][d]=+c[i].values[j].values[0][d];r.domain(c.map(function(a){return a.key})),s.domain(c[0].values.map(function(a){return a.key})).rangeRoundBands([0,r.rangeBand()]),q=c[0].values.length,u.range(function(){return q<2?["#599ad3","#abdda4"]:colorpalettes.defaultcolors[q]}()),t.domain([Math.min(0,d3.min(c,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return a[d]-a.stderror})})})),Math.max(0,d3.max(c,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return a[d]+a.stderror})})}))]).nice(),y.append("g").attr("class","x x0 axis").attr("transform","translate(0,"+n+")").call(w),y.append("g").attr("class","y axis").call(x).append("text").attr("transform","rotate(-90)").attr("x",-n/2).attr("y",-k.left).attr("dy",".71em").style("text-anchor","middle").style("font-size","20px").text(d),t.domain()[0]<0&&t.domain()[1]>0&&y.append("g").attr("class","x axis").append("line").attr("x1",0).attr("y1",t(0)).attr("x2",l).attr("y2",t(0));var g=y.selectAll(".factor1group").data(c).enter().append("g").attr("class","factor1group").attr("transform",function(a){return"translate("+r(a.key)+",0)"}),h=y.selectAll(".axisticks1").data(c).enter().append("g").attr("class","axisticks1").attr("transform",function(a){return"translate("+r(a.key)+",0)"});h.filter(function(a,b){return b<c.length-1}).append("line").attr("class","group1tick").attr("x1",r.rangeBand()/2+r.rangeBand()/(2-2*o)).attr("y1",n).attr("x2",r.rangeBand()/2+r.rangeBand()/(2-2*o)).attr("y2",n+k.bottom).attr("stroke","black").attr("stroke-width",1),J(".x0.axis text",r.rangeBand(),16),y.select("g.x.x0.axis").call(w),y.selectAll(".axis line").style({fill:"none",stroke:"#000","shape-rendering":"crispEdges"}),y.selectAll(".axis path").style({fill:"none",stroke:"#000","shape-rendering":"crispEdges"}),y.selectAll(".tick line").style("opacity","0.2"),y.selectAll(".x.axis path").style("display","inline-block");var p=g.selectAll("rect").data(function(a){return a.values}).enter().append("rect").attr("class","databar").attr("width",s.rangeBand()).attr("height",function(a){return Math.abs(t(a.values[0][d])-t(0))}).style("fill",function(a){return u(a.key)}).attr("x",function(a){return s(a.key)}).attr("y",n).transition().duration(500).attr("y",function(a){return t(Math.max(0,a.values[0][d]))});g.selectAll("rect").on("mouseover",function(a){var b=d3.transform(d3.select(this.parentNode).attr("transform")),c=b.translate[0],e=parseFloat(d3.select(this).attr("x"))+c+s.rangeBand()/2;if(a.values[0][d]>=0)var f=parseFloat(d3.select(this).attr("y"))+1*parseFloat(d3.select(this).attr("height"))/4;else if(a.values[0][d]<0)var f=t(0)+3*parseFloat(d3.select(this).attr("height"))/4;y.append("circle").attr("class","tooltip").attr("r",Math.max(s.rangeBand()/3,20)).attr("cx",e).attr("cy",f).style("fill","aliceblue").style("pointer-events","none").style("stroke","black").style("stroke-width","1px").style("stroke-opacity",.8).attr("fill-opacity",.8),y.append("text").attr("class","tooltip").attr("x",e).attr("y",f).attr("dy","5px").attr("text-anchor","middle").attr("font-weight","bold").attr("fill","black").style("pointer-events","none").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").text(a.values[0][d]),J("text.tooltip",Math.max(.5*s.rangeBand()-1,35),16,12)}).on("mouseout",function(){d3.selectAll(".tooltip").transition().duration(100).attr("fill-opacity",0).style("stroke-opacity",0).remove()});var B=g.selectAll(".errorbars").data(function(a){return a.values}).enter().append("g").attr("class","errorbars").style("pointer-events","none").attr("transform",function(a){var b=s(a.key)+s.rangeBand()/2;return"translate("+b+", 0 )"});B.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",v).attr("x1",0).attr("y1",n).attr("x2",0).attr("y2",n).transition().duration(500).attr("x1",0).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return t(b)}).attr("x2",0).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return t(b)}),B.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",v).attr("x1",-s.rangeBand()/4).attr("y1",n).attr("x2",s.rangeBand()/4).attr("y2",n).transition().duration(500).attr("x1",-s.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return t(b)}).attr("x2",s.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]+a.values[0].stderror;return t(b)}).attr("stroke","black").attr("stroke-width",v),B.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",v).attr("x1",-s.rangeBand()/4).attr("y1",n).attr("x2",s.rangeBand()/4).attr("y2",n).transition().duration(500).attr("x1",-s.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]-a.values[0].stderror;return t(b)}).attr("x2",s.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return t(b)}).attr("stroke","black").attr("stroke-width",v);var K=y.selectAll(".legend").data(c[0].values).enter().append("g").attr("class","legend").attr("transform",function(a,b){var c=20*b+20;return"translate(0,"+c+")"});K.append("rect").attr("x",m).attr("width",18).attr("height",18).style("fill",function(a){return u(a.key)}),K.append("text").attr("x",m-6).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){return a.key});var L=y.append("g").attr("transform",function(){var a=m+18;return"translate("+a+",8)"}).append("text").attr("class","legendtitle").style("font-weight","bold").text(f).attr("x",0).attr("y",0).style("text-anchor","end"),M=y.append("g").attr("class","axiscontrolstitle").attr("transform",function(){var a=m+18,b=20*c[0].values.length+60;return"translate("+a+","+b+")"});M.append("text").text("X axis controls").attr("x",-H/2).attr("y",0).style("fill","steelblue").style("text-anchor","middle").style("font-weight","bold");var N=y.append("g").attr("class","fliptitle").attr("transform",function(){var a=m+18,b=20*c[0].values.length+85;return"translate("+a+","+b+")"});N.append("text").text("Flips").attr("x",-H/2).attr("y",0).style("text-anchor","middle").style("font-style","italic");var O=["Flip "+f,"Flip "+e],P=[e,f],Q=y.selectAll(".morphbutton").data(O).enter().append("g").attr("class",function(a,b){return"morphbutton"+b}).attr("transform",function(a,b){var d=m-H+18,e=20*c[0].values.length+21*b+90;return"translate("+d+","+e+")"});Q.append("rect").attr("width",H).attr("height",I).attr("rx","5").attr("ry","5").style("fill","#C0C0C0").on("mousedown",function(){d3.select(this).style("fill","darkgrey")}).on("mouseout",function(){d3.select(this).style("fill","#C0C0C0")}).on("mouseup",function(){d3.select(this).style("fill","#C0C0C0")}),Q.append("text").text(function(a){return a}).classed("morphtext",!0).attr("x",H/2).attr("y",15).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").style("text-anchor","middle").style("fill","white").style("pointer-events","none").style("font-size","1px").style("font-size",function(a){var b=this.getBBox(),e=(b.width,b.height,Math.min(H/(b.width+1),I/b.height,16));return e+"px"});var R=y.append("g").attr("class","redrawtitle").attr("transform",function(){var a=m+18,b=20*c[0].values[0].values.length+21*O.length+125;return"translate("+a+","+b+")"});R.append("text").text("X axis factor").attr("x",-H/2).attr("y",0).style("text-anchor","middle").style("font-style","italic");var S=y.selectAll(".morphbutton_2_").data(P).enter().append("g").attr("class",function(a,b){return"morphbutton_2_"+b}).attr("transform",function(a,b){var d=m-H+18,e=20*c[0].values[0].values.length+21*O.length+21*b+130;return"translate("+d+","+e+")"});S.append("rect").attr("width",H).attr("height",I).attr("rx","5").attr("ry","5").style("fill","#C0C0C0").on("mousedown",function(){d3.select(this).style("fill","darkgrey")}).on("mouseout",function(){d3.select(this).style("fill","#C0C0C0")}).on("mouseup",function(){d3.select(this).style("fill","#C0C0C0")}),S.append("text").text(function(a){return a}).classed("morphtext2",!0).attr("x",H/2).attr("y",15).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").style("text-anchor","middle").style("fill","white").style("pointer-events","none").style("font-size","1px").style("font-size",function(a){var b=this.getBBox(),e=(b.width,b.height,Math.min(H/(b.width+2),I/b.height,16));return e+"px"}),J(".morphtext",H-5,16),J(".morphtext2",H-5,16),Q.filter(function(a,b){return"morphbutton0"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==C&&(C=1,0==z?(s.rangeRoundBands([r.rangeBand(),0]),z=1):1==z&&(s.rangeRoundBands([0,r.rangeBand()]),z=0),g.selectAll("rect").data(function(a){return a.values}).transition().attr("width",s.rangeBand()).attr("x",function(a){return s(a.key)}).attr("y",function(a){return t(Math.max(0,a.values[0][d]))}).attr("height",function(a){return Math.abs(t(a.values[0][d])-t(0))}).style("fill",function(a){return u(a.key)}),g.selectAll(".errorbars").data(function(a){return a.values}).transition().attr("transform",function(a){var b=s(a.key)+s.rangeBand()/2;return"translate("+b+", 0 )"}).each("end",function(){C=0}))}),Q.filter(function(a,b){return"morphbutton1"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==C&&(C=1,0==A?(r.rangeRoundBands([l,0],o),A=1):1==A&&(r.rangeRoundBands([0,l],o),A=0),y.select("g.x.x0.axis").transition().call(w),y.selectAll("g.factor1group").data(c).transition().attr("transform",function(a){return"translate("+r(a.key)+",0)"}),setTimeout(function(){C=0},500))}),S.on("click",function(){"morphbutton_2_0"==d3.select(this).attr("class")&&(E=1,F=e,G=f),"morphbutton_2_1"==d3.select(this).attr("class")&&(E=2,F=f,G=e),0==C&&D!==E&&(C=1,D=E,z=0,A=0,T(F,G))})})}function hibars3(a){function O(a,b,c,d){var e=[];C.selectAll(a).style("font-size","1px").style("font-size",function(){var a=this.getBBox(),d=Math.min(b/a.width,c);e.push(d)}).style("font-size",function(){return d?Math.max(d3.min(e),d)+"px":d3.min(e)+"px"})}var s,J,K,L,b="#"+a.location,c=a.datafile,d=a.dependent,e=a.factor1,f=a.factor2,g=a.factor3,h=a.chartwidth||800,l=a.chartheight||500,m={top:20,right:20,bottom:60,left:65,legend:.15*h},n=h-m.left-m.right-m.legend,o=h-m.left-m.right,p=l-m.top-m.bottom,q=.1,r=.1,t=d3.scale.ordinal().rangeRoundBands([0,n],q),u=d3.scale.ordinal(),v=d3.scale.ordinal(),w=d3.scale.linear().range([p,0]),x=d3.scale.ordinal().range(function(){return s<2?["#599ad3","#abdda4"]:colorpalettes.defaultcolors[s]}()),y=2,z=d3.svg.axis().scale(t).orient("bottom").tickSize(0).tickPadding(2*m.bottom/3),A=d3.svg.axis().orient("bottom").tickSize(0).tickPadding(1*m.bottom/5),B=d3.svg.axis().scale(w).orient("left").innerTickSize(-n).outerTickSize(0).tickPadding(10),C=d3.select(b).append("svg").attr("width",n+m.left+m.right+m.legend).attr("height",p+m.top+m.bottom).append("g").attr("transform","translate("+m.left+","+m.top+")"),D=0,E=0,F=0,G=0,H=1,I=1,M=.15*h,N=20;d3.csv(c,function(a,b){function aa(a,e,f){for(c=d3.nest().key(function(b){return b[a]}).key(function(a){return a[e]}).key(function(a){return a[f]}).entries(b),i=0;i<c.length;i++)for(j=0;j<c[i].values.length;j++)for(k=0;k<c[i].values[j].values.length;k++)c[i].values[j].values[k].values[0].stderror=+c[i].values[j].values[k].values[0].stderror,c[i].values[j].values[k].values[0][d]=+c[i].values[j].values[k].values[0][d];t.domain(c.map(function(a){return a.key})).rangeRoundBands([0,n],q),u.domain(c[0].values.map(function(a){return a.key})).rangeRoundBands([0,t.rangeBand()],r),v.domain(c[0].values[0].values.map(function(a){return a.key})).rangeRoundBands([0,u.rangeBand()]),s=c[0].values[0].values.length,x.domain(c[0].values[0].values.map(function(a){return a.key})),x.range(function(){return s<2?["#599ad3","#abdda4"]:colorpalettes.defaultcolors[s]}()),C.selectAll(".databar").transition().duration(500).attr("y",1e3).transition().remove(),C.selectAll(".errorline").transition().duration(500).attr("y1",1e3).attr("y2",1e3).transition().remove(),setTimeout(function(){z.scale(t),A.scale(u),C.select(".x.axis").call(z),h=h.data([]).exit().remove(),l=l.data([]).exit().remove(),h=C.selectAll(".factor1group").data(c).enter().append("g").attr("class","factor1group").attr("transform",function(a){return"translate("+t(a.key)+",0)"}),h.append("g").attr("class","x1 axis").attr("transform","translate(0,"+p+")").call(A).style("font-size","12px"),l=C.selectAll(".axisticks1").data(c).enter().append("g").attr("class","axisticks1").attr("transform",function(a){return"translate("+t(a.key)+",0)"}),l.filter(function(a,b){return b<c.length-1}).append("line").attr("class","group1tick").attr("x1",t.rangeBand()/2+t.rangeBand()/(2-2*q)).attr("y1",p).attr("x2",t.rangeBand()/2+t.rangeBand()/(2-2*q)).attr("y2",p+m.bottom).attr("stroke","black").attr("stroke-width",1),P=h.selectAll(".factor2group").data(function(a){return a.values}).enter().append("g").attr("class","factor2group").attr("transform",function(a){return"translate("+u(a.key)+",0)"}),Q=l.selectAll(".axisticks2").data(function(a){return a.values}).enter().append("g").attr("class","axisticks2").attr("transform",function(a){return"translate("+u(a.key)+",0)"}),Q.filter(function(a,b){return b<c[0].values.length-1}).append("line").attr("class","group2tick").attr("x1",u.rangeBand()/2+u.rangeBand()/(2-2*r)).attr("y1",p).attr("x2",u.rangeBand()/2+u.rangeBand()/(2-2*r)).attr("y2",p+m.bottom/3).attr("stroke","black").attr("stroke-width",1),O(".x0.axis text",t.rangeBand(),16),O(".x1.axis text",u.rangeBand(),12),C.select("g.x.x0.axis").call(z),h.call(A),R=P.selectAll("rect").data(function(a){return a.values}).enter().append("rect").attr("class","databar").attr("width",v.rangeBand()).attr("height",function(a){return Math.abs(w(a.values[0][d])-w(0))}).style("fill",function(a){return x(a.key)}).attr("x",function(a){return v(a.key)}).attr("y",p).transition().duration(500).attr("y",function(a){return w(Math.max(0,a.values[0][d]))}),P.selectAll("rect").on("mouseover",function(a){var b=d3.transform(d3.select(this.parentNode).attr("transform")),c=b.translate[0],e=d3.transform(d3.select(this.parentNode.parentNode).attr("transform")),f=e.translate[0],g=parseFloat(d3.select(this).attr("x"))+c+f+v.rangeBand()/2;if(a.values[0][d]>=0)var h=parseFloat(d3.select(this).attr("y"))+1*parseFloat(d3.select(this).attr("height"))/4;else if(a.values[0][d]<0)var h=w(0)+3*parseFloat(d3.select(this).attr("height"))/4;C.append("circle").attr("class","tooltip").attr("r",Math.max(v.rangeBand()/3,20)).attr("cx",g).attr("cy",h).style("fill","aliceblue").style("pointer-events","none").style("stroke","black").style("stroke-width","1px").style("stroke-opacity",.8).attr("fill-opacity",.8),C.append("text").attr("class","tooltip").attr("x",g).attr("y",h).attr("dy","5px").attr("text-anchor","middle").attr("font-size","11px").attr("font-weight","bold").attr("fill","black").style("pointer-events","none").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").text(a.values[0][d]),O("text.tooltip",Math.max(.5*v.rangeBand()-1,35),16,12)}).on("mouseout",function(){d3.selectAll(".tooltip").transition().duration(100).attr("fill-opacity",0).style("stroke-opacity",0).remove()}),S=P.selectAll(".errorbars").data(function(a){return a.values}).enter().append("g").attr("class","errorbars").style("pointer-events","none").attr("transform",function(a){var b=v(a.key)+v.rangeBand()/2;return"translate("+b+", 0 )"}),S.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",y).attr("x1",0).attr("y1",p).attr("x2",0).attr("y2",p).transition().duration(500).attr("x1",0).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return w(b)}).attr("x2",0).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return w(b)}),S.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",y).attr("x1",-v.rangeBand()/4).attr("y1",p).attr("x2",v.rangeBand()/4).attr("y2",p).transition().duration(500).attr("x1",-v.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return w(b)}).attr("x2",v.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]+a.values[0].stderror;return w(b)}).attr("stroke","black").attr("stroke-width",y),S.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",y).attr("x1",-v.rangeBand()/4).attr("y1",p).attr("x2",v.rangeBand()/4).attr("y2",p).transition().duration(500).attr("x1",-v.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]-a.values[0].stderror;return w(b)}).attr("x2",v.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return w(b)}).attr("stroke","black").attr("stroke-width",y),T.data([]).exit().remove(),T=C.selectAll(".legend").data(c[0].values[0].values).enter().append("g").attr("class","legend").attr("transform",function(a,b){var c=20*b+20;return"translate(0,"+c+")"}),T.append("rect").transition().attr("x",o).attr("width",18).attr("height",18).style("fill",function(a){return x(a.key)}),T.append("text").transition().attr("x",o-6).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){return a.key}),U.text(f),V.transition().attr("transform",function(){var a=o+18,b=20*c[0].values[0].values.length+60;return"translate("+a+","+b+")"}),W.transition().attr("transform",function(){var a=o+18,b=20*c[0].values[0].values.length+85;return"translate("+a+","+b+")"}),Z.transition().attr("transform",function(a,b){var d=o-M+18,e=20*c[0].values[0].values.length+21*b+90;return"translate("+d+","+e+")"}),$.transition().attr("transform",function(){var a=o+18,b=20*c[0].values[0].values.length+21*X.length+125;return"translate("+a+","+b+")"}),_.transition().attr("transform",function(a,b){var d=o-M+18,e=20*c[0].values[0].values.length+21*X.length+21*b+130;return"translate("+d+","+e+")"}),Z.filter(function(a,b){return"morphbutton0"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+f),Z.filter(function(a,b){return"morphbutton1"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+e),Z.filter(function(a,b){return"morphbutton2"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+a),G=0},500)}if(a)throw a;var c=d3.nest().key(function(a){return a[e]}).key(function(a){return a[f]}).key(function(a){return a[g]}).entries(b);for(i=0;i<c.length;i++)for(j=0;j<c[i].values.length;j++)for(k=0;k<c[i].values[j].values.length;k++)c[i].values[j].values[k].values[0].stderror=+c[i].values[j].values[k].values[0].stderror,c[i].values[j].values[k].values[0][d]=+c[i].values[j].values[k].values[0][d];t.domain(c.map(function(a){return a.key})),u.domain(c[0].values.map(function(a){return a.key})).rangeRoundBands([0,t.rangeBand()],r),v.domain(c[0].values[0].values.map(function(a){return a.key})).rangeRoundBands([0,u.rangeBand()]),A.scale(u),s=c[0].values[0].values.length,x.range(function(){return s<2?["#599ad3","#abdda4"]:colorpalettes.defaultcolors[s]}()),w.domain([Math.min(0,d3.min(c,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return a[d]-a.stderror})})})})),Math.max(0,d3.max(c,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return a[d]+a.stderror})})})}))]).nice(),C.append("g").attr("class","x x0 axis").attr("transform","translate(0,"+p+")").call(z),C.append("g").attr("class","y axis").call(B).append("text").attr("transform","rotate(-90)").attr("x",-p/2).attr("y",-m.left).attr("dy",".71em").style("text-anchor","middle").style("font-size","20px").text(d),w.domain()[0]<0&&w.domain()[1]>0&&C.append("g").attr("class","x axis").append("line").attr("x1",0).attr("y1",w(0)).attr("x2",n).attr("y2",w(0));var h=C.selectAll(".factor1group").data(c).enter().append("g").attr("class","factor1group").attr("transform",function(a){return"translate("+t(a.key)+",0)"});h.append("g").attr("class","x1 axis").attr("transform","translate(0,"+p+")").call(A).style("font-size","12px");var l=C.selectAll(".axisticks1").data(c).enter().append("g").attr("class","axisticks1").attr("transform",function(a){return"translate("+t(a.key)+",0)"});l.filter(function(a,b){return b<c.length-1}).append("line").attr("class","group1tick").attr("x1",t.rangeBand()/2+t.rangeBand()/(2-2*q)).attr("y1",p).attr("x2",t.rangeBand()/2+t.rangeBand()/(2-2*q)).attr("y2",p+m.bottom).attr("stroke","black").attr("stroke-width",1);var P=h.selectAll(".factor2group").data(function(a){return a.values}).enter().append("g").attr("class","factor2group").attr("transform",function(a){return"translate("+u(a.key)+",0)"}),Q=l.selectAll(".axisticks2").data(function(a){return a.values}).enter().append("g").attr("class","axisticks2").attr("transform",function(a){return"translate("+u(a.key)+",0)"});Q.filter(function(a,b){return b<c[0].values.length-1}).append("line").attr("class","group2tick").attr("x1",u.rangeBand()/2+u.rangeBand()/(2-2*r)).attr("y1",p).attr("x2",u.rangeBand()/2+u.rangeBand()/(2-2*r)).attr("y2",p+m.bottom/3).attr("stroke","black").attr("stroke-width",1),O(".x0.axis text",t.rangeBand(),16),O(".x1.axis text",u.rangeBand(),12),C.select("g.x.x0.axis").call(z),h.call(A),C.selectAll(".axis line").style({fill:"none",stroke:"#000","shape-rendering":"crispEdges"}),C.selectAll(".axis path").style({fill:"none",stroke:"#000","shape-rendering":"crispEdges"}),C.selectAll(".tick line").style("opacity","0.2"),C.selectAll(".x.axis path").style("display","inline-block");var R=P.selectAll("rect").data(function(a){return a.values}).enter().append("rect").attr("class","databar").attr("width",v.rangeBand()).attr("height",function(a){return Math.abs(w(a.values[0][d])-w(0))}).style("fill",function(a){return x(a.key)}).attr("x",function(a){return v(a.key)}).attr("y",p).transition().duration(500).attr("y",function(a){return w(Math.max(0,a.values[0][d]))});P.selectAll("rect").on("mouseover",function(a){var b=d3.transform(d3.select(this.parentNode).attr("transform")),c=b.translate[0],e=d3.transform(d3.select(this.parentNode.parentNode).attr("transform")),f=e.translate[0],g=parseFloat(d3.select(this).attr("x"))+c+f+v.rangeBand()/2;if(a.values[0][d]>=0)var h=parseFloat(d3.select(this).attr("y"))+1*parseFloat(d3.select(this).attr("height"))/4;else if(a.values[0][d]<0)var h=w(0)+3*parseFloat(d3.select(this).attr("height"))/4;C.append("circle").attr("class","tooltip").attr("r",Math.max(v.rangeBand()/3,20)).attr("cx",g).attr("cy",h).style("fill","aliceblue").style("pointer-events","none").style("stroke","black").style("stroke-width","1px").style("stroke-opacity",.8).attr("fill-opacity",.8),C.append("text").attr("class","tooltip").attr("x",g).attr("y",h).attr("dy","5px").attr("text-anchor","middle").attr("font-weight","bold").attr("fill","black").style("pointer-events","none").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").text(a.values[0][d]),O("text.tooltip",Math.max(.5*v.rangeBand()-1,35),16,12)}).on("mouseout",function(){d3.selectAll(".tooltip").transition().duration(100).attr("fill-opacity",0).style("stroke-opacity",0).remove()});var S=P.selectAll(".errorbars").data(function(a){return a.values}).enter().append("g").attr("class","errorbars").style("pointer-events","none").attr("transform",function(a){var b=v(a.key)+v.rangeBand()/2;return"translate("+b+", 0 )"});S.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",y).attr("x1",0).attr("y1",p).attr("x2",0).attr("y2",p).transition().duration(500).attr("x1",0).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return w(b)}).attr("x2",0).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return w(b)}),S.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",y).attr("x1",-v.rangeBand()/4).attr("y1",p).attr("x2",v.rangeBand()/4).attr("y2",p).transition().duration(500).attr("x1",-v.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return w(b)}).attr("x2",v.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]+a.values[0].stderror;return w(b)}).attr("stroke","black").attr("stroke-width",y),S.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",y).attr("x1",-v.rangeBand()/4).attr("y1",p).attr("x2",v.rangeBand()/4).attr("y2",p).transition().duration(500).attr("x1",-v.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]-a.values[0].stderror;return w(b)}).attr("x2",v.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return w(b)}).attr("stroke","black").attr("stroke-width",y);var T=C.selectAll(".legend").data(c[0].values[0].values).enter().append("g").attr("class","legend").attr("transform",function(a,b){var c=20*b+20;return"translate(0,"+c+")"});T.append("rect").attr("x",o).attr("width",18).attr("height",18).style("fill",function(a){return x(a.key)}),T.append("text").attr("x",o-6).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){
return a.key});var U=C.append("g").attr("transform",function(){var a=o+18;return"translate("+a+",8)"}).append("text").attr("class","legendtitle").style("font-weight","bold").text(g).attr("x",0).attr("y",0).style("text-anchor","end"),V=C.append("g").attr("class","axiscontrolstitle").attr("transform",function(){var a=o+18,b=20*c[0].values[0].values.length+60;return"translate("+a+","+b+")"});V.append("text").text("X axis controls").attr("x",-M/2).attr("y",0).style("fill","steelblue").style("text-anchor","middle").style("font-weight","bold");var W=C.append("g").attr("class","fliptitle").attr("transform",function(){var a=o+18,b=20*c[0].values[0].values.length+85;return"translate("+a+","+b+")"});W.append("text").text("Flips").attr("x",-M/2).attr("y",0).style("text-anchor","middle").style("font-style","italic");var X=["Flip "+g,"Flip "+f,"Flip "+e],Y=[e+","+f,e+","+g,f+","+e,g+","+e,f+","+g,g+","+f],Z=C.selectAll(".morphbutton").data(X).enter().append("g").attr("class",function(a,b){return"morphbutton"+b}).attr("transform",function(a,b){var d=o-M+18,e=20*c[0].values[0].values.length+21*b+90;return"translate("+d+","+e+")"});Z.append("rect").attr("width",M).attr("height",N).attr("rx","5").attr("ry","5").style("fill","#C0C0C0").on("mousedown",function(){d3.select(this).style("fill","darkgrey")}).on("mouseout",function(){d3.select(this).style("fill","#C0C0C0")}).on("mouseup",function(){d3.select(this).style("fill","#C0C0C0")}),Z.append("text").text(function(a){return a}).classed("morphtext",!0).attr("x",M/2).attr("y",15).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").style("text-anchor","middle").style("fill","white").style("pointer-events","none").style("font-size","1px").style("font-size",function(a){var b=this.getBBox(),e=(b.width,b.height,Math.min(M/(b.width+1),N/b.height,16));return e+"px"});var $=C.append("g").attr("class","redrawtitle").attr("transform",function(){var a=o+18,b=20*c[0].values[0].values.length+21*X.length+125;return"translate("+a+","+b+")"});$.append("text").text("X axis factors").attr("x",-M/2).attr("y",0).style("text-anchor","middle").style("font-style","italic");var _=C.selectAll(".morphbutton_2_").data(Y).enter().append("g").attr("class",function(a,b){return"morphbutton_2_"+b}).attr("transform",function(a,b){var d=o-M+18,e=20*c[0].values[0].values.length+21*X.length+21*b+130;return"translate("+d+","+e+")"});_.append("rect").attr("width",M).attr("height",N).attr("rx","5").attr("ry","5").style("fill","#C0C0C0").on("mousedown",function(){d3.select(this).style("fill","darkgrey")}).on("mouseout",function(){d3.select(this).style("fill","#C0C0C0")}).on("mouseup",function(){d3.select(this).style("fill","#C0C0C0")}),_.append("text").text(function(a){return a}).classed("morphtext2",!0).attr("x",M/2).attr("y",15).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").style("text-anchor","middle").style("fill","white").style("pointer-events","none").style("font-size","1px").style("font-size",function(a){var b=this.getBBox(),e=(b.width,b.height,Math.min(M/(b.width+2),N/b.height,16));return e+"px"}),O(".morphtext",M-5,16),O(".morphtext2",M-5,16),Z.filter(function(a,b){return"morphbutton0"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==G&&(G=1,0==D?(v.rangeRoundBands([u.rangeBand(),0]),D=1):1==D&&(v.rangeRoundBands([0,u.rangeBand()]),D=0),P.selectAll("rect").data(function(a){return a.values}).transition().attr("width",v.rangeBand()).attr("x",function(a){return v(a.key)}).attr("y",function(a){return w(Math.max(0,a.values[0][d]))}).attr("height",function(a){return Math.abs(w(a.values[0][d])-w(0))}).style("fill",function(a){return x(a.key)}),P.selectAll(".errorbars").data(function(a){return a.values}).transition().attr("transform",function(a){var b=v(a.key)+v.rangeBand()/2;return"translate("+b+", 0 )"}).each("end",function(){G=0}))}),Z.filter(function(a,b){return"morphbutton1"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==G&&(G=1,0==E?(u.rangeRoundBands([t.rangeBand(),0],r),E=1):1==E&&(u.rangeRoundBands([0,t.rangeBand()],r),E=0),h.selectAll(".x1.axis").transition().call(A),h.selectAll("g.factor2group").data(function(a){return a.values}).transition().attr("transform",function(a){return"translate("+u(a.key)+",0)"}),setTimeout(function(){G=0},500))}),Z.filter(function(a,b){return"morphbutton2"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==G&&(G=1,0==F?(t.rangeRoundBands([n,0],q),F=1):1==F&&(t.rangeRoundBands([0,n],q),F=0),C.select("g.x.x0.axis").transition().call(z),C.selectAll("g.factor1group").data(c).transition().attr("transform",function(a){return"translate("+t(a.key)+",0)"}),setTimeout(function(){G=0},500))}),_.on("click",function(){"morphbutton_2_0"==d3.select(this).attr("class")&&(I=1,J=e,K=f,L=g),"morphbutton_2_1"==d3.select(this).attr("class")&&(I=2,J=e,K=g,L=f),"morphbutton_2_2"==d3.select(this).attr("class")&&(I=3,J=f,K=e,L=g),"morphbutton_2_3"==d3.select(this).attr("class")&&(I=4,J=g,K=e,L=f),"morphbutton_2_4"==d3.select(this).attr("class")&&(I=5,J=f,K=g,L=e),"morphbutton_2_5"==d3.select(this).attr("class")&&(I=6,J=g,K=f,L=e),0==G&&H!==I&&(G=1,H=I,D=0,E=0,F=0,aa(J,K,L))})})}function hibars4(a){function V(a,b,c,d){var e=[];H.selectAll(a).style("font-size","1px").style("font-size",function(){var a=this.getBBox(),d=Math.min(b/a.width,c);e.push(d)}).style("font-size",function(){return d?Math.max(d3.min(e),d)+"px":d3.min(e)+"px"})}var v,b="#"+a.location,c=a.datafile,d=a.dependent,e=a.factor1,f=a.factor2,g=a.factor3,h=a.factor4,m=a.chartwidth||800,n=a.chartheight||500,o={top:20,right:20,bottom:60,left:65,legend:.15*m},p=m-o.left-o.right-o.legend,q=m-o.left-o.right,r=n-o.top-o.bottom,s=.05,t=.1,u=.1,w=d3.scale.ordinal().rangeRoundBands([0,p],s),x=d3.scale.ordinal(),y=d3.scale.ordinal(),z=d3.scale.ordinal(),A=d3.scale.linear().range([r,0]),B=d3.scale.ordinal().range(function(){return v<2?["#599ad3","#abdda4"]:colorpalettes.defaultcolors[v]}()),C=2,D=d3.svg.axis().scale(w).orient("bottom").tickSize(0).tickPadding(3*o.bottom/5),E=d3.svg.axis().orient("bottom").tickSize(0).tickPadding(1*o.bottom/3),F=d3.svg.axis().orient("bottom").tickSize(0).tickPadding(1*o.bottom/8),G=d3.svg.axis().scale(A).orient("left").innerTickSize(-p).outerTickSize(0).tickPadding(10),H=d3.select(b).append("svg").attr("width",p+o.left+o.right+o.legend).attr("height",r+o.top+o.bottom).append("g").attr("transform","translate("+o.left+","+o.top+")"),I=0,J=0,K=0,L=0,M=0,T=.15*m,U=20;d3.csv(c,function(a,c){function ea(){var a=d3.event.target.value,b=a.split(",");0==M&&(M=1,I=0,J=0,K=0,L=0,fa(b[0],b[1],b[2],b[3]))}function fa(a,b,e,f){for(m=d3.nest().key(function(b){return b[a]}).key(function(a){return a[b]}).key(function(a){return a[e]}).key(function(a){return a[f]}).entries(c),i=0;i<m.length;i++)for(j=0;j<m[i].values.length;j++)for(k=0;k<m[i].values[j].values.length;k++)for(l=0;l<m[i].values[j].values[k].values.length;l++)m[i].values[j].values[k].values[l].values[0].stderror=+m[i].values[j].values[k].values[l].values[0].stderror,m[i].values[j].values[k].values[l].values[0][d]=+m[i].values[j].values[k].values[l].values[0][d];w.domain(m.map(function(a){return a.key})).rangeRoundBands([0,p],s),x.domain(m[0].values.map(function(a){return a.key})).rangeRoundBands([0,w.rangeBand()],t),y.domain(m[0].values[0].values.map(function(a){return a.key})).rangeRoundBands([0,x.rangeBand()],u),z.domain(m[0].values[0].values[0].values.map(function(a){return a.key})).rangeRoundBands([0,y.rangeBand()]),v=m[0].values[0].values[0].values.length,B.range(function(){return v<2?["#599ad3","#abdda4"]:colorpalettes.defaultcolors[v]}()),B.domain(m[0].values[0].values[0].values.map(function(a){return a.key})),H.selectAll(".databar").transition().duration(500).attr("y",1e3).transition().remove(),H.selectAll(".errorline").transition().duration(500).attr("y1",1e3).attr("y2",1e3).transition().remove(),setTimeout(function(){D.scale(w),E.scale(x),F.scale(y),H.select(".x.axis").call(D),n=n.data([]).exit().remove(),N=N.data([]).exit().remove(),n=H.selectAll(".factor1group").data(m).enter().append("g").attr("class","factor1group").attr("transform",function(a){return"translate("+w(a.key)+",0)"}),n.append("g").attr("class","x1 axis").attr("transform","translate(0,"+r+")").call(E).style("font-size","12px"),N=H.selectAll(".axisticks1").data(m).enter().append("g").attr("class","axisticks1").attr("transform",function(a){return"translate("+w(a.key)+",0)"}),N.filter(function(a,b){return b<m.length-1}).append("line").attr("class","group1tick").attr("x1",w.rangeBand()/2+w.rangeBand()/(2-2*s)).attr("y1",r).attr("x2",w.rangeBand()/2+w.rangeBand()/(2-2*s)).attr("y2",r+o.bottom).attr("stroke","black").attr("stroke-width",1),O=n.selectAll(".factor2group").data(function(a){return a.values}).enter().append("g").attr("class","factor2group").attr("transform",function(a){return"translate("+x(a.key)+",0)"}),P=N.selectAll(".axisticks2").data(function(a){return a.values}).enter().append("g").attr("class","axisticks2").attr("transform",function(a){return"translate("+x(a.key)+",0)"}),P.filter(function(a,b){return b<m[0].values.length-1}).append("line").attr("class","group2tick").attr("x1",x.rangeBand()/2+x.rangeBand()/(2-2*t)).attr("y1",r).attr("x2",x.rangeBand()/2+x.rangeBand()/(2-2*t)).attr("y2",r+o.bottom/3).attr("stroke","black").attr("stroke-width",1),Q=O.selectAll(".factor3group").data(function(a){return a.values}).enter().append("g").attr("class","factor3group").attr("transform",function(a){return"translate("+y(a.key)+",0)"}),R=P.selectAll(".axisticks3").data(function(a){return a.values}).enter().append("g").attr("class","axisticks3").attr("transform",function(a){return"translate("+y(a.key)+",0)"}),R.filter(function(a,b){return b<m[0].values[0].values.length-1}).append("line").attr("class","group3tick").attr("x1",y.rangeBand()/2+y.rangeBand()/(2-2*u)).attr("y1",r).attr("x2",y.rangeBand()/2+y.rangeBand()/(2-2*u)).attr("y2",r+o.bottom/5).attr("stroke","black").attr("stroke-width",1),V(".x0.axis text",w.rangeBand(),16),V(".x1.axis text",x.rangeBand(),12),V(".x2.axis text",y.rangeBand(),10),H.select("g.x.x0.axis").call(D),n.call(E),O.append("g").attr("class","x2 axis").attr("transform","translate(0,"+r+")").call(F).style("font-size","10px").selectAll("text").style("text-anchor","middle"),V(".x2.axis text",y.rangeBand(),10),O.call(F),S=Q.selectAll("rect").data(function(a){return a.values}).enter().append("rect").attr("class","databar").attr("width",z.rangeBand()).attr("height",function(a){return Math.abs(A(a.values[0][d])-A(0))}).style("fill",function(a){return B(a.key)}).attr("x",function(a){return z(a.key)}).attr("y",r).transition().duration(500).attr("y",function(a){return A(Math.max(0,a.values[0][d]))}),Q.selectAll("rect").on("mouseover",function(a){var b=d3.transform(d3.select(this.parentNode).attr("transform")),c=b.translate[0],e=d3.transform(d3.select(this.parentNode.parentNode).attr("transform")),f=e.translate[0],g=d3.transform(d3.select(this.parentNode.parentNode.parentNode).attr("transform")),h=g.translate[0],i=parseFloat(d3.select(this).attr("x"))+c+f+h+z.rangeBand()/2;if(a.values[0][d]>=0)var j=parseFloat(d3.select(this).attr("y"))+1*parseFloat(d3.select(this).attr("height"))/4;else if(a.values[0][d]<0)var j=A(0)+3*parseFloat(d3.select(this).attr("height"))/4;H.append("circle").attr("class","tooltip").attr("r",Math.max(z.rangeBand()/3,20)).attr("cx",i).attr("cy",j).style("fill","aliceblue").style("pointer-events","none").style("stroke","black").style("stroke-width","1px").style("stroke-opacity",.8).attr("fill-opacity",.8),H.append("text").attr("class","tooltip").attr("x",i).attr("y",j).attr("dy","5px").attr("text-anchor","middle").attr("font-size","11px").attr("font-weight","bold").attr("fill","black").style("pointer-events","none").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").text(a.values[0][d]),V("text.tooltip",Math.max(.5*z.rangeBand()-1,35),16,12)}).on("mouseout",function(){d3.selectAll(".tooltip").transition().duration(100).attr("fill-opacity",0).style("stroke-opacity",0).remove()}),W=Q.selectAll(".errorbars").data(function(a){return a.values}).enter().append("g").attr("class","errorbars").style("pointer-events","none").attr("transform",function(a){var b=z(a.key)+z.rangeBand()/2;return"translate("+b+", 0 )"}),W.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",C).attr("x1",0).attr("y1",r).attr("x2",0).attr("y2",r).transition().duration(500).attr("x1",0).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return A(b)}).attr("x2",0).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return A(b)}),W.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",C).attr("x1",-z.rangeBand()/4).attr("y1",r).attr("x2",z.rangeBand()/4).attr("y2",r).transition().duration(500).attr("x1",-z.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return A(b)}).attr("x2",z.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]+a.values[0].stderror;return A(b)}).attr("stroke","black").attr("stroke-width",C),W.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",C).attr("x1",-z.rangeBand()/4).attr("y1",r).attr("x2",z.rangeBand()/4).attr("y2",r).transition().duration(500).attr("x1",-z.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]-a.values[0].stderror;return A(b)}).attr("x2",z.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return A(b)}).attr("stroke","black").attr("stroke-width",C),X.data([]).exit().remove(),X=H.selectAll(".legend").data(m[0].values[0].values[0].values).enter().append("g").attr("class","legend").attr("transform",function(a,b){var c=20*b+20;return"translate(0,"+c+")"}),X.append("rect").transition().attr("x",q).attr("width",18).attr("height",18).style("fill",function(a){return B(a.key)}),X.append("text").transition().attr("x",q-6).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){return a.key}),Y.text(f),Z.transition().attr("transform",function(){var a=q+18,b=20*m[0].values[0].values[0].values.length+60;return"translate("+a+","+b+")"}),aa.transition().attr("transform",function(a,b){var c=q-T+18,d=20*m[0].values[0].values[0].values.length+21*b+90;return"translate("+c+","+d+")"}),ba.transition().attr("transform",function(){var a=q+18,b=20*m[0].values[0].values[0].values.length+21*$.length+125;return"translate("+a+","+b+")"}),ca.transition().attr("transform",function(){var a=q-T+18,b=20*m[0].values[0].values[0].values.length+21*$.length+130;return"translate("+a+","+b+")"}),aa.filter(function(a,b){return"morphbutton0"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+f),aa.filter(function(a,b){return"morphbutton1"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+e),aa.filter(function(a,b){return"morphbutton2"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+b),aa.filter(function(a,b){return"morphbutton3"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+a),M=0},500)}if(a)throw a;var m=d3.nest().key(function(a){return a[e]}).key(function(a){return a[f]}).key(function(a){return a[g]}).key(function(a){return a[h]}).entries(c);for(i=0;i<m.length;i++)for(j=0;j<m[i].values.length;j++)for(k=0;k<m[i].values[j].values.length;k++)for(l=0;l<m[i].values[j].values[k].values.length;l++)m[i].values[j].values[k].values[l].values[0].stderror=+m[i].values[j].values[k].values[l].values[0].stderror,m[i].values[j].values[k].values[l].values[0][d]=+m[i].values[j].values[k].values[l].values[0][d];w.domain(m.map(function(a){return a.key})),x.domain(m[0].values.map(function(a){return a.key})).rangeRoundBands([0,w.rangeBand()],t),y.domain(m[0].values[0].values.map(function(a){return a.key})).rangeRoundBands([0,x.rangeBand()],u),z.domain(m[0].values[0].values[0].values.map(function(a){return a.key})).rangeRoundBands([0,y.rangeBand()]),E.scale(x),F.scale(y),v=m[0].values[0].values[0].values.length,B.range(function(){return v<2?["#599ad3","#abdda4"]:colorpalettes.defaultcolors[v]}()),A.domain([Math.min(0,d3.min(m,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return a[d]-a.stderror})})})})})),Math.max(0,d3.max(m,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return a[d]+a.stderror})})})})}))]).nice(),H.append("g").attr("class","x x0 axis").attr("transform","translate(0,"+r+")").call(D),H.append("g").attr("class","y axis").call(G).append("text").attr("transform","rotate(-90)").attr("x",-r/2).attr("y",-o.left).attr("dy",".71em").style("text-anchor","middle").style("font-size","20px").text(d),A.domain()[0]<0&&A.domain()[1]>0&&H.append("g").attr("class","x axis").append("line").attr("x1",0).attr("y1",A(0)).attr("x2",p).attr("y2",A(0));var n=H.selectAll(".factor1group").data(m).enter().append("g").attr("class","factor1group").attr("transform",function(a){return"translate("+w(a.key)+",0)"});n.append("g").attr("class","x1 axis").attr("transform","translate(0,"+r+")").call(E).style("font-size","12px");var N=H.selectAll(".axisticks1").data(m).enter().append("g").attr("class","axisticks1").attr("transform",function(a){return"translate("+w(a.key)+",0)"});N.filter(function(a,b){return b<m.length-1}).append("line").attr("class","group1tick").attr("x1",w.rangeBand()/2+w.rangeBand()/(2-2*s)).attr("y1",r).attr("x2",w.rangeBand()/2+w.rangeBand()/(2-2*s)).attr("y2",r+o.bottom).attr("stroke","black").attr("stroke-width",1);var O=n.selectAll(".factor2group").data(function(a){return a.values}).enter().append("g").attr("class","factor2group").attr("transform",function(a){return"translate("+x(a.key)+",0)"}),P=N.selectAll(".axisticks2").data(function(a){return a.values}).enter().append("g").attr("class","axisticks2").attr("transform",function(a){return"translate("+x(a.key)+",0)"});P.filter(function(a,b){return b<m[0].values.length-1}).append("line").attr("class","group2tick").attr("x1",x.rangeBand()/2+x.rangeBand()/(2-2*t)).attr("y1",r).attr("x2",x.rangeBand()/2+x.rangeBand()/(2-2*t)).attr("y2",r+o.bottom/3).attr("stroke","black").attr("stroke-width",1);var Q=O.selectAll(".factor3group").data(function(a){return a.values}).enter().append("g").attr("class","factor3group").attr("transform",function(a){return"translate("+y(a.key)+",0)"}),R=P.selectAll(".axisticks3").data(function(a){return a.values}).enter().append("g").attr("class","axisticks3").attr("transform",function(a){return"translate("+y(a.key)+",0)"});R.filter(function(a,b){return b<m[0].values[0].values.length-1}).append("line").attr("class","group3tick").attr("x1",y.rangeBand()/2+y.rangeBand()/(2-2*u)).attr("y1",r).attr("x2",y.rangeBand()/2+y.rangeBand()/(2-2*u)).attr("y2",r+o.bottom/5).attr("stroke","black").attr("stroke-width",1),V(".x0.axis text",w.rangeBand(),16),V(".x1.axis text",x.rangeBand(),12),H.select("g.x.x0.axis").call(D),n.call(E),O.append("g").attr("class","x2 axis").attr("transform","translate(0,"+r+")").call(F).style("font-size","10px").selectAll("text").style("text-anchor","middle"),V(".x2.axis text",y.rangeBand(),10),O.call(F),H.selectAll(".axis line").style({fill:"none",stroke:"#000","shape-rendering":"crispEdges"}),H.selectAll(".axis path").style({fill:"none",stroke:"#000","shape-rendering":"crispEdges"}),H.selectAll(".tick line").style("opacity","0.2"),H.selectAll(".x.axis path").style("display","inline-block");var S=Q.selectAll("rect").data(function(a){return a.values}).enter().append("rect").attr("class","databar").attr("width",z.rangeBand()).attr("height",function(a){return Math.abs(A(a.values[0][d])-A(0))}).style("fill",function(a){return B(a.key)}).attr("x",function(a){return z(a.key)}).attr("y",r).transition().duration(500).attr("y",function(a){return A(Math.max(0,a.values[0][d]))});Q.selectAll("rect").on("mouseover",function(a){var b=d3.transform(d3.select(this.parentNode).attr("transform")),c=b.translate[0],e=d3.transform(d3.select(this.parentNode.parentNode).attr("transform")),f=e.translate[0],g=d3.transform(d3.select(this.parentNode.parentNode.parentNode).attr("transform")),h=g.translate[0],i=parseFloat(d3.select(this).attr("x"))+c+f+h+z.rangeBand()/2;if(a.values[0][d]>=0)var j=parseFloat(d3.select(this).attr("y"))+1*parseFloat(d3.select(this).attr("height"))/4;else if(a.values[0][d]<0)var j=A(0)+3*parseFloat(d3.select(this).attr("height"))/4;H.append("circle").attr("class","tooltip").attr("r",Math.max(z.rangeBand()/3,20)).attr("cx",i).attr("cy",j).style("fill","aliceblue").style("pointer-events","none").style("stroke","black").style("stroke-width","1px").style("stroke-opacity",.8).attr("fill-opacity",.8),H.append("text").attr("class","tooltip").attr("x",i).attr("y",j).attr("dy","5px").attr("text-anchor","middle").attr("font-size","11px").attr("font-weight","bold").attr("fill","black").style("pointer-events","none").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").text(a.values[0][d]),V("text.tooltip",Math.max(.5*z.rangeBand()-1,35),16,12)}).on("mouseout",function(){d3.selectAll(".tooltip").transition().duration(100).attr("fill-opacity",0).style("stroke-opacity",0).remove()});var W=Q.selectAll(".errorbars").data(function(a){return a.values}).enter().append("g").attr("class","errorbars").style("pointer-events","none").attr("transform",function(a){var b=z(a.key)+z.rangeBand()/2;return"translate("+b+", 0 )"});W.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",C).attr("x1",0).attr("y1",r).attr("x2",0).attr("y2",r).transition().duration(500).attr("x1",0).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return A(b)}).attr("x2",0).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return A(b)}),W.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",C).attr("x1",-z.rangeBand()/4).attr("y1",r).attr("x2",z.rangeBand()/4).attr("y2",r).transition().duration(500).attr("x1",-z.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]+a.values[0].stderror;return A(b)}).attr("x2",z.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]+a.values[0].stderror;return A(b)}).attr("stroke","black").attr("stroke-width",C),W.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",C).attr("x1",-z.rangeBand()/4).attr("y1",r).attr("x2",z.rangeBand()/4).attr("y2",r).transition().duration(500).attr("x1",-z.rangeBand()/4).attr("y1",function(a){var b=a.values[0][d]-a.values[0].stderror;return A(b)}).attr("x2",z.rangeBand()/4).attr("y2",function(a){var b=a.values[0][d]-a.values[0].stderror;return A(b)}).attr("stroke","black").attr("stroke-width",C);var X=H.selectAll(".legend").data(m[0].values[0].values[0].values).enter().append("g").attr("class","legend").attr("transform",function(a,b){var c=20*b+20;return"translate(0,"+c+")"});X.append("rect").attr("x",q).attr("width",18).attr("height",18).style("fill",function(a){return B(a.key)}),X.append("text").attr("x",q-6).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){return a.key});var Y=H.append("g").attr("transform",function(){var a=q+18;return"translate("+a+",8)"}).append("text").attr("class","legendtitle").style("font-weight","bold").text(h).attr("x",0).attr("y",0).style("text-anchor","end"),Z=H.append("g").attr("class","axiscontrolstitle").attr("transform",function(){var a=q+18,b=20*m[0].values[0].values[0].values.length+60;return"translate("+a+","+b+")"});Z.append("text").text("X axis Flips").attr("x",-T/2).attr("y",0).style("fill","steelblue").style("text-anchor","middle").style("font-weight","bold");var $=["Flip "+h,"Flip "+g,"Flip "+f,"Flip "+e],_=[e+","+f+","+g+","+h,e+","+f+","+h+","+g,e+","+g+","+f+","+h,e+","+g+","+h+","+f,e+","+h+","+f+","+g,e+","+h+","+g+","+f,f+","+e+","+g+","+h,f+","+e+","+h+","+g,f+","+g+","+e+","+h,f+","+g+","+h+","+e,f+","+h+","+e+","+g,f+","+h+","+g+","+e,g+","+e+","+f+","+h,g+","+e+","+h+","+f,g+","+f+","+e+","+h,g+","+f+","+h+","+e,g+","+h+","+e+","+f,g+","+h+","+f+","+e,h+","+e+","+f+","+g,h+","+e+","+g+","+f,h+","+f+","+e+","+g,h+","+f+","+g+","+e,h+","+g+","+e+","+f,h+","+g+","+f+","+e],aa=H.selectAll(".morphbutton").data($).enter().append("g").attr("class",function(a,b){return"morphbutton"+b}).attr("transform",function(a,b){var c=q-T+18,d=20*m[0].values[0].values[0].values.length+21*b+90;return"translate("+c+","+d+")"});aa.append("rect").attr("width",T).attr("height",U).attr("rx","5").attr("ry","5").style("fill","#C0C0C0").on("mousedown",function(){d3.select(this).style("fill","darkgrey")}).on("mouseout",function(){d3.select(this).style("fill","#C0C0C0")}).on("mouseup",function(){d3.select(this).style("fill","#C0C0C0")}),aa.append("text").text(function(a){return a}).classed("morphtext",!0).attr("x",T/2).attr("y",15).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").style("text-anchor","middle").style("fill","white").style("pointer-events","none").style("font-size","1px").style("font-size",function(a){var b=this.getBBox(),e=(b.width,b.height,Math.min(T/(b.width+1),U/b.height,16));return e+"px"});var ba=d3.select(b).append("div").text("Factor Hierarchy (last is legend)").style("font-style","italic").style("color","steelblue"),ca=d3.select(b).append("select").attr("class","select").attr("name","redrawlist").attr("transform",function(){var a=q-T+18,b=20*m[0].values[0].values[0].values.length+21*$.length+130;return"translate("+a+","+b+")"}),da=ca.selectAll("option").data(_).enter().append("option");da.text(function(a){return a}).attr("value",function(a){return a}).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").style("font-size","12px"),V(".morphtext",T-5,16),aa.filter(function(a,b){return"morphbutton0"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==M&&(M=1,0==I?(z.rangeRoundBands([y.rangeBand(),0]),I=1):1==I&&(z.rangeRoundBands([0,y.rangeBand()]),I=0),Q.selectAll("rect").data(function(a){return a.values}).transition().attr("width",z.rangeBand()).attr("x",function(a){return z(a.key)}).attr("y",function(a){return A(Math.max(0,a.values[0][d]))}).attr("height",function(a){return Math.abs(A(a.values[0][d])-A(0))}).style("fill",function(a){return B(a.key)}),Q.selectAll(".errorbars").data(function(a){return a.values}).transition().attr("transform",function(a){var b=z(a.key)+z.rangeBand()/2;return"translate("+b+", 0 )"}).each("end",function(){M=0}))}),aa.filter(function(a,b){return"morphbutton1"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==M&&(M=1,0==J?(y.rangeRoundBands([x.rangeBand(),0],u),J=1):1==J&&(y.rangeRoundBands([0,x.rangeBand()],u),J=0),O.selectAll(".x2.axis").transition().call(F),O.selectAll("g.factor3group").data(function(a){return a.values}).transition().attr("transform",function(a){return"translate("+y(a.key)+",0)"}),setTimeout(function(){M=0},500))}),aa.filter(function(a,b){return"morphbutton2"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==M&&(M=1,0==K?(x.rangeRoundBands([w.rangeBand(),0],t),K=1):1==K&&(x.rangeRoundBands([0,w.rangeBand()],t),K=0),n.selectAll(".x1.axis").transition().call(E),n.selectAll("g.factor2group").data(function(a){return a.values}).transition().attr("transform",function(a){return"translate("+x(a.key)+",0)"}),setTimeout(function(){M=0},500))}),aa.filter(function(a,b){return"morphbutton3"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==M&&(M=1,0==L?(w.rangeRoundBands([p,0],s),L=1):1==L&&(w.rangeRoundBands([0,p],s),L=0),H.select("g.x.x0.axis").transition().call(D),H.selectAll("g.factor1group").data(m).transition().attr("transform",function(a){return"translate("+w(a.key)+",0)"}),setTimeout(function(){M=0},500))}),ca.on("change",ea)})}var colorpalettes={defaultcolors:{2:["#5DA5DA","#60BD68"],3:["#5DA5DA","#60BD68","#F15854"],4:["#5DA5DA","#F15854","#60BD68","#845C59"],5:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A"],6:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E"],7:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E","#F17CB0"],8:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E","#F17CB0","#DECF3F"],9:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E","#F17CB0","#DECF3F","#B276B2"],10:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E","#F17CB0","#DECF3F","#B276B2","#C2D580"]}};