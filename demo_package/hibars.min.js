function hibars(a){function O(a){return Math.abs(a)<1e3?d3.format(" ")(a):Math.abs(a)>=1e3&&Math.abs(a)<1e6?a/1e3+"k":Math.abs(a)>=1e6&&Math.abs(a)<1e9?d3.format(" ")(a/1e6)+"M":Math.abs(a)>=1e9&&Math.abs(a)<1e12?d3.format(" ")(a/1e9)+"B":Math.abs(a)>=1e12&&Math.abs(a)<1e15?d3.format(" ")(a/1e12)+"T":Math.abs(a)>=1e15&&Math.abs(a)<1e18?d3.format(" ")(a/1e15)+"P":Math.abs(a)>=1e18&&Math.abs(a)<1e21?d3.format(" ")(a/1e18)+"E":Math.abs(a)>=1e21&&Math.abs(a)<1e24?d3.format(" ")(a/1e21)+"Z":d3.format(" ")(a/1e24)+"Y"}function ea(a,b,c,d,e){var f=[];if(Q.selectAll(a).style("font-size","1px").each(function(){var a=this.getBBox();null==a.width&&(a.width=10),null==a.height&&(a.height=1),f.push(b/a.width),c&&f.push(c/a.height)}),d&&f.push(d),e)var g=Math.max(d3.min(f),e);else var g=d3.min(f);return Q.selectAll(a).style("font-size",g+"px"),g}var b="#"+a.location,c=a.datafile,d=a.dependent,e=a.factor1,f=a.factor2,g=2;if(a.factor3){var h=a.factor3;g=3}if(a.factor4){var m=a.factor4;g=4}var n=a.chartwidth||800,o=a.chartheight||500,p=a.colorscheme||colorpalettes.defaultcolors,q=a.auto_size||"no",r=a.controls||"yes",s=a.y_reference||0,t=a.errors||"stderror";if(a.errorLO&&a.errorHI)var u=a.errorLO,v=a.errorHI;var w={top:.04*o,right:.025*n,bottom:.12*o,left:.09375*n,legend:.15*n},x=n-w.left-w.right-w.legend,z=(n-w.left-w.right,o-w.top-w.bottom),A=.1,B=.1,C=.1;4==g&&(A=.05);var D,E=d3.scaleBand().rangeRound([0,x]).padding(A),F=d3.scaleBand(),G=d3.scaleBand(),H=d3.scaleBand(),I=d3.scaleLinear().range([z,0]),K=Math.min(.0025*n,.004*o),L=d3.axisBottom().scale(E).tickSize(0).tickPadding(2*w.bottom/3),M=d3.axisBottom().tickSize(0).tickPadding(1*w.bottom/5);if(4==g){var N=d3.axisBottom().tickSizeInner(0).tickSizeOuter(0).tickPadding(1*w.bottom/8);L.tickPadding(3*w.bottom/5),M.tickPadding(1*w.bottom/3)}var P=d3.axisLeft().scale(I).tickFormat(function(a){return O(a)}).tickSizeInner(-x).tickSizeOuter(0).tickPadding(.0125*n);if("no"==q)var Q=d3.select(b).style("text-align","center").append("svg").attr("width",x+w.left+w.right+w.legend).attr("height",z+w.top+w.bottom).append("g").attr("transform","translate("+w.left+","+w.top+")");else if("yes"==q)var R=d3.select(b).style("text-align","center").append("div").style("display","inline-block").style("position","relative").style("width","100%").style("padding-bottom","calc(100% * "+o/n+")").style("vertical-align","top").style("overflow","hidden"),Q=R.append("svg").attr("viewBox","0 0 "+n+" "+o).attr("preserveAspectRatio","xMinYMin meet").style("display","inline-block").style("position","absolute").style("top","0px").style("left","0px").append("g").attr("transform","translate("+w.left+","+w.top+")");var Z,$,_,S=0,T=0,U=0,V=0,W=0,X=1,Y=1,ba=.95*w.legend,ca=.05*z,da=.9*Math.min(ba,ca,.5*w.legend);d3.csv(c,function(a,c){function Ba(){var a=d3.event.target.value,b=a.split(",");0==W&&(W=1,S=0,T=0,U=0,V=0,Ca(b[0],b[1],b[2],b[3]))}function Ca(a,b,e,f){if(2==g){for(q=d3.nest().key(function(b){return b[a]}).key(function(a){return a[b]}).entries(c),i=0;i<q.length;i++)for(j=0;j<q[i].values.length;j++)u&&v?(q[i].values[j].values[0].errorHI=+q[i].values[j].values[0][v],q[i].values[j].values[0].errorLO=+q[i].values[j].values[0][u]):(q[i].values[j].values[0].errorHI=+q[i].values[j].values[0][d]+ +q[i].values[j].values[0][t],q[i].values[j].values[0].errorLO=+q[i].values[j].values[0][d]-+q[i].values[j].values[0][t]),q[i].values[j].values[0][d]=+q[i].values[j].values[0][d];E.domain(q.map(function(a){return a.key})).rangeRound([0,x]).padding(A),F.domain(q[0].values.map(function(a){return a.key})).rangeRound([0,E.bandwidth()]),ma=q[0]}else if(3==g){for(q=d3.nest().key(function(b){return b[a]}).key(function(a){return a[b]}).key(function(a){return a[e]}).entries(c),i=0;i<q.length;i++)for(j=0;j<q[i].values.length;j++)for(k=0;k<q[i].values[j].values.length;k++)u&&v?(q[i].values[j].values[k].values[0].errorHI=+q[i].values[j].values[k].values[0][v],q[i].values[j].values[k].values[0].errorLO=+q[i].values[j].values[k].values[0][u]):(q[i].values[j].values[k].values[0].errorHI=+q[i].values[j].values[k].values[0][d]+ +q[i].values[j].values[k].values[0][t],q[i].values[j].values[k].values[0].errorLO=+q[i].values[j].values[k].values[0][d]-+q[i].values[j].values[k].values[0][t]),q[i].values[j].values[k].values[0][d]=+q[i].values[j].values[k].values[0][d];E.domain(q.map(function(a){return a.key})).rangeRound([0,x]).padding(A),F.domain(q[0].values.map(function(a){return a.key})).rangeRound([0,E.bandwidth()]).padding(B),G.domain(q[0].values[0].values.map(function(a){return a.key})).rangeRound([0,F.bandwidth()]),ma=q[0].values[0]}else if(4==g){for(q=d3.nest().key(function(b){return b[a]}).key(function(a){return a[b]}).key(function(a){return a[e]}).key(function(a){return a[f]}).entries(c),i=0;i<q.length;i++)for(j=0;j<q[i].values.length;j++)for(k=0;k<q[i].values[j].values.length;k++)for(l=0;l<q[i].values[j].values[k].values.length;l++)u&&v?(q[i].values[j].values[k].values[l].values[0].errorHI=+q[i].values[j].values[k].values[l].values[0][v],q[i].values[j].values[k].values[l].values[0].errorLO=+q[i].values[j].values[k].values[l].values[0][u]):(q[i].values[j].values[k].values[l].values[0].errorHI=+q[i].values[j].values[k].values[l].values[0][d]+ +q[i].values[j].values[k].values[l].values[0][t],q[i].values[j].values[k].values[l].values[0].errorLO=+q[i].values[j].values[k].values[l].values[0][d]-+q[i].values[j].values[k].values[l].values[0][t]),q[i].values[j].values[k].values[l].values[0][d]=+q[i].values[j].values[k].values[l].values[0][d];E.domain(q.map(function(a){return a.key})).rangeRound([0,x]).padding(A),F.domain(q[0].values.map(function(a){return a.key})).rangeRound([0,E.bandwidth()]).padding(B),G.domain(q[0].values[0].values.map(function(a){return a.key})).rangeRound([0,F.bandwidth()]).padding(C),H.domain(q[0].values[0].values[0].values.map(function(a){return a.key})).rangeRound([0,G.bandwidth()]),ma=q[0].values[0].values[0]}D=ma.values.length,y.domain(ma.values.map(function(a){return a.key})),y.range(function(){return p[D]||colorpalettes.defaultcolors[D]}()),Q.selectAll(".databar").transition().duration(500).attr("y",1e3).transition().remove(),Q.selectAll(".errorline").transition().duration(500).attr("y1",1e3).attr("y2",1e3).transition().remove(),setTimeout(function(){L.scale(E),g>2&&M.scale(F),g>3&&N.scale(G),Q.select(".x.axis").call(L),J=J.data([]).exit().remove(),R=R.data([]).exit().remove(),J=Q.selectAll(".factor1group").data(q).enter().append("g").attr("class","factor1group").attr("transform",function(a){return"translate("+E(a.key)+",0)"}),g>2&&J.append("g").attr("class","x1 axis").attr("transform","translate(0,"+z+")").call(M).style("font-size","12px"),R=Q.selectAll(".axisticks1").data(q).enter().append("g").attr("class","axisticks1").attr("transform",function(a){return"translate("+E(a.key)+",0)"}),R.filter(function(a,b){return b<q.length-1}).append("line").attr("class","group1tick").attr("x1",E.bandwidth()/2+E.bandwidth()/(2-2*A)).attr("y1",z).attr("x2",E.bandwidth()/2+E.bandwidth()/(2-2*A)).attr("y2",z+w.bottom).attr("stroke","black").attr("stroke-width",.002*o),g>2&&(aa=J.selectAll(".factor2group").data(function(a){return a.values}).enter().append("g").attr("class","factor2group").attr("transform",function(a){return"translate("+F(a.key)+",0)"}),fa=R.selectAll(".axisticks2").data(function(a){return a.values}).enter().append("g").attr("class","axisticks2").attr("transform",function(a){return"translate("+F(a.key)+",0)"}),fa.filter(function(a,b){return b<q[0].values.length-1}).append("line").attr("class","group2tick").attr("x1",F.bandwidth()/2+F.bandwidth()/(2-2*B)).attr("y1",z).attr("x2",F.bandwidth()/2+F.bandwidth()/(2-2*B)).attr("y2",z+w.bottom/3).attr("stroke","black").attr("stroke-width",.002*o)),g>3&&(ga=aa.selectAll(".factor3group").data(function(a){return a.values}).enter().append("g").attr("class","factor3group").attr("transform",function(a){return"translate("+G(a.key)+",0)"}),ha=fa.selectAll(".axisticks3").data(function(a){return a.values}).enter().append("g").attr("class","axisticks3").attr("transform",function(a){return"translate("+G(a.key)+",0)"}),ha.filter(function(a,b){return b<q[0].values[0].values.length-1}).append("line").attr("class","group3tick").attr("x1",G.bandwidth()/2+G.bandwidth()/(2-2*C)).attr("y1",z).attr("x2",G.bandwidth()/2+G.bandwidth()/(2-2*C)).attr("y2",z+w.bottom/5).attr("stroke","black").attr("stroke-width",.002*o)),ea(".x0.axis text",.95*E.bandwidth(),.3*w.bottom),g>2&&ea(".x1.axis text",.95*F.bandwidth(),.25*w.bottom),g>3&&ea(".x2.axis text",.95*G.bandwidth(),.2*w.bottom,Math.min(.0125*n,.02*o)),Q.select("g.x.x0.axis").call(L),g>2&&J.call(M),g>3&&(aa.append("g").attr("class","x2 axis").attr("transform","translate(0,"+z+")").call(N).style("font-size","10px").selectAll("text").style("text-anchor","middle"),ea(".x2.axis text",.95*G.bandwidth(),.2*w.bottom,Math.min(.0125*n,.02*o)),aa.call(N)),Q.selectAll(".axis path").attr("stroke-width",.002*o),Q.selectAll("g.x1, g.x2").selectAll("path").attr("display","none"),2==g?(ja=F,ka=E,la=J,ma=q[0],na=b):3==g?(ja=G,ka=F,la=aa,ma=q[0].values[0],na=e):4==g&&(ja=H,ka=G,la=ga,ma=q[0].values[0].values[0],na=f),ia.indexOf(s)==-1&&(d3.select("text.y.axis.reftext").remove(),Q.append("text").attr("class","y axis reftext").attr("x",0).attr("y",I(s)).attr("dy",-.004*o).text(O(s)).attr("text-anchor","start").attr("font-weight","bold").attr("font-style","italic").attr("fill","black").style("pointer-events","none").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif"),Q.selectAll(".y.axis").style("font-size",function(){return Math.min(.032*o,.032*n,.15*w.left)+"px"})),pa=la.selectAll("rect").data(function(a){return a.values}).enter().append("rect").attr("class","databar").attr("width",ja.bandwidth()).attr("height",function(a){return Math.abs(I(a.values[0][d])-I(s))}).style("fill",function(a){return y(a.key)}).attr("x",function(a){return ja(a.key)}).attr("y",z).transition().duration(500).attr("y",function(a){return a.values[0][d]>=s?(a.values[0].adj=Math.min(50/o,.5),I(a.values[0][d])+a.values[0].adj):a.values[0][d]<s?(a.values[0].adj=1-Math.min(50/o,.5),I(s)+a.values[0].adj):void 0}),la.selectAll("rect").on("mouseover",function(a){var b=d3.select(this.parentNode).attr("transform"),c=b.substring(b.indexOf("(")+1,b.indexOf(")")).split(","),e=Number(c[0]),f=0;if(g>2){var h=d3.select(this.parentNode.parentNode).attr("transform"),i=h.substring(h.indexOf("(")+1,h.indexOf(")")).split(",");f=Number(i[0])}var j=0;if(g>3){var k=d3.select(this.parentNode.parentNode.parentNode).attr("transform"),l=k.substring(k.indexOf("(")+1,k.indexOf(")")).split(",");j=Number(l[0])}var m=parseFloat(d3.select(this).attr("x"))+e+f+j+ja.bandwidth()/2;if(a.values[0][d]>=s)var p=parseFloat(d3.select(this).attr("y"))+1*parseFloat(d3.select(this).attr("height"))/4;else if(a.values[0][d]<s)var p=I(s)+3*parseFloat(d3.select(this).attr("height"))/4;var q=Math.max(ja.bandwidth()/2.5,.02*n,.02*o);Q.append("circle").attr("class","tooltip").attr("r",q).attr("cx",m).attr("cy",p).style("fill","aliceblue").style("pointer-events","none").style("stroke","black").style("stroke-width",.002*o+"px").style("stroke-opacity",.8).attr("fill-opacity",.8),Q.append("text").attr("class","tooltip").attr("x",m).attr("y",p).attr("dy",.35*q+"px").attr("text-anchor","middle").attr("fill","black").style("pointer-events","none").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").text(a.values[0][d]);var r=ea("text.tooltip",3*q/2,q);d3.selectAll("text.tooltip").attr("dy",r/2.5+"px")}).on("mouseout",function(){d3.selectAll(".tooltip").transition().duration(100).attr("fill-opacity",0).style("stroke-opacity",0).remove()}),qa=la.selectAll(".errorbars").data(function(a){return a.values}).enter().append("g").attr("class","errorbars").style("pointer-events","none").attr("transform",function(a){var b=ja(a.key)+ja.bandwidth()/2;return"translate("+b+", 0 )"}),qa.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",K).attr("x1",0).attr("y1",z).attr("x2",0).attr("y2",z).transition().duration(500).attr("x1",0).attr("y1",function(a){var b=a.values[0].errorHI;return I(b)+a.values[0].adj}).attr("x2",0).attr("y2",function(a){var b=a.values[0].errorLO;return I(b)+a.values[0].adj}),qa.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",K).attr("x1",-ja.bandwidth()/4).attr("y1",z).attr("x2",ja.bandwidth()/4).attr("y2",z).transition().duration(500).attr("x1",-ja.bandwidth()/4).attr("y1",function(a){var b=a.values[0].errorHI;return I(b)+a.values[0].adj}).attr("x2",ja.bandwidth()/4).attr("y2",function(a){var b=a.values[0].errorHI;return I(b)+a.values[0].adj}).attr("stroke","black").attr("stroke-width",K),qa.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",K).attr("x1",-ja.bandwidth()/4).attr("y1",z).attr("x2",ja.bandwidth()/4).attr("y2",z).transition().duration(500).attr("x1",-ja.bandwidth()/4).attr("y1",function(a){var b=a.values[0].errorLO;return I(b)+a.values[0].adj}).attr("x2",ja.bandwidth()/4).attr("y2",function(a){var b=a.values[0].errorLO;return I(b)+a.values[0].adj}).attr("stroke","black").attr("stroke-width",K),ra.data([]).exit().remove(),ra=Q.selectAll(".legend").data(ma.values).enter().append("g").attr("class","legend").attr("transform",function(a,b){var c=b*da*1.1+da;return"translate(0,"+c+")"}),ra.append("rect").attr("x",n-w.left-da).attr("width",da).attr("height",da).style("fill",function(a){return y(a.key)}),ra.append("text").attr("x",.991489*(n-w.left-da)).attr("y",da/2).attr("dy",da/3.2).style("text-anchor","end").text(function(a){return a.key}).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").classed("legendtext",!0).style("font-size","1px"),sa.text(na).attr("class","legendtitle").style("font-weight","normal"),ea("text.legendtext",w.legend-da,.8*da),ea("text.legendtitle",.8*w.legend,da),d3.selectAll("text.legendtitle").style("font-weight","bold"),ta.transition().attr("transform",function(){var a=n-w.left,b=ma.values.length*da*1.1+3*da;return"translate("+a+","+b+")"}),ua.transition().attr("transform",function(){var a=n-w.left,b=ma.values.length*da*1.1+3*da+2*ca;return"translate("+a+","+b+")"}),xa.transition().attr("transform",function(a,b){var c=n-w.left-ba,d=ma.values.length*da*1.1+b*(1.1*ca)+3*da+2.5*ca;return"translate("+c+","+d+")"}),g<4&&(ya.transition().attr("transform",function(){var a=n-w.left,b=ma.values.length*da*1.1+3*da+va.length*(1.1*ca)+4*ca;return"translate("+a+","+b+")"}),za.transition().attr("transform",function(a,b){var c=n-w.left-ba,d=ma.values.length*da*1.1+3*da+va.length*(1.1*ca)+b*(1.1*ca)+4.5*ca;return"translate("+c+","+d+")"})),2==g?(xa.filter(function(a,b){return"morphbutton0"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+b),xa.filter(function(a,b){return"morphbutton1"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+a)):3==g?(xa.filter(function(a,b){return"morphbutton0"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+e),xa.filter(function(a,b){return"morphbutton1"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+b),xa.filter(function(a,b){return"morphbutton2"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+a)):4==g&&(xa.filter(function(a,b){return"morphbutton0"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+f),xa.filter(function(a,b){return"morphbutton1"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+e),xa.filter(function(a,b){return"morphbutton2"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+b),xa.filter(function(a,b){return"morphbutton3"==d3.select(this).attr("class")}).selectAll("text").text("Flip "+a)),W=0},500)}if(a)throw a;if(2==g){var q=d3.nest().key(function(a){return a[e]}).key(function(a){return a[f]}).entries(c);for(i=0;i<q.length;i++)for(j=0;j<q[i].values.length;j++)u&&v?(q[i].values[j].values[0].errorHI=+q[i].values[j].values[0][v],q[i].values[j].values[0].errorLO=+q[i].values[j].values[0][u]):(q[i].values[j].values[0].errorHI=+q[i].values[j].values[0][d]+ +q[i].values[j].values[0][t],q[i].values[j].values[0].errorLO=+q[i].values[j].values[0][d]-+q[i].values[j].values[0][t]),q[i].values[j].values[0][d]=+q[i].values[j].values[0][d];E.domain(q.map(function(a){return a.key})),F.domain(q[0].values.map(function(a){return a.key})).rangeRound([0,E.bandwidth()]),D=q[0].values.length,I.domain([Math.min(s,d3.min(q,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return a.errorLO})})})),Math.max(s,d3.max(q,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return a.errorHI})})}))]).nice()}else if(3==g){var q=d3.nest().key(function(a){return a[e]}).key(function(a){return a[f]}).key(function(a){return a[h]}).entries(c);for(i=0;i<q.length;i++)for(j=0;j<q[i].values.length;j++)for(k=0;k<q[i].values[j].values.length;k++)u&&v?(q[i].values[j].values[k].values[0].errorHI=+q[i].values[j].values[k].values[0][v],q[i].values[j].values[k].values[0].errorLO=+q[i].values[j].values[k].values[0][u]):(q[i].values[j].values[k].values[0].errorHI=+q[i].values[j].values[k].values[0][d]+ +q[i].values[j].values[k].values[0][t],q[i].values[j].values[k].values[0].errorLO=+q[i].values[j].values[k].values[0][d]-+q[i].values[j].values[k].values[0][t]),q[i].values[j].values[k].values[0][d]=+q[i].values[j].values[k].values[0][d];E.domain(q.map(function(a){return a.key})),F.domain(q[0].values.map(function(a){return a.key})).rangeRound([0,E.bandwidth()]).padding(B),G.domain(q[0].values[0].values.map(function(a){return a.key})).rangeRound([0,F.bandwidth()]),M.scale(F),D=q[0].values[0].values.length,I.domain([Math.min(s,d3.min(q,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return a.errorLO})})})})),Math.max(s,d3.max(q,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return a.errorHI})})})}))]).nice(),ca=Math.min(.05*z,(z-q[0].values[0].values[0].values.length*da*1.1)/16,(z-q[0].values[0].values.length*da*1.1)/16,(z-q[0].values.length*da*1.1)/16,da)}else if(4==g){var q=d3.nest().key(function(a){return a[e]}).key(function(a){return a[f]}).key(function(a){return a[h]}).key(function(a){return a[m]}).entries(c);for(i=0;i<q.length;i++)for(j=0;j<q[i].values.length;j++)for(k=0;k<q[i].values[j].values.length;k++)for(l=0;l<q[i].values[j].values[k].values.length;l++)u&&v?(q[i].values[j].values[k].values[l].values[0].errorHI=+q[i].values[j].values[k].values[l].values[0][v],q[i].values[j].values[k].values[l].values[0].errorLO=+q[i].values[j].values[k].values[l].values[0][u]):(q[i].values[j].values[k].values[l].values[0].errorHI=+q[i].values[j].values[k].values[l].values[0][d]+ +q[i].values[j].values[k].values[l].values[0][t],q[i].values[j].values[k].values[l].values[0].errorLO=+q[i].values[j].values[k].values[l].values[0][d]-+q[i].values[j].values[k].values[l].values[0][t]),q[i].values[j].values[k].values[l].values[0][d]=+q[i].values[j].values[k].values[l].values[0][d];E.domain(q.map(function(a){return a.key})),F.domain(q[0].values.map(function(a){return a.key})).rangeRound([0,E.bandwidth()]).padding(B),G.domain(q[0].values[0].values.map(function(a){return a.key})).rangeRound([0,F.bandwidth()]).padding(C),H.domain(q[0].values[0].values[0].values.map(function(a){return a.key})).rangeRound([0,G.bandwidth()]),M.scale(F),N.scale(G),D=q[0].values[0].values[0].values.length,I.domain([Math.min(s,d3.min(q,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return d3.min(a.values,function(a){return a.errorLO})})})})})),Math.max(s,d3.max(q,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return d3.max(a.values,function(a){return a.errorHI})})})})}))]).nice()}var y=d3.scaleOrdinal().range(function(){return p[D]||colorpalettes.defaultcolors[D]}());Q.append("g").attr("class","x x0 axis").attr("transform","translate(0,"+z+")").call(L),Q.append("g").attr("class","y axis").call(P),Q.append("text").attr("transform","rotate(-90)").attr("x",-z/2).attr("y",function(a){var b=this.getBBox(),e=(b.width,b.height,-w.left+Math.min(x/(1.1*b.height),.03*n));return e}).style("text-anchor","middle").text(d).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").style("font-size","1px").style("font-size",function(a){var b=this.getBBox(),e=(b.width,b.height,Math.min(z/(1.1*b.width),.35*w.left/(1.1*b.height)));return e+"px"});var J=Q.selectAll(".factor1group").data(q).enter().append("g").attr("class","factor1group").attr("transform",function(a){return"translate("+E(a.key)+",0)"});g>2&&J.append("g").attr("class","x1 axis").attr("transform","translate(0,"+z+")").call(M).style("font-size","12px");var R=Q.selectAll(".axisticks1").data(q).enter().append("g").attr("class","axisticks1").attr("transform",function(a){return"translate("+E(a.key)+",0)"});if(R.filter(function(a,b){return b<q.length-1}).append("line").attr("class","group1tick").attr("x1",E.bandwidth()/2+E.bandwidth()/(2-2*A)).attr("y1",z).attr("x2",E.bandwidth()/2+E.bandwidth()/(2-2*A)).attr("y2",z+w.bottom).attr("stroke","black").attr("stroke-width",.002*o),g>2){var aa=J.selectAll(".factor2group").data(function(a){return a.values}).enter().append("g").attr("class","factor2group").attr("transform",function(a){return"translate("+F(a.key)+",0)"}),fa=R.selectAll(".axisticks2").data(function(a){return a.values}).enter().append("g").attr("class","axisticks2").attr("transform",function(a){return"translate("+F(a.key)+",0)"});fa.filter(function(a,b){return b<q[0].values.length-1}).append("line").attr("class","group2tick").attr("x1",F.bandwidth()/2+F.bandwidth()/(2-2*B)).attr("y1",z).attr("x2",F.bandwidth()/2+F.bandwidth()/(2-2*B)).attr("y2",z+w.bottom/3).attr("stroke","black").attr("stroke-width",.002*o)}if(g>3){var ga=aa.selectAll(".factor3group").data(function(a){return a.values}).enter().append("g").attr("class","factor3group").attr("transform",function(a){return"translate("+G(a.key)+",0)"}),ha=fa.selectAll(".axisticks3").data(function(a){return a.values}).enter().append("g").attr("class","axisticks3").attr("transform",function(a){return"translate("+G(a.key)+",0)"});ha.filter(function(a,b){return b<q[0].values[0].values.length-1}).append("line").attr("class","group3tick").attr("x1",G.bandwidth()/2+G.bandwidth()/(2-2*C)).attr("y1",z).attr("x2",G.bandwidth()/2+G.bandwidth()/(2-2*C)).attr("y2",z+w.bottom/5).attr("stroke","black").attr("stroke-width",.002*o)}ea(".x0.axis text",.95*E.bandwidth(),.3*w.bottom),g>2&&ea(".x1.axis text",.95*F.bandwidth(),.25*w.bottom),Q.select("g.x.x0.axis").call(L),g>2&&J.call(M),g>3&&(aa.append("g").attr("class","x2 axis").attr("transform","translate(0,"+z+")").call(N).style("font-size","10px").selectAll("text").style("text-anchor","middle"),ea(".x2.axis text",.95*G.bandwidth(),.2*w.bottom,Math.min(.0125*n,.02*o)),aa.call(N));var ia=[];if(Q.selectAll("g.tick").each(function(a){!isNaN(parseFloat(a))&&isFinite(a)&&ia.push(a)}),Q.selectAll("g.tick").filter(function(a){return a!=s}).select("line").style("opacity","0.2"),ia.indexOf(s)==-1&&(Q.selectAll("g.y.axis").append("g").attr("class","tick refline").append("line").attr("x1",0).attr("y1",I(s)).attr("x2",x).attr("y2",I(s)).style("stroke","black").style("stroke-width",.002*o),Q.append("text").attr("class","y axis reftext").attr("x",0).attr("y",I(s)).attr("dy",-.004*o).text(O(s)).attr("text-anchor","start").attr("font-weight","bold").attr("font-style","italic").attr("fill","black").style("pointer-events","none").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif")),Q.selectAll("g.tick").select("line").attr("stroke-width",.002*o),Q.selectAll(".axis path").attr("stroke-width",.002*o),Q.selectAll("g.x1, g.x2").selectAll("path").attr("display","none"),Q.selectAll(".y.axis").style("font-size",function(){return Math.min(.032*o,.032*n,.15*w.left)+"px"}),2==g)var ja=F,ka=E,la=J,ma=q[0],na=f;else if(3==g)var ja=G,ka=F,la=aa,ma=q[0].values[0],na=h;else if(4==g)var ja=H,ka=G,la=ga,ma=q[0].values[0].values[0],na=m;var pa=la.selectAll("rect").data(function(a){return a.values}).enter().append("rect").attr("class","databar").attr("width",ja.bandwidth()).attr("height",function(a){return Math.abs(I(a.values[0][d])-I(s))}).style("fill",function(a){return y(a.key)}).attr("x",function(a){return ja(a.key)}).attr("y",z).transition().duration(500).attr("y",function(a){return a.values[0][d]>=s?(a.values[0].adj=Math.min(50/o,.5),I(a.values[0][d])+a.values[0].adj):a.values[0][d]<s?(a.values[0].adj=1-Math.min(50/o,.5),I(s)+a.values[0].adj):void 0});la.selectAll("rect").on("mouseover",function(a){var b=d3.select(this.parentNode).attr("transform"),c=b.substring(b.indexOf("(")+1,b.indexOf(")")).split(","),e=Number(c[0]),f=0;if(g>2){var h=d3.select(this.parentNode.parentNode).attr("transform"),i=h.substring(h.indexOf("(")+1,h.indexOf(")")).split(",");f=Number(i[0])}var j=0;if(g>3){var k=d3.select(this.parentNode.parentNode.parentNode).attr("transform"),l=k.substring(k.indexOf("(")+1,k.indexOf(")")).split(",");j=Number(l[0])}var m=parseFloat(d3.select(this).attr("x"))+e+f+j+ja.bandwidth()/2;if(a.values[0][d]>=s)var p=parseFloat(d3.select(this).attr("y"))+1*parseFloat(d3.select(this).attr("height"))/4;else if(a.values[0][d]<s)var p=I(s)+3*parseFloat(d3.select(this).attr("height"))/4;var q=Math.max(ja.bandwidth()/2.5,.02*n,.02*o);Q.append("circle").attr("class","tooltip").attr("r",q).attr("cx",m).attr("cy",p).style("fill","aliceblue").style("pointer-events","none").style("stroke","black").style("stroke-width",.002*o+"px").style("stroke-opacity",.8).attr("fill-opacity",.8),Q.append("text").attr("class","tooltip").attr("x",m).attr("y",p).attr("dy",.35*q+"px").attr("text-anchor","middle").attr("fill","black").style("pointer-events","none").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").text(a.values[0][d]);var r=ea("text.tooltip",3*q/2,q);d3.selectAll("text.tooltip").attr("dy",r/2.5+"px")}).on("mouseout",function(){d3.selectAll(".tooltip").transition().duration(100).attr("fill-opacity",0).style("stroke-opacity",0).remove()});var qa=la.selectAll(".errorbars").data(function(a){return a.values}).enter().append("g").attr("class","errorbars").style("pointer-events","none").attr("transform",function(a){var b=ja(a.key)+ja.bandwidth()/2;return"translate("+b+", 0 )"});qa.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",K).attr("x1",0).attr("y1",z).attr("x2",0).attr("y2",z).transition().duration(500).attr("x1",0).attr("y1",function(a){var b=a.values[0].errorHI;return I(b)+a.values[0].adj}).attr("x2",0).attr("y2",function(a){var b=a.values[0].errorLO;return I(b)+a.values[0].adj}),qa.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",K).attr("x1",-ja.bandwidth()/4).attr("y1",z).attr("x2",ja.bandwidth()/4).attr("y2",z).transition().duration(500).attr("x1",-ja.bandwidth()/4).attr("y1",function(a){var b=a.values[0].errorHI;return I(b)+a.values[0].adj}).attr("x2",ja.bandwidth()/4).attr("y2",function(a){var b=a.values[0].errorHI;return I(b)+a.values[0].adj}).attr("stroke","black").attr("stroke-width",K),qa.append("line").attr("class","errorline").attr("stroke","black").attr("stroke-width",K).attr("x1",-ja.bandwidth()/4).attr("y1",z).attr("x2",ja.bandwidth()/4).attr("y2",z).transition().duration(500).attr("x1",-ja.bandwidth()/4).attr("y1",function(a){var b=a.values[0].errorLO;return I(b)+a.values[0].adj}).attr("x2",ja.bandwidth()/4).attr("y2",function(a){var b=a.values[0].errorLO;return I(b)+a.values[0].adj}).attr("stroke","black").attr("stroke-width",K);var ra=Q.selectAll(".legend").data(ma.values).enter().append("g").attr("class","legend").attr("transform",function(a,b){var c=b*da*1.1+da;return"translate(0,"+c+")"});ra.append("rect").attr("x",n-w.left-da).attr("width",da).attr("height",da).style("fill",function(a){return y(a.key)}),ra.append("text").attr("x",.991489*(n-w.left-da)).attr("y",da/2).attr("dy",da/3.2).style("text-anchor","end").text(function(a){return a.key}).classed("legendtext",!0).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif");var sa=Q.append("g").attr("transform",function(){var a=n-w.left;return"translate("+a+","+da/2+")"}).append("text").text(na).attr("class","legendtitle").attr("x",0).attr("y",0).style("text-anchor","end").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif");if(ea("text.legendtext",w.legend-da,.8*da),ea("text.legendtitle",.8*w.legend,da),d3.selectAll("text.legendtitle").style("font-weight","bold"),"yes"==r){var ta=Q.append("g").attr("class","axiscontrolstitle").attr("transform",function(){var a=n-w.left,b=ma.values.length*da*1.1+3*da;return"translate("+a+","+b+")"});ta.append("text").text("X axis controls").attr("class","morphtext3").attr("x",-ba/2).attr("y",0).style("fill","steelblue").style("text-anchor","middle").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif");var ua=Q.append("g").attr("class","fliptitle").attr("transform",function(){var a=n-w.left,b=ma.values.length*da*1.1+3*da+2*ca;return"translate("+a+","+b+")"});if(ua.append("text").text("Flips").attr("class","morphtext3").attr("x",-ba/2).attr("y",0).style("text-anchor","middle").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif"),2==g)var va=["Flip "+f,"Flip "+e],wa=[e,f];else if(3==g)var va=["Flip "+h,"Flip "+f,"Flip "+e],wa=[e+","+f,e+","+h,f+","+e,h+","+e,f+","+h,h+","+f];else if(4==g)var va=["Flip "+m,"Flip "+h,"Flip "+f,"Flip "+e],wa=[e+","+f+","+h+","+m,e+","+f+","+m+","+h,e+","+h+","+f+","+m,e+","+h+","+m+","+f,e+","+m+","+f+","+h,e+","+m+","+h+","+f,f+","+e+","+h+","+m,f+","+e+","+m+","+h,f+","+h+","+e+","+m,f+","+h+","+m+","+e,f+","+m+","+e+","+h,f+","+m+","+h+","+e,h+","+e+","+f+","+m,h+","+e+","+m+","+f,h+","+f+","+e+","+m,h+","+f+","+m+","+e,h+","+m+","+e+","+f,h+","+m+","+f+","+e,m+","+e+","+f+","+h,m+","+e+","+h+","+f,m+","+f+","+e+","+h,m+","+f+","+h+","+e,m+","+h+","+e+","+f,m+","+h+","+f+","+e];var xa=Q.selectAll(".morphbutton").data(va).enter().append("g").attr("class",function(a,b){return"morphbutton"+b}).attr("transform",function(a,b){var c=n-w.left-ba,d=ma.values.length*da*1.1+3*da+2.5*ca+b*(1.1*ca);return"translate("+c+","+d+")"});if(xa.append("rect").attr("width",ba).attr("height",ca).attr("rx",.00625*n).attr("ry",.01*o).style("fill","#C0C0C0").on("mousedown",function(){d3.select(this).style("fill","darkgrey")}).on("mouseout",function(){d3.select(this).style("fill","#C0C0C0")}).on("mouseup",function(){d3.select(this).style("fill","#C0C0C0")}),xa.append("text").text(function(a){return a}).classed("morphtext",!0).attr("x",ba/2).attr("y",3*ca/4).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").style("text-anchor","middle").style("fill","white").style("pointer-events","none"),g<4){var ya=Q.append("g").attr("class","redrawtitle").attr("transform",function(){var a=n-w.left,b=ma.values.length*da*1.1+3*da+va.length*(1.1*ca)+4*ca;return"translate("+a+","+b+")"});ya.append("text").text("X axis structure").attr("class","morphtext3").attr("x",-ba/2).attr("y",0).style("text-anchor","middle").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif");var za=Q.selectAll(".morphbutton_2_").data(wa).enter().append("g").attr("class",function(a,b){return"morphbutton_2_"+b}).attr("transform",function(a,b){var c=n-w.left-ba,d=ma.values.length*da*1.1+3*da+va.length*(1.1*ca)+b*(1.1*ca)+4.5*ca;return"translate("+c+","+d+")"});za.append("rect").attr("width",ba).attr("height",ca).attr("rx",.00625*n).attr("ry",.01*o).style("fill","#C0C0C0").on("mousedown",function(){d3.select(this).style("fill","darkgrey")}).on("mouseout",function(){d3.select(this).style("fill","#C0C0C0")}).on("mouseup",function(){d3.select(this).style("fill","#C0C0C0")}),za.append("text").text(function(a){return a}).classed("morphtext2",!0).attr("x",ba/2).attr("y",3*ca/4).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").style("text-anchor","middle").style("fill","white").style("pointer-events","none");
}else if(g>=4){var ya=d3.select(b).append("div").text("Factor Hierarchy (last is legend)").style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").style("font-style","italic").style("color","steelblue"),za=d3.select(b).append("select").attr("class","select").attr("name","redrawlist").attr("transform",function(){var a=n-w.left-ba,b=ma.values.length*da+va.length*(1.1*ca)+7*ca;return"translate("+a+","+b+")"}),Aa=za.selectAll("option").data(wa).enter().append("option");Aa.text(function(a){return a}).attr("value",function(a){return a}).style("font-family","'Droid Sans', Helvetica, Arial, sans-serif").style("font-size","12px")}ea("text.morphtext",.9*ba,.95*ca),ea("text.morphtext2",.9*ba,.95*ca),ea("text.morphtext3",.9*ba,.95*ca),d3.selectAll(".axiscontrolstitle text").style("font-weight","bold"),d3.selectAll(".fliptitle text").style("font-style","italic"),d3.selectAll(".redrawtitle text").style("font-style","italic"),xa.filter(function(a,b){return"morphbutton0"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==W&&(W=1,0==S?(ja.rangeRound([ka.bandwidth(),0]),S=1):1==S&&(ja.rangeRound([0,ka.bandwidth()]),S=0),la.selectAll("rect").data(function(a){return a.values}).transition().attr("width",ja.bandwidth()).attr("x",function(a){return ja(a.key)}).attr("y",function(a){return I(Math.max(s,a.values[0][d]))+a.values[0].adj}).attr("height",function(a){return Math.abs(I(a.values[0][d])-I(s))}).style("fill",function(a){return y(a.key)}),la.selectAll(".errorbars").data(function(a){return a.values}).transition().attr("transform",function(a){var b=ja(a.key)+ja.bandwidth()/2;return"translate("+b+", 0 )"}).call(function(){W=0}))}),xa.filter(function(a,b){return"morphbutton1"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==W&&(W=1,2==g?(0==T?(ka.rangeRound([x,0]).padding(A),T=1):1==T&&(ka.rangeRound([0,x]).padding(A),T=0),Q.select("g.x.x0.axis").transition().call(L),Q.selectAll("g.factor1group").data(q).transition().attr("transform",function(a){return"translate("+E(a.key)+",0)"})):3==g?(0==T?(ka.rangeRound([E.bandwidth(),0]).padding(B),T=1):1==T&&(ka.rangeRound([0,E.bandwidth()]).padding(B),T=0),J.selectAll(".x1.axis").transition().call(M),J.selectAll("g.factor2group").data(function(a){return a.values}).transition().attr("transform",function(a){return"translate("+F(a.key)+",0)"})):4==g&&(0==T?(ka.rangeRound([F.bandwidth(),0]).padding(C),T=1):1==T&&(ka.rangeRound([0,F.bandwidth()]).padding(C),T=0),aa.selectAll(".x2.axis").transition().call(N),aa.selectAll("g.factor3group").data(function(a){return a.values}).transition().attr("transform",function(a){return"translate("+G(a.key)+",0)"})),setTimeout(function(){W=0},500))}),3==g&&xa.filter(function(a,b){return"morphbutton2"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==W&&(W=1,0==U?(E.rangeRound([x,0]).padding(A),U=1):1==U&&(E.rangeRound([0,x]).padding(A),U=0),Q.select("g.x.x0.axis").transition().call(L),Q.selectAll("g.factor1group").data(q).transition().attr("transform",function(a){return"translate("+E(a.key)+",0)"}),setTimeout(function(){W=0},500))}),4==g&&(xa.filter(function(a,b){return"morphbutton2"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==W&&(W=1,0==U?(F.rangeRound([E.bandwidth(),0]).padding(B),U=1):1==U&&(F.rangeRound([0,E.bandwidth()]).padding(B),U=0),J.selectAll(".x1.axis").transition().call(M),J.selectAll("g.factor2group").data(function(a){return a.values}).transition().attr("transform",function(a){return"translate("+F(a.key)+",0)"}),setTimeout(function(){W=0},500))}),xa.filter(function(a,b){return"morphbutton3"==d3.select(this).attr("class")}).style("font-style","italic").on("click",function(){0==W&&(W=1,0==V?(E.rangeRound([x,0]).padding(A),V=1):1==V&&(E.rangeRound([0,x]).padding(A),V=0),Q.select("g.x.x0.axis").transition().call(L),Q.selectAll("g.factor1group").data(q).transition().attr("transform",function(a){return"translate("+E(a.key)+",0)"}),setTimeout(function(){W=0},500))})),g<4?za.on("click",function(){"morphbutton_2_0"==d3.select(this).attr("class")&&2==g&&(Y=1,Z=e,$=f),"morphbutton_2_1"==d3.select(this).attr("class")&&2==g&&(Y=2,Z=f,$=e),"morphbutton_2_0"==d3.select(this).attr("class")&&g>2&&(Y=1,Z=e,$=f,_=h),"morphbutton_2_1"==d3.select(this).attr("class")&&g>2&&(Y=2,Z=e,$=h,_=f),"morphbutton_2_2"==d3.select(this).attr("class")&&(Y=3,Z=f,$=e,_=h),"morphbutton_2_3"==d3.select(this).attr("class")&&(Y=4,Z=h,$=e,_=f),"morphbutton_2_4"==d3.select(this).attr("class")&&(Y=5,Z=f,$=h,_=e),"morphbutton_2_5"==d3.select(this).attr("class")&&(Y=6,Z=h,$=f,_=e),0==W&&X!==Y&&(W=1,X=Y,S=0,T=0,U=0,2==g?Ca(Z,$):3==g&&Ca(Z,$,_))}):g>=4&&za.on("change",Ba)}})}var colorpalettes={defaultcolors:{1:["#5DA5DA"],2:["#5DA5DA","#60BD68"],3:["#5DA5DA","#60BD68","#F15854"],4:["#5DA5DA","#F15854","#60BD68","#845C59"],5:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A"],6:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E"],7:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E","#F17CB0"],8:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E","#F17CB0","#DECF3F"],9:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E","#F17CB0","#DECF3F","#B276B2"],10:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E","#F17CB0","#DECF3F","#B276B2","#C2D580"],11:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E","#F17CB0","#DECF3F","#B276B2","#C2D580","4D4D4D"],12:["#5DA5DA","#F15854","#60BD68","#845C59","#FAA43A","#41977E","#F17CB0","#DECF3F","#B276B2","#C2D580","4D4D4D","#673333"]}};